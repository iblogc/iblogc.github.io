<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#4BAD4F">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/logo.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico?v=7.4.0">
  <link rel="mask-icon" href="/logo.png?v=7.4.0" color="#4BAD4F">
  <link rel="alternate" href="/atom.xml" title="iblogc's blog" type="application/atom+xml">
  <meta name="google-site-verification" content="qG7T6aqK8Yc9wkYFQZSYbiHnFjGresFJrmQ3GILJA80">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css?v=1.0.2">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":true,"style":"default"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: true,
    lazyload: true,
    pangu: true,
    algolia: {
      appID: 'PGLEOEFW66',
      apiKey: '9e021ceac0fcb29be0a75df5b157218b',
      indexName: 'blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'å¤åˆ¶',
      copy_success: 'å¤åˆ¶æˆåŠŸ',
      copy_failure: 'å¤åˆ¶å¤±è´¥'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="keywords" content="Django,æ–‡æ¡£,ç¬”è®°">
<meta property="og:type" content="article">
<meta property="og:title" content="Django 1.9æ–‡æ¡£é˜…è¯»ç¬”è®°">
<meta property="og:url" content="http://me.iblogc.com/2016/04/04/django1-9æ–‡æ¡£é˜…è¯»ç¬”è®°/index.html">
<meta property="og:site_name" content="iblogc&#39;s blog">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-08-15T03:05:48.007Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Django 1.9æ–‡æ¡£é˜…è¯»ç¬”è®°">
  <link rel="canonical" href="http://me.iblogc.com/2016/04/04/django1-9æ–‡æ¡£é˜…è¯»ç¬”è®°/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Django 1.9æ–‡æ¡£é˜…è¯»ç¬”è®° | iblogc's blog</title>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-54784650-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-54784650-1');
    }
  </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?dbe5ded201831a4b07cca26d70e498b6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">iblogc's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">Just do it.</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
    

    <a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£<span class="badge">49</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
    

    <a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾<span class="badge">92</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-guestbook">
      
    
      
    

    <a href="/guestbook" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>ç•™è¨€ç‰ˆ</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    
      
    

    <a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-sitemap">
      
    
      
    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>ç«™ç‚¹åœ°å›¾</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-commonweal">
      
    
      
    

    <a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>å…¬ç›Š 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>æœç´¢</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="æœç´¢..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://me.iblogc.com/2016/04/04/django1-9æ–‡æ¡£é˜…è¯»ç¬”è®°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="æ²™ä¸é±¼ğŸ‡¨ğŸ‡³">
      <meta itemprop="description" content="iblogc">
      <meta itemprop="image" content="/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iblogc's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">Django 1.9æ–‡æ¡£é˜…è¯»ç¬”è®°

          
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2016-04-04 15:27:20" itemprop="dateCreated datePublished" datetime="2016-04-04T15:27:20+08:00">2016-04-04</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-08-15 11:05:48" itemprop="dateModified" datetime="2020-08-15T11:05:48+08:00">2020-08-15</time>
              </span>
            
          

          
            <span id="/2016/04/04/django1-9æ–‡æ¡£é˜…è¯»ç¬”è®°/" class="post-meta-item leancloud_visitors" data-flag-title="Django 1.9æ–‡æ¡£é˜…è¯»ç¬”è®°" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2016/04/04/django1-9æ–‡æ¡£é˜…è¯»ç¬”è®°/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/04/04/django1-9æ–‡æ¡£é˜…è¯»ç¬”è®°/" itemprop="commentCount"></span></a>
  </span>
  
  
          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              
              <span>52k</span>
            </span>
          
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              
              <span>47 åˆ†é’Ÿ</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><br><br><a id="more"></a></p>
<!--more-->
<h2 id="æ›´æ–°è®°å½•"><a href="#æ›´æ–°è®°å½•" class="headerlink" title="æ›´æ–°è®°å½•"></a>æ›´æ–°è®°å½•</h2><p>2016-04-04 åˆç¨¿<br>2016-06-30 æ›´æ–°å†…å®¹</p>
<h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a><a href="http://python.usyiyi.cn/django/topics/db/models.html" target="_blank" rel="noopener">æ¨¡å‹</a></h2><p><a href="http://python.usyiyi.cn/django_182/ref/models/meta.html#model-meta-field-api" target="_blank" rel="noopener">Model _meta API</a></p>
<p>é™åˆ¶æ™®é€šå­—æ®µçš„é€‰æ‹©èŒƒå›´<br><code>choices</code>ï¼Œvalue-textï¼Œ<br>æ˜¾ç¤º<code>get_foo_display()</code></p>
<p>æ¨¡å‹ç»§æ‰¿</p>
<ol>
<li>æŠ½è±¡åŸºç±»<ul>
<li>é»˜è®¤ç»§æ‰¿å…ƒç±»</li>
</ul>
</li>
<li>å¤šè¡¨ç»§æ‰¿<ul>
<li>ä¸€èˆ¬æƒ…å†µä¸ç»§æ‰¿å…ƒç±»</li>
</ul>
</li>
<li>ä»£ç†æ¨¡å‹</li>
</ol>
<p>å¤šé‡ç»§æ‰¿ä¸»è¦ç”¨äº<code>mix-in</code>ç±»</p>
<p>å¤šè¡¨ç»§æ‰¿æ—¶ä½¿ç”¨<code>parent_link=True</code>æ˜¾ç¤ºæŒ‡å®šOneToOneå­—æ®µ</p>
<h2 id="æ¨¡å‹å­—æ®µå‚è€ƒ"><a href="#æ¨¡å‹å­—æ®µå‚è€ƒ" class="headerlink" title="æ¨¡å‹å­—æ®µå‚è€ƒ"></a><a href="http://python.usyiyi.cn/django/ref/models/fields.html#lazy-relationships" target="_blank" rel="noopener">æ¨¡å‹å­—æ®µå‚è€ƒ</a></h2><p>ä¸å°šæœªå®šä¹‰çš„æ¨¡å‹å…³è”ä½¿ç”¨æ¨¡å‹åå­—ï¼ˆå­—ç¬¦ä¸²ï¼‰è€Œéæœ¬èº«ï¼ˆç±»ï¼‰</p>
<p>å…³è”è‡ªå·±ä½¿ç”¨<code>self</code></p>
<p><code>related_name</code> <code>relate_query_name</code></p>
<p>å¤–é”®å…³è”åˆ°ç‰¹å®šå­—æ®µ<br><code>to_field</code></p>
<p>é™åˆ¶å¤–é”®çš„é€‰æ‹©èŒƒå›´ï¼ˆå¯ä»¥æ˜¯ä¸€ä¸ªå­—å…¸ã€ä¸€ä¸ªQ å¯¹è±¡æˆ–è€…ä¸€ä¸ªè¿”å›å­—å…¸æˆ–Qå¯¹è±¡çš„å¯è°ƒç”¨å¯¹è±¡ï¼‰<br><code>limit_choices_to</code></p>
<p>å¤–é”®å…³è”å¯¹è±¡åˆ é™¤è¡Œä¸º<br><code>on_delete</code></p>
<p>1.8ä»¥åä¿å­˜æ¨¡å‹æ—¶ï¼Œæœªä¿å­˜çš„å¤–é”®å¯¹è±¡å°†è¢«å¿½ç•¥ï¼Œé™¤éè®¾ç½®<code>allow_unsaved_instance_assignment=True</code></p>
<p>å…³è”è‡ªèº«çš„å¤šå¯¹å¤šå…³ç³»é»˜è®¤å¯¹ç§°ï¼Œå–æ¶ˆå¯¹ç§°è®¾ç½®<code>symmetrical=False</code></p>
<p><code>ImageField</code>ä¸­çš„<code>height_field</code>å’Œ<code>width_field</code>æ˜¯ç”¨æ¥å­˜å‚¨å­˜å…¥å›¾ç‰‡çš„é«˜åº¦å’Œå®½åº¦å€¼çš„</p>
<p>##<a href="http://python.usyiyi.cn/django/topics/db/queries.html#spanning-multi-valued-relationships" target="_blank" rel="noopener">æ‰§è¡ŒæŸ¥è¯¢</a></p>
<p><a href="http://python.usyiyi.cn/django/howto/custom-lookups.html" target="_blank" rel="noopener">å¯è‡ªå®šä¹‰æŸ¥è¯¢ï¼ˆé«˜çº§æŸ¥æ‰¾ï¼‰</a><br><code>exclude</code>å¤šæ¡ä»¶æŸ¥è¯¢æ—¶æ˜¯ç”¨orå…³ç³»è€Œä¸æ˜¯andå…³ç³»</p>
<p><code>F()</code><br>ç”¨äºæ¨¡å‹å†…éƒ¨å­—æ®µé—´çš„æ¯”è¾ƒæ”¯æŒåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•ã€å–æ¨¡ä»¥åŠå¹‚è®¡ç®—ç­‰ç®—æœ¯æ“ä½œ<br>æ”¯æŒ.bitand() å’Œ.bitor()ä½æ“ä½œï¼Œ<code>update()</code>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>F()</code>ä½†æœ‰é™åˆ¶ï¼ˆåœ¨update ä¸­ä½ ä¸å¯ä»¥ä½¿ç”¨F() å¯¹è±¡å¼•å…¥join â€”â€” ä½ åªå¯ä»¥å¼•ç”¨æ­£åœ¨æ›´æ–°çš„æ¨¡å‹çš„å­—æ®µï¼‰</p>
<p>æŸ¥è¯¢é›†ç¼“å­˜<br>å½“åªå¯¹æŸ¥è¯¢é›†çš„éƒ¨åˆ†è¿›è¡Œæ±‚å€¼æ—¶ä¼šæ£€æŸ¥ç¼“å­˜ï¼Œ ä½†æ˜¯å¦‚æœè¿™ä¸ªéƒ¨åˆ†ä¸åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æŸ¥è¯¢è¿”å›çš„è®°å½•éƒ½å°†ä¸ä¼šè¢«ç¼“å­˜ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>queryset = Entry.objects.all()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print([p.headline <span class="keyword">for</span> p <span class="keyword">in</span> queryset]) <span class="comment"># Evaluate the query set.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print([p.pub_date <span class="keyword">for</span> p <span class="keyword">in</span> queryset]) <span class="comment"># Re-use the cache from the evaluation.</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>queryset = Entry.objects.all()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> queryset[<span class="number">5</span>] <span class="comment"># Queries the database</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> queryset[<span class="number">5</span>] <span class="comment"># Queries the database again</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; queryset = Entry.objects.all()</span><br><span class="line">&gt;&gt;&gt; [entry for entry in queryset] # Queries the database</span><br><span class="line">&gt;&gt;&gt; print queryset[5] # Uses cache</span><br><span class="line">&gt;&gt;&gt; print queryset[5] # Uses cache</span><br></pre></td></tr></table></figure>
<p><code>Q()</code><br>å¯ä½¿ç”¨Qå¯¹è±¡è¿›è¡Œå¤æ‚æŸ¥è¯¢</p>
<p>åˆ¤æ–­ä¸¤ç›¸æ¨¡å‹å®ä¾‹æ˜¯å¦ç›¸åŒï¼Œç›´æ¥ä½¿ç”¨<code>==</code>æ¯”è¾ƒå³å¯</p>
<p>é»˜è®¤æ‰¹é‡åˆ é™¤å¯¹è±¡æ—¶ä¸ä¼šè°ƒç”¨å®ä¾‹çš„<code>delete</code>æ–¹æ³•</p>
<p>æ‹·è´å®ä¾‹ï¼ŒæŠŠ<code>pk</code>è®¾ç½®ä¸º<code>None</code>å†<code>save</code>å³å¯ï¼ˆå¦‚æœæ˜¯ç»§æ‰¿çš„ï¼Œåˆ™<code>pk</code>å’Œ<code>id</code>éƒ½éœ€è¦è®¾ç½®ä¸º<code>None</code>ï¼‰</p>
<p><code>update()</code>æ–¹æ³•ä¹Ÿä¸ä¼šè°ƒç”¨æ¨¡å‹çš„<code>save()</code>æ–¹æ³•ï¼Œä¸ä¼šå‘å‡º<code>pre_save</code>å’Œ<code>post_save</code>ä¿¡å·ï¼Œå­—æ®µçš„<code>auto_now</code>ä¹Ÿä¸ä¼šèµ·ä½œç”¨</p>
<p>ä¸€å¯¹å¤šå…³è”å¯¹è±¡è®¿é—®ä¼šç¼“å­˜<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>e = Entry.objects.get(id=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(e.blog)  <span class="comment"># Hits the database to retrieve the associated Blog.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(e.blog)  <span class="comment"># Doesn't hit the database; uses cached version.</span></span><br></pre></td></tr></table></figure></p>
<p>è‡ªå®šä¹‰åå‘ç®¡ç†å™¨1.7+<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entry</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">    objects = models.Manager()  <span class="comment"># Default Manager</span></span><br><span class="line">    entries = EntryManager()    <span class="comment"># Custom Manager</span></span><br><span class="line"> </span><br><span class="line">b = Blog.objects.get(id=<span class="number">1</span>)</span><br><span class="line">b.entry_set(manager=<span class="string">'entries'</span>).all()</span><br></pre></td></tr></table></figure></p>
<h2 id="æŸ¥è¯¢é›†API-å‚è€ƒ"><a href="#æŸ¥è¯¢é›†API-å‚è€ƒ" class="headerlink" title="æŸ¥è¯¢é›†API å‚è€ƒ"></a><a href="http://python.usyiyi.cn/django/ref/models/querysets.html" target="_blank" rel="noopener">æŸ¥è¯¢é›†API å‚è€ƒ</a></h2><h2 id="èšåˆ"><a href="#èšåˆ" class="headerlink" title="èšåˆ"></a><a href="http://python.usyiyi.cn/django/topics/db/aggregation.html" target="_blank" rel="noopener">èšåˆ</a></h2><p>ä¸€æ¬¡åˆ›å»ºå¤šæ¡æ•°æ®ï¼ˆåªæœ‰ä¸€æ¡sqlï¼‰<br><code>bulk_create</code></p>
<p>æ ¹æ®æä¾›çš„ä¸€ç»„<code>pk</code>æŸ¥è¯¢å‡ºæ‰€æœ‰å¯¹åº”çš„å¯¹è±¡<br><code>in_bulk</code></p>
<p>åœ¨æŸ¥ä½œè€…åˆ—è¡¨æ—¶è¦æŸ¥æ¯ä¸ªä½œè€…æœ‰å‡ ç¯‡åšæ–‡<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>authors = Author.object.all().annotate(Count(<span class="string">'blog'</span>))</span><br><span class="line"><span class="comment"># authors[0]ä½œè€…çš„åšæ–‡æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>authors[<span class="number">0</span>].blog__count</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="comment"># æˆ–</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>authors = Author.object.all().annotate(number_of_blog=Count(<span class="string">'blog'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>authors[<span class="number">0</span>].number_of_blog</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<p>ç®—å‡ºæ‰€æœ‰ä½œè€…çš„å¹´é¾„æ€»åˆï¼ˆä¸éœ€è¦å…¶å®ƒæ•°æ®ï¼‰<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ageAuthor.objects.all().aggregate(Sum(<span class="string">'age'</span>))</span><br><span class="line">&#123;<span class="string">'age__sum'</span>: <span class="number">26</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p><del><code>annotate</code>å’Œ</del><code>aggregate</code>éƒ½å¯å†™å…¥å¤šä¸ªæ³¨è§£è¡¨è¾¾å¼<br><code>annotate</code>å’Œ<code>aggregate</code>å¯èšåˆå…³è”å¯¹è±¡</p>
<p>å¯¹æ³¨è§£è¿›è¡Œè¿‡æ»¤<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å‡ºä½œè€…æ•°å¤§äº1çš„ä¹¦æœ¬</span></span><br><span class="line"><span class="comment"># åªæœ‰ä¸€æ¡sql</span></span><br><span class="line">Book.objects.annotate(num_authors=Count(<span class="string">'authors'</span>)).filter(num_authors__gt=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<p>ä½†é¡ºåºä¸ä¸€æ ·ï¼Œç»“æœä¹Ÿä¸åŒï¼Œå¦‚ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Publisher.objects.annotate(num_books=Count(<span class="string">'book'</span>)).filter(book__rating__gt=<span class="number">3.0</span>)</span><br><span class="line">Publisher.objects.filter(book__rating__gt=<span class="number">3.0</span>).annotate(num_books=Count(<span class="string">'book'</span>))</span><br></pre></td></tr></table></figure></p>
<p>å¯¹æ³¨è§£é¡¹è¿›è¡Œæ’åº<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Book.objects.annotate(num_authors=Count(<span class="string">'authors'</span>)).order_by(<span class="string">'num_authors'</span>)</span><br></pre></td></tr></table></figure></p>
<p><code>values()</code>ä½¿ç”¨æ³¨è§£æ—¶è¦å°å¿ƒï¼Œå¦‚æœ<code>values()</code>åœ¨æ³¨è§£ä¹‹å‰ï¼Œä¼šå¯¹ç»“æœè¿›è¡Œåˆ†ç»„ï¼Œæ³¨è§£ä¼šä½œç”¨åœ¨åˆ†ç»„ä¸Šè€Œä¸æ˜¯æ•´ä¸ªæŸ¥è¯¢é›†ä¸Š</p>
<blockquote>
<p>ä¸é»˜è®¤æ’åºäº¤æ¢æˆ–order_by()Â¶</p>
</blockquote>
<blockquote>
<p>åœ¨æŸ¥è¯¢é›†ä¸­çš„order_by() éƒ¨åˆ†(æˆ–æ˜¯åœ¨æ¨¡å‹ä¸­é»˜è®¤å®šä¹‰çš„æ’åºé¡¹) ä¼šåœ¨é€‰æ‹©è¾“å‡ºæ•°æ®æ—¶è¢«ç”¨åˆ°ï¼Œå³ä½¿è¿™äº›å­—æ®µæ²¡æœ‰åœ¨ values() è°ƒç”¨ä¸­è¢«æŒ‡å®šã€‚è¿™äº›é¢å¤–çš„å­—æ®µå¯ä»¥å°†ç›¸ä¼¼çš„æ•°æ®è¡Œåˆ†åœ¨ä¸€èµ·ï¼Œä¹Ÿå¯ä»¥è®©ç›¸åŒçš„æ•°æ®è¡Œç›¸åˆ†ç¦»ã€‚åœ¨åšè®¡æ•°æ—¶ï¼Œ  å°±ä¼šè¡¨ç°åœ°æ ¼å¤–æ˜æ˜¾ï¼š</p>
</blockquote>
<blockquote>
<p>é€šè¿‡ä¾‹å­ä¸­çš„æ–¹æ³•ï¼Œå‡è®¾æœ‰ä¸€ä¸ªè¿™æ ·çš„æ¨¡å‹ï¼š</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">10</span>)</span><br><span class="line">    data = models.IntegerField() </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        ordering = [<span class="string">"name"</span>]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…³é”®çš„éƒ¨åˆ†å°±æ˜¯åœ¨æ¨¡å‹é»˜è®¤æ’åºé¡¹ä¸­è®¾ç½®çš„nameå­—æ®µã€‚å¦‚æœä½ æƒ³çŸ¥é“æ¯ä¸ªéé‡å¤çš„dataå€¼å‡ºç°çš„æ¬¡æ•°ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Warning: not quite correct!</span></span><br><span class="line">Item.objects.values(<span class="string">"data"</span>).annotate(Count(<span class="string">"id"</span>))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>â€¦è¿™éƒ¨åˆ†ä»£ç æƒ³é€šè¿‡ä½¿ç”¨å®ƒä»¬å…¬å…±çš„ data å€¼æ¥åˆ†ç»„ Itemå¯¹è±¡ï¼Œç„¶ååœ¨æ¯ä¸ªåˆ†ç»„ä¸­å¾—åˆ°  id å€¼çš„æ€»æ•°ã€‚ä½†æ˜¯ä¸Šé¢é‚£æ ·åšæ˜¯è¡Œä¸é€šçš„ã€‚è¿™æ˜¯å› ä¸ºé»˜è®¤æ’åºé¡¹ä¸­çš„ nameä¹Ÿæ˜¯ä¸€ä¸ªåˆ†ç»„é¡¹ï¼Œæ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢ä¼šæ ¹æ®éé‡å¤çš„ (data, name) è¿›è¡Œåˆ†ç»„ï¼Œè€Œè¿™å¹¶ä¸æ˜¯ä½ æœ¬æ¥æƒ³è¦çš„ç»“æœã€‚æ‰€ä»¥ï¼Œä½ åº”è¯¥è¿™æ ·æ”¹å†™ï¼š</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Item.objects.values(<span class="string">"data"</span>).annotate(Count(<span class="string">"id"</span>)).order_by()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>â€¦è¿™æ ·å°±æ¸…ç©ºäº†æŸ¥è¯¢ä¸­çš„æ‰€æœ‰æ’åºé¡¹ã€‚ ä½ ä¹Ÿå¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨ data ï¼Œè¿™æ ·å¹¶ä¸ä¼šæœ‰å‰¯ä½œç”¨ï¼Œè¿™æ˜¯å› ä¸ºæŸ¥è¯¢åˆ†ç»„ä¸­åªæœ‰è¿™ä¹ˆä¸€ä¸ªè§’è‰²äº†ã€‚</p>
</blockquote>
<blockquote>
<p>è¿™ä¸ªè¡Œä¸ºä¸æŸ¥è¯¢é›†æ–‡æ¡£ä¸­æåˆ°çš„ distinct() ä¸€æ ·ï¼Œè€Œä¸”ç”Ÿæˆè§„åˆ™ä¹Ÿä¸€æ ·ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½ ä¸æƒ³åœ¨ç»“æœä¸­ç”±é¢å¤–çš„å­—æ®µæ‰®æ¼”è¿™ä¸ªè§’è‰²ï¼Œé‚£å°±æ¸…ç©ºæ’åºé¡¹ï¼Œæˆ–æ˜¯è‡³å°‘ä¿è¯å®ƒä»…èƒ½è®¿é—® values()ä¸­çš„å­—æ®µã€‚</p>
</blockquote>
<h2 id="é™æ€æ–‡ä»¶"><a href="#é™æ€æ–‡ä»¶" class="headerlink" title="é™æ€æ–‡ä»¶"></a>é™æ€æ–‡ä»¶</h2><p><a href="http://python.usyiyi.cn/django/intro/tutorial06.html" target="_blank" rel="noopener">http://python.usyiyi.cn/django/intro/tutorial06.html</a><br><a href="http://python.usyiyi.cn/django/ref/templates/builtins.html" target="_blank" rel="noopener">http://python.usyiyi.cn/django/ref/templates/builtins.html</a> </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load static %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"&#123;% static user_stylesheet %&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'polls/style.css' %&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"&#123;% get_static_prefix %&#125;pools/style.css"</span> /&gt;</span></span><br><span class="line">&#123;% get_static_prefix as STATIC_PREFIX %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; STATIC_PREFIX &#125;&#125;pools/style.css"</span> /&gt;</span></span><br><span class="line">&#123;% static "images/hi.jpg" as myphoto %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; myphoto &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰<code>get_media_prefix</code></p>
<h2 id="æ¨¡å‹å®ä¾‹å‚è€ƒ"><a href="#æ¨¡å‹å®ä¾‹å‚è€ƒ" class="headerlink" title="æ¨¡å‹å®ä¾‹å‚è€ƒ"></a><a href="http://python.usyiyi.cn/django/ref/models/instances.html#django.db.models.Model" target="_blank" rel="noopener">æ¨¡å‹å®ä¾‹å‚è€ƒ</a></h2><p>ä»æ•°æ®åº“ä¸­é‡æ–°åŠ è½½å€¼<br><code>Model.refresh_from_db(using=None, fields=None, **kwargs)</code></p>
<p>è¿”å›æ¨¡å‹ä¸­å½“å‰æ‰€æœ‰å»¶è¿Ÿå­—æ®µçš„å±æ€§åç§°<br><code>Model.get_deferred_fields()</code></p>
<p>éªŒè¯å¯¹è±¡</p>
<blockquote>
<p>å­—æ®µçš„åŸºæœ¬éªŒè¯ä¼šæœ€å…ˆè·‘ï¼Œä½†ä¸ç®¡å‰é¢è¿è¡Œæ˜¯å¦é€šè¿‡ï¼Œå¯¹äºæ¯ä¸ªå­—æ®µï¼Œå¦‚æœField.clean() æ–¹æ³•æŠ›å‡º ValidationErrorï¼Œé‚£ä¹ˆå°†ä¸ä¼šè°ƒç”¨è¯¥å­—æ®µå¯¹åº”çš„clean_<fieldname>()æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œå‰©ä½™çš„å­—æ®µçš„éªŒè¯æ–¹æ³•ä»ç„¶ä¼šæ‰§è¡Œã€‚<br>å…ˆè·‘<code>form</code>é‡ŒéªŒè¯ï¼Œå†è·‘<code>modle</code>éªŒè¯<br>å…ˆè·‘éªŒè¯å™¨ï¼Œå†è·‘<code>clean</code><br>å…ˆè·‘å•ä¸ªå­—æ®µéªŒè¯ï¼Œå†è·‘æ•´ä½“éªŒè¯<br><code>Model.clean_field()</code>ä¼šè¦†ç›–<code>Model</code>é‡Œæ‰€æœ‰å­—æ®µçš„éªŒè¯å™¨ï¼Œä½†ä¸ä¼šå¯¹<code>Form</code>é‡Œçš„éªŒè¯å™¨äº§ç”Ÿå½±å“</fieldname></p>
</blockquote>
<p>éªŒè¯æ¨¡å‹çš„å­—æ®µ<code>Model.clean_fields(exclude=None)</code><br>éªŒè¯æ¨¡å‹çš„å®Œæ•´æ€§<code>Model.clean()</code><br>éªŒè¯æ¨¡å‹çš„å”¯ä¸€æ€§<code>Model.validate_unique(exclude=None)</code><br>è°ƒç”¨<code>full_clean()</code>æ—¶ï¼Œä¸Šé¢ä¸‰ä¸ªæ–¹æ³•éƒ½ä¼šæ‰§è¡Œï¼ˆæ‰§è¡Œé¡ºåºå³ä¸Šé¢çš„ä¹¦å†™é¡ºåºï¼‰ï¼Œ<code>ModelForm</code>çš„<code>is_valid()</code>ä¹Ÿä¼šæ‰§è¡Œä¸Šæ‰€æœ‰éªŒè¯<br><code>Model.full_clean(exclude=None, validate_unique=True)</code><br> <code>save()</code>æ—¶ï¼Œ<code>full_clean()</code>ä¸ä¼šè¢«è°ƒç”¨ï¼Œå¦‚æœæƒ³éªŒè¯æ•°æ®ï¼Œå¯æ‰‹åŠ¨è°ƒç”¨</p>
<p><code>Model.clean()</code>æ—¶ï¼Œå¼•å‘ç‰¹å®šå­—æ®µçš„å¼‚å¸¸<br>ä½¿ç”¨ä¸€ä¸ªå­—å…¸å®ä¾‹åŒ–<code>ValidationError</code>å³å¯æˆ–ä½¿ç”¨<code>add_error(field, msg)</code>æ–¹æ³•</p>
<p>åœ¨æ•°æ®åº“å­—æ®µå€¼çš„åŸºç¡€ä¸Šè¿›è¡Œç®€å•çš„ç®—æ³•æ“ä½œï¼Œåº”è¯¥å°½é‡ä½¿ç”¨<code>F()</code>è¡¨è¾¾å¼ï¼Œé¿å…é—®é¢˜ç«æ€æ¡ä»¶</p>
<blockquote>
<p>æŒ‡å®šè¦ä¿å­˜çš„å­—æ®µ</p>
</blockquote>
<blockquote>
<p>å¦‚æœä¼ é€’ç»™save() çš„update_fields å…³é”®å­—å‚æ•°ä¸€ä¸ªå­—æ®µåç§°åˆ—è¡¨ï¼Œé‚£ä¹ˆå°†åªæœ‰è¯¥åˆ—è¡¨ä¸­çš„å­—æ®µä¼šè¢«æ›´æ–°ã€‚å¦‚æœä½ æƒ³æ›´æ–°å¯¹è±¡çš„ä¸€ä¸ªæˆ–å‡ ä¸ªå­—æ®µï¼Œè¿™å¯èƒ½æ˜¯ä½ æƒ³è¦çš„ã€‚ä¸è®©æ¨¡å‹çš„æ‰€æœ‰å­—æ®µéƒ½æ›´æ–°å°†ä¼šå¸¦æ¥ä¸€äº›è½»å¾®çš„æ€§èƒ½æå‡ã€‚ä¾‹å¦‚ï¼š</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">product.name = <span class="string">'Name changed again'</span></span><br><span class="line">product.save(update_fields=[<span class="string">'name'</span>])</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>update_fields</code> å‚æ•°å¯ä»¥æ˜¯ä»»ä½•åŒ…å«å­—ç¬¦ä¸²çš„å¯è¿­ä»£å¯¹è±¡ã€‚ç©ºçš„<code>update_fields</code>å¯è¿­ä»£å¯¹è±¡å°†ä¼šå¿½ç•¥ä¿å­˜ã€‚å¦‚æœä¸º<code>None</code>å€¼ï¼Œå°†æ‰§è¡Œæ‰€æœ‰å­—æ®µä¸Šçš„æ›´æ–°ã€‚</p>
</blockquote>
<blockquote>
<p>æŒ‡å®š<code>update_fields</code>å°†å¼ºåˆ¶ä½¿ç”¨æ›´æ–°æ“ä½œã€‚</p>
</blockquote>
<blockquote>
<p>å½“ä¿å­˜é€šè¿‡å»¶è¿Ÿæ¨¡å‹åŠ è½½ï¼ˆ<code>only()</code> æˆ–<code>defer()</code>ï¼‰è¿›è¡Œè®¿é—®çš„æ¨¡å‹æ—¶ï¼Œåªæœ‰ä»æ•°æ®åº“ä¸­åŠ è½½çš„å­—æ®µæ‰ä¼šå¾—åˆ°æ›´æ–°ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸ªè‡ªåŠ¨çš„<code>update_fields</code>ã€‚å¦‚æœä½ èµ‹å€¼æˆ–è€…æ”¹å˜å»¶è¿Ÿå­—æ®µçš„å€¼ï¼Œè¯¥å­—æ®µå°†ä¼šæ·»åŠ åˆ°æ›´æ–°çš„å­—æ®µä¸­ã€‚</p>
</blockquote>
<p>new in 1.9<br>ä½¿ç”¨<code>Model.delete()</code>åˆ é™¤å¤šè¡¨ç»§æ‰¿çš„å­è¡¨æ•°æ®æ—¶ï¼Œä½¿ç”¨<code></code>keep_parents=True<code>å¯ä»¥ä¿ç•™ä¸Šçº§æ•°æ®ï¼Œé»˜è®¤ä¸º</code>False`<br>è¿”å›å€¼ä¸ºåˆ é™¤æ•°æ®çš„æ¡æ•°</p>
<p><code>DateField</code>å’Œ<code>DateTimeField</code>å­—æ®µå¦‚æœ<code>null=False</code>åˆ™æ”¯æŒä¸‹é¢ä¸¤ä¸ªæ–¹æ³•<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.get_next_by_FOO(**kwargs)Â¶ </span><br><span class="line">Model.get_previous_by_FOO(**kwargs)</span><br></pre></td></tr></table></figure></p>
<h2 id="ç®¡ç†å™¨"><a href="#ç®¡ç†å™¨" class="headerlink" title="ç®¡ç†å™¨"></a><a href="http://python.usyiyi.cn/django/topics/db/managers.html" target="_blank" rel="noopener">ç®¡ç†å™¨</a></h2><p>djangoé‡åˆ°çš„ç¬¬ä¸€ä¸ªç®¡ç†å™¨ä¸ºé»˜è®¤ç®¡ç†å™¨</p>
<p>å¦‚æœéœ€è¦è®¿é—®å…³è”å¯¹è±¡è°ƒç”¨å…³è”å¯¹è±¡çš„é»˜è®¤ç®¡ç†å™¨ï¼Œéœ€è¦åœ¨ç®¡ç†å™¨ä¸­åŠ <code>use_for_related_fields=True</code>ï¼Œä¸ç„¶ä¼šè°ƒç”¨æœ´ç´ ç®¡ç†å™¨<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultManager</span><span class="params">(models.Manager)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span></span><br><span class="line">        queryset = super(DefaultManager, self).get_quertset().filter(is_delete=<span class="keyword">False</span>)</span><br><span class="line">        <span class="keyword">return</span> queryset</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    is_delete = models.BooleanField()</span><br><span class="line">    objects = DefaultManager()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    author = models.ForeignKey(Author)</span><br><span class="line">    title = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    content = models.TextField()</span><br><span class="line">    is_delete = models.BooleanField()</span><br><span class="line">    objects = DefaultManager()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">author = Author.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">post = Post.objects.get(pk=<span class="number">2</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è°ƒç”¨DefaultManagerç®¡ç†å™¨</span></span><br><span class="line">author.post_set.all()</span><br><span class="line"><span class="comment"># è°ƒç”¨æœ´ç´ ç®¡ç†å™¨ï¼Œå¦‚æœè¦è°ƒç”¨DefaultManagerç®¡ç†å™¨ï¼Œéœ€è¦è®¾ç½®DefaultManagerç®¡ç†å™¨çš„ç±»å˜é‡use_for_related_fields=True</span></span><br><span class="line">post.author</span><br></pre></td></tr></table></figure></p>
<p><em>æ³¨ï¼šæœ´ç´ ç®¡ç†å™¨é‡Œæ‰¾ä¸åˆ°çš„æ–¹æ³•ä¼šåœ¨é»˜è®¤ç®¡ç†å™¨é‡ŒæŸ¥æ‰¾</em></p>
<p><a href="http://python.usyiyi.cn/django/topics/db/managers.html#calling-custom-queryset-methods-from-the-manager" target="_blank" rel="noopener">ä»Managerä¸­è°ƒç”¨è‡ªå®šä¹‰çš„QuerySet</a></p>
<h2 id="è¿›è¡ŒåŸå§‹çš„SQLæŸ¥è¯¢"><a href="#è¿›è¡ŒåŸå§‹çš„SQLæŸ¥è¯¢" class="headerlink" title="è¿›è¡ŒåŸå§‹çš„SQLæŸ¥è¯¢"></a><a href="http://python.usyiyi.cn/django/topics/db/sql.html" target="_blank" rel="noopener">è¿›è¡ŒåŸå§‹çš„SQLæŸ¥è¯¢</a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Manager.raw(raw_query, params=<span class="keyword">None</span>, translations=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>django.db.connectionå¯¹è±¡æä¾›äº†å¸¸è§„æ•°æ®åº“è¿æ¥çš„æ–¹å¼ã€‚ä¸ºäº†ä½¿ç”¨æ•°æ®åº“è¿æ¥ï¼Œå…ˆè¦è°ƒç”¨connection.cursor()æ–¹æ³•æ¥è·å–ä¸€ä¸ªæ¸¸æ ‡å¯¹è±¡ä¹‹åï¼Œè°ƒç”¨cursor.execute(sql, [params])æ¥æ‰§è¡Œsqlè¯­å¥ï¼Œè°ƒç”¨cursor.fetchone()æˆ–è€…cursor.fetchall()æ¥è¿”å›ç»“æœè¡Œã€‚</p>
</blockquote>
<h2 id="æ•°æ®åº“äº‹åŠ¡"><a href="#æ•°æ®åº“äº‹åŠ¡" class="headerlink" title="æ•°æ®åº“äº‹åŠ¡"></a><a href="http://python.usyiyi.cn/django/topics/db/transactions.html" target="_blank" rel="noopener">æ•°æ®åº“äº‹åŠ¡</a></h2><p>è¯¦ç»†ç¬”è®°è§django1.8äº‹åŠ¡.md</p>
<p>å°†æ¯ä¸ªHTTPè¯·æ±‚å°è£…åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ä¸­<br>settingsä¸­è®¾ç½®<code>ATOMIC_REQUESTS=True</code></p>
<p>å•ç‹¬ç»™ä¸€ä¸ªæ–¹æ³•åŠ ä¸Šæ•°æ®åº“äº‹åŠ¡æ§åˆ¶ä½¿ç”¨<code>atomic</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"> </span><br><span class="line"><span class="meta">@transaction.atomic</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">viewfunc</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># This code executes inside a transaction.</span></span><br><span class="line">    do_stuff()</span><br></pre></td></tr></table></figure></p>
<p>æˆ–<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">viewfunc</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># This code executes in autocommit mode (Django's default).</span></span><br><span class="line">    do_stuff()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">with</span> transaction.atomic():</span><br><span class="line">        <span class="comment"># This code executes inside a transaction.</span></span><br><span class="line">        do_more_stuff()</span><br></pre></td></tr></table></figure></p>
<p>é¿å…åœ¨ atomicé‡Œæ•è·å¼‚å¸¸!</p>
<h2 id="æŸ¥è¯¢è¡¨è¾¾å¼"><a href="#æŸ¥è¯¢è¡¨è¾¾å¼" class="headerlink" title="æŸ¥è¯¢è¡¨è¾¾å¼"></a>æŸ¥è¯¢è¡¨è¾¾å¼</h2><p>ä½¿ç”¨æ•°æ®åº“çš„æ–¹æ³•<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Func, F </span><br><span class="line">queryset.annotate(field_lower=Func(F(<span class="string">'field'</span>), function=<span class="string">'LOWER'</span>))</span><br></pre></td></tr></table></figure></p>
<p>æˆ–<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lower</span><span class="params">(Func)</span>:</span></span><br><span class="line">    function = <span class="string">'LOWER'</span> </span><br><span class="line">queryset.annotate(field_lower=Lower(F(<span class="string">'field'</span>)))</span><br></pre></td></tr></table></figure></p>
<h2 id="æ¡ä»¶è¡¨è¾¾å¼"><a href="#æ¡ä»¶è¡¨è¾¾å¼" class="headerlink" title="æ¡ä»¶è¡¨è¾¾å¼"></a><a href="http://python.usyiyi.cn/django/ref/models/conditional-expressions.html" target="_blank" rel="noopener">æ¡ä»¶è¡¨è¾¾å¼</a></h2><p>é«˜çº§ç”¨æ³•æŸ¥çœ‹åœ¨çº¿ç‰ˆ<br><code>When</code><br><code>Case</code></p>
<h2 id="æ•°æ®åº“å‡½æ•°"><a href="#æ•°æ®åº“å‡½æ•°" class="headerlink" title="æ•°æ®åº“å‡½æ•°"></a><a href="http://python.usyiyi.cn/django/ref/models/database-functions.html" target="_blank" rel="noopener">æ•°æ®åº“å‡½æ•°</a></h2><p><code>Coalesce</code> æ¥æ”¶ä¸€ä¸ªå«æœ‰è‡³å°‘ä¸¤ä¸ªå­—æ®µåç§°æˆ–è¡¨è¾¾å¼çš„åˆ—è¡¨ï¼Œè¿”å›ç¬¬ä¸€ä¸ªéç©ºçš„å€¼ï¼ˆç©ºå­—ç¬¦ä¸²ä¸è®¤ä¸ºæ˜¯ä¸€ä¸ªç©ºå€¼ï¼‰</p>
<h2 id="å°†é—ç•™æ•°æ®åº“æ•´åˆåˆ°Django"><a href="#å°†é—ç•™æ•°æ®åº“æ•´åˆåˆ°Django" class="headerlink" title="å°†é—ç•™æ•°æ®åº“æ•´åˆåˆ°Django"></a><a href="http://python.usyiyi.cn/django/howto/legacy-databases.html" target="_blank" rel="noopener">å°†é—ç•™æ•°æ®åº“æ•´åˆåˆ°Django</a></h2><p>æ ¹æ®é—ç•™æ•°æ®åº“ç”Ÿæˆmodels<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py inspectdb &gt; models.py</span><br></pre></td></tr></table></figure></p>
<h2 id="ä¸ºæ¨¡å‹æä¾›åˆå§‹æ•°æ®"><a href="#ä¸ºæ¨¡å‹æä¾›åˆå§‹æ•°æ®" class="headerlink" title="ä¸ºæ¨¡å‹æä¾›åˆå§‹æ•°æ®"></a><a href="http://python.usyiyi.cn/django/howto/initial-data.html" target="_blank" rel="noopener">ä¸ºæ¨¡å‹æä¾›åˆå§‹æ•°æ®</a></h2><p>ä½¿ç”¨fixtures<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;model&quot;: &quot;myapp.person&quot;,</span><br><span class="line">    &quot;pk&quot;: 1,</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &quot;John&quot;,</span><br><span class="line">      &quot;last_name&quot;: &quot;Lennon&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;model&quot;: &quot;myapp.person&quot;,</span><br><span class="line">    &quot;pk&quot;: 2,</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &quot;Paul&quot;,</span><br><span class="line">      &quot;last_name&quot;: &quot;McCartney&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>å¯¼å…¥æ•°æ®å‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py loaddata &lt;fixturename&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="æ•°æ®åº“è®¿é—®ä¼˜åŒ–"><a href="#æ•°æ®åº“è®¿é—®ä¼˜åŒ–" class="headerlink" title="æ•°æ®åº“è®¿é—®ä¼˜åŒ–"></a>æ•°æ®åº“è®¿é—®ä¼˜åŒ–</h2><p>æ·»åŠ ç´¢å¼•ï¼Œæ¯”ä»»ä½•æŸ¥è¯¢è¯­æ³•ä¼˜åŒ–éƒ½æ¥çš„é‡è¦<br>ç†è§£æŸ¥è¯¢é›†<br>QuerySetsæ˜¯å»¶è¿Ÿçš„ã€‚<br>ä»€ä¹ˆæ—¶å€™å®ƒä»¬è¢«è®¡ç®—å‡ºæ¥ã€‚<br>æ•°æ®åœ¨å†…å­˜ä¸­å¦‚ä½•å­˜å‚¨ã€‚</p>
<p>ä½¿ç”¨<code>cached_property</code>è£…é¥°å™¨ï¼Œåªè¦æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œä¸€ä¸ªæ–¹æ³•å°±åªä¼šæ‰§è¡Œä¸€æ¬¡<br>ä½¿ç”¨<code>with</code>æ¨¡ç‰ˆæ ‡ç­¾<br>ä½¿ç”¨<code>iterator</code>è¿­ä»£å™¨</p>
<p>åœ¨æ•°æ®åº“ä¸­è€Œä¸æ˜¯pythonä¸­åšæ•°æ®åº“å·¥ä½œ<br>ä½¿ç”¨è¿‡æ»¤å™¨å’Œåå°„è¿‡æ»¤å™¨å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤<br>ä½¿ç”¨<code>F()</code>è¡¨è¾¾å¼<br>ä½¿ç”¨æ³¨è§£å’Œèšåˆ<br>ä½¿ç”¨åŸå§‹SQL</p>
<p>ç”¨å”¯ä¸€çš„æˆ–è¢«ç´¢å¼•çš„åˆ—æ¥æ£€ç´¢ç‹¬ç«‹å¯¹è±¡</p>
<p>åœ¨ä¸åŒä½ç½®å¤šæ¬¡è®¿é—®æ•°æ®åº“ï¼Œæ¯æ¬¡è·å–ä¸€ä¸ªæ•°æ®é›†ï¼Œä¸å¦‚åœ¨ä¸€æ¬¡æŸ¥è¯¢ä¸­è·å–å®ƒä»¬ã€‚æ¯”å¦‚å¾ªç¯çš„æ—¶å€™ã€‚</p>
<p>ä½¿ç”¨<code>select_related()</code>å’Œ<code>prefetch_related()</code></p>
<p>ä¸æ£€ç´¢ä½ ä¸éœ€è¦çš„ä¿¡æ¯<br>ä½¿ç”¨<code>QuerySet.values()</code>å’Œ<code>QuerySet.values_list()</code></p>
<p>ä½¿ç”¨<code>QuerySet.defer()</code>å’Œ<code>QuerySet.only()</code></p>
<p>è®¡ç®—æ•°é‡ä¸è¦ä½¿ç”¨<code>len(queryset)</code>è€Œæ˜¯ä½¿ç”¨<code>QuerySet.count()</code></p>
<p>åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç»“æœä½¿ç”¨<code>QuerySet.exists()</code>è€Œä¸æ˜¯ç”¨<code>if queryset</code></p>
<p>ä½†ä¸è¦è¿‡åº¦ä½¿ç”¨<code>count()</code>å’Œ<code>exists()</code>ï¼Œå¦‚æœä½ æœ¬æ¥å°±éœ€è¦é‡Œé¢çš„æ•°æ®ï¼Œé‚£å°±ä¸è¦ä½¿ç”¨</p>
<p>ä½¿ç”¨<code>QuerySet.update()</code>å’Œ<code>QuerySet.delete()</code>æ‰¹é‡æ“ä½œæ•°æ®</p>
<p>ç›´æ¥ä½¿ç”¨å¤–é”®çš„å€¼<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">entry.blog_id</span><br><span class="line"><span class="comment"># è€Œä¸æ˜¯</span></span><br><span class="line">entry.blog.id</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ å¹¶åœ¨æ„ç»“æœé›†çš„é¡ºåºï¼Œä¸è¦è¿›è¡Œæ’åºï¼Œç§»é™¤<code>Meta.ordering</code></p>
<p>åˆ›å»ºå¯¹è±¡æ—¶å°½å¯èƒ½ä½¿ç”¨<code>bulk_create()</code>æ¥å‡å°‘sqlæŸ¥è¯¢æ•°é‡<br>è¿™ä¹Ÿé€‚ç”¨äº<code>ManyToManyFields</code>çš„æƒ…å†µï¼Œä¸€èµ·<code>add</code>è€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ª<code>add</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my_band.members.add(me, my_friend) </span><br><span class="line"><span class="comment">#æ›´ä¼˜äº </span></span><br><span class="line">my_band.members.add(me)</span><br><span class="line">my_band.members.add(my_friend)</span><br></pre></td></tr></table></figure></p>
<h2 id="URLè°ƒåº¦å™¨"><a href="#URLè°ƒåº¦å™¨" class="headerlink" title="URLè°ƒåº¦å™¨"></a><a href="http://python.usyiyi.cn/django/topics/http/urls.html" target="_blank" rel="noopener">URLè°ƒåº¦å™¨</a></h2><p>urlæ•è·çš„å‚æ•°æ°¸è¿œæ˜¯å­—ç¬¦ä¸²</p>
<p>åœ¨æ ¹urlä¸Šè·å–çš„å‚æ•°ä¸å½±å“å‚æ•°ä¼ é€’<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In settings/urls/main.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> include, url</span><br><span class="line"> </span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^(?P&lt;username&gt;\w+)/blog/'</span>, include(<span class="string">'foo.urls.blog'</span>)),</span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># In foo/urls/blog.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"> </span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^$'</span>, views.blog.index),</span><br><span class="line">    url(<span class="string">r'^archive/$'</span>, views.blog.archive),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ•è·çš„â€usernameâ€å˜é‡å°†è¢«å¦‚æœŸä¼ é€’ç»™include()æŒ‡å‘çš„URLconfã€‚</p>
<p>å¯åµŒå¥—<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"> </span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'blog/(page-(\d+)/)?$'</span>, blog_articles),                  <span class="comment"># bad</span></span><br><span class="line">    url(<span class="string">r'comments/(?:page-(?P&lt;page_number&gt;\d+)/)?$'</span>, comments),  <span class="comment"># good</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>ä¼ é€’é¢å¤–çš„å‚æ•°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"> </span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^blog/(?P&lt;year&gt;[0-9]&#123;4&#125;)/$'</span>, views.year_archive, &#123;<span class="string">'foo'</span>: <span class="string">'bar'</span>&#125;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>å½“urlæ•è·çš„å‚æ•°å’Œå­—å…¸ä¸­ä¼ é€’çš„å‚æ•°åŒåæ—¶ï¼Œå°†å¿½ç•¥urlæ•è·çš„å‚æ•°è€Œä½¿ç”¨å­—å…¸é‡Œçš„å‚æ•°å€¼</p>
<p>ä¼ é€’é¢å¤–çš„å‚æ•°ç»™<code>include()</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> include, url</span><br><span class="line"> </span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^blog/'</span>, include(<span class="string">'inner'</span>), &#123;<span class="string">'blogid'</span>: <span class="number">3</span>&#125;),</span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># inner.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> mysite <span class="keyword">import</span> views</span><br><span class="line"> </span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^archive/$'</span>, views.archive),</span><br><span class="line">    url(<span class="string">r'^about/$'</span>, views.about),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>æ•ˆæœç­‰åŒ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> include, url</span><br><span class="line"><span class="keyword">from</span> mysite <span class="keyword">import</span> views</span><br><span class="line"> </span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^blog/'</span>, include(<span class="string">'inner'</span>)),</span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># inner.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"> </span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^archive/$'</span>, views.archive, &#123;<span class="string">'blogid'</span>: <span class="number">3</span>&#125;),</span><br><span class="line">    url(<span class="string">r'^about/$'</span>, views.about, &#123;<span class="string">'blogid'</span>: <span class="number">3</span>&#125;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p><a href="http://python.usyiyi.cn/django/topics/http/urls.html#reversing-namespaced-urls" target="_blank" rel="noopener">åæŸ¥å¸¦å‘½åç©ºé—´çš„URL</a></p>
<h2 id="ç¼–å†™è§†å›¾"><a href="#ç¼–å†™è§†å›¾" class="headerlink" title="ç¼–å†™è§†å›¾"></a><a href="http://python.usyiyi.cn/django/topics/http/views.html" target="_blank" rel="noopener">ç¼–å†™è§†å›¾</a></h2><p><code>HttpResponse</code>å­ç±»ï¼ŒçŠ¶æ€ç </p>
<ul>
<li><code>HttpResponseRedirect</code> ä¸´æ—¶é‡å®šå‘ï¼Œ302</li>
<li><code>HttpResponsePermanentRedirect</code> æ°¸ä¹…é‡å®šå‘ï¼Œ301</li>
<li><code>HttpResponseNotModified</code> æ²¡æœ‰ä»»ä½•ä¿®æ”¹ï¼Œ304</li>
<li><code>HttpResponseBadRequest</code> è¯­ä¹‰æœ‰è¯¯ç ï¼Œå½“å‰è¯·æ±‚ä¸è¢«æœåŠ¡å™¨ç†è§£ï¼Œ400</li>
<li><code>HttpResponseNotFound</code> é¡µé¢æ²¡æ‰¾åˆ°ï¼Œ404</li>
<li><code>HttpResponseForbidden</code> æœåŠ¡å™¨ç†è§£è¯·æ±‚ï¼Œä½†æ‹’ç»æ‰§è¡Œï¼Œ403</li>
<li><code>HttpResponseNotAllowed</code> è¯·æ±‚ä¸­æŒ‡å®šçš„è¯·æ±‚æ–¹å¼ä¸èƒ½ç”¨äºè¯·æ±‚ç›¸åº”èµ„æºï¼Œ405</li>
<li><code>HttpResponseGone</code> è¯·æ±‚çš„èµ„æºåœ¨æœåŠ¡å™¨ä¸Šå·²ç»ä¸å¯ç”¨ï¼Œè€Œä¸”æ²¡æœ‰å·²çŸ¥çš„è½¬å‘åœ°å€ï¼Œ410</li>
<li><code>HttpResponseServerError</code> æœåŠ¡å™¨é‡åˆ°äº†ä¸€ä¸ªæ„å¤–çš„é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•å®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†ï¼Œ500</li>
<li><code>HttpResponse(status=201)</code> è‡ªå®šä¹‰è¿”å›çŠ¶æ€ç </li>
</ul>
<p>é‡å†™é”™è¯¯è§†å›¾ï¼ˆåœ¨urlä¸­ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">handler404 = &apos;mysite.views.my_custom_page_not_found_view&apos;</span><br><span class="line">handler500 = &apos;mysite.views.my_custom_error_view&apos; </span><br><span class="line">handler403 = &apos;mysite.views.my_custom_permission_denied_view&apos;</span><br><span class="line">handler400 = &apos;mysite.views.my_custom_bad_request_view&apos;</span><br></pre></td></tr></table></figure></p>
<h2 id="Django-çš„å¿«æ·å‡½æ•°"><a href="#Django-çš„å¿«æ·å‡½æ•°" class="headerlink" title="Django çš„å¿«æ·å‡½æ•°"></a><a href="http://python.usyiyi.cn/django/topics/http/shortcuts.html" target="_blank" rel="noopener">Django çš„å¿«æ·å‡½æ•°</a></h2><p><code>template_name</code>å¯ä¼ ä¸€ä¸ªæ¨¡ç‰ˆåºåˆ—ï¼Œdjangoå°†ä½¿ç”¨å­˜åœ¨çš„ç¬¬ä¸€ä¸ªæ¨¡ç‰ˆ</p>
<p><code>redirect(to, [permanent=False, ]*args, **kwargs)[source]</code></p>
<blockquote>
<p>ä¸ºä¼ é€’è¿›æ¥çš„å‚æ•°è¿”å›HttpResponseRedirect ç»™æ­£ç¡®çš„URL ã€‚<br>å‚æ•°å¯ä»¥æ˜¯ï¼š</p>
<pre><code>ä¸€ä¸ªæ¨¡å‹ï¼šå°†è°ƒç”¨æ¨¡å‹çš„get_absolute_url() å‡½æ•°
ä¸€ä¸ªè§†å›¾ï¼Œå¯ä»¥å¸¦æœ‰å‚æ•°ï¼šå°†ä½¿ç”¨urlresolvers.reverse æ¥åå‘è§£æåç§°
ä¸€ä¸ªç»å¯¹çš„æˆ–ç›¸å¯¹çš„URLï¼Œå°†åŸæ ·ä½œä¸ºé‡å®šå‘çš„ä½ç½®ã€‚
</code></pre><p>é»˜è®¤è¿”å›ä¸€ä¸ªä¸´æ—¶çš„é‡å®šå‘ï¼›ä¼ é€’permanent=True å¯ä»¥è¿”å›ä¸€ä¸ªæ°¸ä¹…çš„é‡å®šå‘ã€‚</p>
</blockquote>
<p><code>get_object_or_404(klass, *args, **kwargs)</code>å¯ä»¥ä¼ Modelä¹Ÿå¯ä»¥ä¼ QuerySetå®ä¾‹å’Œå…³è”çš„ç®¡ç†å™¨<br><code>get_list_or_404(klass, *args, **kwargs)</code>å¯ä»¥ä¼ Modelä¹Ÿå¯ä»¥ä¼ QuerySetå®ä¾‹å’Œå…³è”çš„ç®¡ç†å™¨</p>
<h2 id="è§†å›¾è£…é¥°å™¨"><a href="#è§†å›¾è£…é¥°å™¨" class="headerlink" title="è§†å›¾è£…é¥°å™¨"></a><a href="http://python.usyiyi.cn/django/topics/http/decorators.html" target="_blank" rel="noopener">è§†å›¾è£…é¥°å™¨</a></h2><p><a href="http://python.usyiyi.cn/django/topics/conditional-view-processing.html" target="_blank" rel="noopener">æŒ‰éœ€å†…å®¹å¤„ç†</a><br><code>django.views.decorators.http</code>åŒ…é‡Œçš„è£…é¥°å™¨å¯ä»¥åŸºäºè¯·æ±‚çš„æ–¹æ³•æ¥é™åˆ¶å¯¹è§†å›¾çš„è®¿é—®ã€‚è‹¥æ¡ä»¶ä¸æ»¡è¶³ä¼šè¿”å› django.http.HttpResponseNotAllowedã€‚<br><code>require_http_methods(request_method_list)</code>é™åˆ¶è§†å›¾åªèƒ½æœåŠ¡äºè§„å®šçš„httpæ–¹æ³•ï¼ˆéœ€è¦å¤§å†™ï¼‰<br><code>require_GET()</code><br><code>require_POST()</code><br><code>require_safe()</code>åªå…è®¸è§†å›¾æ¥å—GETå’ŒHEADæ–¹æ³•çš„è£…é¥°å™¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@condition(etag_func=None, last_modified_func=None)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@last_modified(last_modified_func)</span></span><br></pre></td></tr></table></figure>
<p>æ ¹æ®æœ€åä¿®æ”¹æ—¶é—´æ¥å†³å®šæ˜¯å¦è¿è¡Œè§†å›¾ï¼Œå¯å‡å°‘æµé‡<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@etag(etag_func)</span></span><br></pre></td></tr></table></figure></p>
<p><code>etag</code>ï¼ˆç‰ˆæœ¬ï¼Ÿï¼‰å’Œ<code>last_modified</code>ä¸èƒ½åŒæ—¶ä½¿ç”¨</p>
<p><code>GZip</code>å¯¹å†…å®¹è¿›è¡Œå‹ç¼©ï¼ŒèŠ‚çœæµé‡ï¼Œä½†å¢åŠ å¤„ç†æ—¶é—´</p>
<p><code>vary_on_cookie</code><br><code>vary_on_headers</code><br>åŸºäºç‰¹å®šçš„è¯·æ±‚å¤´éƒ¨æ¥æ§åˆ¶ç¼“å­˜</p>
<p><code>never_cache</code></p>
<h2 id="Request-å¯¹è±¡å’ŒResponse-å¯¹è±¡"><a href="#Request-å¯¹è±¡å’ŒResponse-å¯¹è±¡" class="headerlink" title="Request å¯¹è±¡å’ŒResponse å¯¹è±¡"></a><a href="http://python.usyiyi.cn/django/ref/request-response.html" target="_blank" rel="noopener">Request å¯¹è±¡å’ŒResponse å¯¹è±¡</a></h2><p><code>HttpRequest</code>å¯¹è±¡(é™¤éç‰¹æ®Šè¯´æ˜ï¼Œæ‰€æœ‰å±æ€§éƒ½æ˜¯åªè¯»ï¼Œ<code>session</code>å±æ€§æ˜¯ä¸ªä¾‹å¤–)<br><code>HttpRequest.scheme</code> è¯·æ±‚æ–¹æ¡ˆï¼ˆé€šå¸¸ä¸ºhttpæˆ–httpsï¼‰<br><code>HttpRequest.body</code> å­—èŠ‚å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºåŸå§‹httpè¯·æ±‚æ­£æ–‡<br><code>HttpRequest.path</code> å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¯·æ±‚çš„é¡µé¢çš„å®Œæ•´è·¯å¾„ï¼Œä¸åŒ…å«åŸŸå<br><code>HttpRequest.path_info</code>    åœ¨æŸäº›Web æœåŠ¡å™¨é…ç½®ä¸‹ï¼Œä¸»æœºååçš„URL éƒ¨åˆ†è¢«åˆ†æˆè„šæœ¬å‰ç¼€éƒ¨åˆ†å’Œè·¯å¾„ä¿¡æ¯éƒ¨åˆ†ã€‚path_info å±æ€§å°†å§‹ç»ˆåŒ…å«è·¯å¾„ä¿¡æ¯éƒ¨åˆ†ï¼Œä¸è®ºä½¿ç”¨çš„Web æœåŠ¡å™¨æ˜¯ä»€ä¹ˆã€‚ä½¿ç”¨å®ƒä»£æ›¿path å¯ä»¥è®©ä»£ç åœ¨æµ‹è¯•å’Œå¼€å‘ç¯å¢ƒä¸­æ›´å®¹æ˜“åœ°åˆ‡æ¢ã€‚<br>    ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨çš„WSGIScriptAlias è®¾ç½®ä¸ºâ€/minfoâ€ï¼Œé‚£ä¹ˆå½“path æ˜¯â€/minfo/music/bands/the_beatles/â€œ æ—¶path_info å°†æ˜¯â€/music/bands/the_beatles/â€œã€‚<br><code>HttpRequest.method</code> è¯·æ±‚ä½¿ç”¨çš„httpæ–¹æ³•ï¼Œå¤§å†™<br><code>HttpRequest.encoding</code> è¡¨ç¤ºæäº¤çš„æ•°æ®çš„ç¼–ç æ–¹å¼ï¼Œå¯å†™<br><code>HttpRequest.GET</code><br><code>HttpRequest.POST</code><br><code>HttpRequest.REQUEST</code>ä¸å»ºè®®ä½¿ç”¨ï¼Œä½¿ç”¨<code>GET</code>å’Œ<code>POST</code>ä»£æ›¿<br><code>HttpRequest.COOKIES</code> å­—å…¸ï¼Œé”®å’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²<br><code>HttpRequest.FILES</code> ç±»ä¼¼å­—å…¸çš„å¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰çš„ä¸Šä¼ æ–‡ä»¶ï¼Œ<form>å¸¦æœ‰<code>enctype=&quot;multipart/form-data&quot;</code>æ‰ä¼šæœ‰æ•°æ®<br><code>HttpRequest.META</code> æ ‡å‡†çš„pythonå­—å…¸ï¼ŒåŒ…å«æ‰€æœ‰httpè¯·æ±‚å¤´éƒ¨<br><code>HttpRequest.user</code><br><code>HttpRequest.session</code> ç±»ä¼¼å­—å…¸çš„å¯¹è±¡<br><code>HttpRequest.urlconf</code> å¦‚æœå…¶å®ƒåœ°æ–¹è®¾ç½®äº†ï¼Œåˆ™ç”¨æ¥å–ä»£<code>ROOT_URLCONF</code><br><code>HttpRequest.resolver_match</code> ä¼šåœ¨urlè§£æä¹‹åè®¾ç½®ï¼Œä¸€ä¸ª<code>ResolverMatch</code>å®ä¾‹ï¼Œè¡¨ç¤ºè§£æä¹‹åçš„url<br><code>HttpRequest.get_host()</code> è·å–åŸå§‹ä¸»æœºåœ°å€<br><code>HttpRequest.get_port()</code> è·å–è¯·æ±‚ç«¯ç«¯å£å·<br><code>HttpRequest.get_full_path()</code> è¿”å›å®Œæ•´çš„pathï¼ŒåŒ…æ‹¬æŸ¥è¯¢å­—ç¬¦ä¸²<br><code>HttpRequest.build_absolute_uri(location)</code> è¿”å›ç»å¯¹url<br><code>HttpRequest.get_signed_cookie(key, default=RAISE_ERROR, salt=&#39;&#39;, max_age=None)</code> è¿”å›ç­¾åè¿‡çš„Cookieå¯¹åº”çš„å€¼<br><code>HttpRequest.is_secure()</code> å¦‚æœè¯·æ±‚æ˜¯é€šè¿‡httpså‘èµ·çš„ï¼Œåˆ™è¿”å›True<br><code>HttpRequest.is_ajax()</code> å¦‚æœè¯·æ±‚æ˜¯é€šè¿‡XMLHttpRequestå‘èµ·çš„ï¼Œåˆ™è¿”å›True<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HttpRequest.read(size=<span class="keyword">None</span>)</span><br><span class="line">HttpRequest.readline()</span><br><span class="line">HttpRequest.readlines()</span><br><span class="line">HttpRequest.xreadlines()</span><br><span class="line">HttpRequest.__iter__()</span><br></pre></td></tr></table></figure></form></p>
<p>è¿™å‡ ä¸ªæ–¹æ³•å®ç°ç±»æ–‡ä»¶çš„æ¥å£ç”¨äºè¯»å–HttpRequestÂ· å®ä¾‹</p>
<p><code>QueryDict</code>å¯¹è±¡<br>request.POST å’Œrequest.GET çš„QueryDict åœ¨ä¸€ä¸ªæ­£å¸¸çš„è¯·æ±‚/å“åº”å¾ªç¯ä¸­æ˜¯ä¸å¯å˜çš„ã€‚è‹¥è¦è·å¾—å¯å˜çš„ç‰ˆæœ¬ï¼Œéœ€è¦ä½¿ç”¨.copy()ã€‚</p>
<h2 id="TemplateResponse-å’ŒSimpleTemplateResponse"><a href="#TemplateResponse-å’ŒSimpleTemplateResponse" class="headerlink" title="TemplateResponse å’ŒSimpleTemplateResponse"></a><a href="http://python.usyiyi.cn/django/ref/template-response.html" target="_blank" rel="noopener">TemplateResponse å’ŒSimpleTemplateResponse</a></h2><p><code>SimpleTemplateResponse</code><br><code>TemplateResponse</code><br>TemplateResponse å¯¹è±¡å’Œæ™®é€šçš„django.http.HttpResponse ä¸€æ ·å¯ä»¥ç”¨äºä»»ä½•åœ°æ–¹ã€‚å®ƒå¯ä»¥ç”¨æ¥ä½œä¸ºrender() å’Œrender_to_response() çš„å¦å¤–ä¸€ç§é€‰æ‹©ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢è¿™ä¸ªç®€å•çš„è§†å›¾ä½¿ç”¨ä¸€ä¸ªç®€å•æ¨¡æ¿å’ŒåŒ…å«æŸ¥è¯¢é›†çš„ä¸Šä¸‹æ–‡è¿”å›ä¸€ä¸ªTemplateResponseï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.template.response <span class="keyword">import</span> TemplateResponse</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">blog_index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> TemplateResponse(request, <span class="string">'entry_list.html'</span>, &#123;<span class="string">'entries'</span>: Entry.objects.all()&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a><a href="http://python.usyiyi.cn/django/topics/http/file-uploads.html" target="_blank" rel="noopener">æ–‡ä»¶ä¸Šä¼ </a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_uploaded_file</span><span class="params">(f)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'some/file/name.txt'</span>, <span class="string">'wb+'</span>) <span class="keyword">as</span> destination:</span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> f.chunks():</span><br><span class="line">            destination.write(chunk)</span><br></pre></td></tr></table></figure>
<p>éå†UploadedFile.chunks()ï¼Œè€Œä¸æ˜¯ä½¿ç”¨read()ï¼Œèƒ½ç¡®ä¿å¤§æ–‡ä»¶å¹¶ä¸ä¼šå ç”¨ç³»ç»Ÿè¿‡å¤šçš„å†…å­˜ã€‚</p>
<p>ä¸Šä¼ å¤„ç†å™¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(&quot;django.core.files.uploadhandler.MemoryFileUploadHandler&quot;,</span><br><span class="line">&quot;django.core.files.uploadhandler.TemporaryFileUploadHandler&quot;,)</span><br></pre></td></tr></table></figure></p>
<p>MemoryFileUploadHandler å’ŒTemporaryFileUploadHandlerä¸€èµ·æä¾›äº†Djangoçš„é»˜è®¤æ–‡ä»¶ä¸Šä¼ è¡Œä¸ºï¼Œå°†å°æ–‡ä»¶è¯»å–åˆ°å†…å­˜ä¸­ï¼Œå¤§æ–‡ä»¶æ”¾ç½®åœ¨ç£ç›˜ä¸­ã€‚</p>
<p>ä½ å¯ä»¥ç¼–å†™è‡ªå®šä¹‰çš„å¤„ç†å™¨ï¼Œæ¥å®šåˆ¶Djangoå¦‚ä½•å¤„ç†æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å¤„ç†å™¨æ¥é™åˆ¶ç”¨æˆ·çº§åˆ«çš„é…é¢ï¼Œåœ¨è¿è¡Œä¸­å‹ç¼©æ•°æ®ï¼Œæ¸²æŸ“è¿›åº¦æ¡ï¼Œç”šè‡³æ˜¯å‘å¦ä¸€ä¸ªå‚¨å­˜ä½ç½®ç›´æ¥å‘é€æ•°æ®ï¼Œè€Œä¸æŠŠå®ƒå­˜åˆ°æœ¬åœ°ã€‚å…³äºå¦‚ä½•è‡ªå®šä¹‰æˆ–è€…å®Œå…¨æ›¿æ¢å¤„ç†å™¨çš„è¡Œä¸ºï¼Œè¯¦è§ç¼–å†™è‡ªå®šä¹‰çš„ä¸Šä¼ å¤„ç†å™¨ã€‚</p>
<p>æ›´æ”¹ä¸Šä¼ å¤„ç†å™¨çš„è¡Œä¸º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_FILE_STORAGE</span><br><span class="line">FILE_CHARSET</span><br><span class="line">FILE_UPLOAD_HANDLERS</span><br><span class="line">FILE_UPLOAD_MAX_MEMORY_SIZE</span><br><span class="line">FILE_UPLOAD_PERMISSIONS</span><br><span class="line">FILE_UPLOAD_TEMP_DIR</span><br><span class="line">MEDIA_ROOT</span><br><span class="line">MEDIA_URL</span><br></pre></td></tr></table></figure></p>
<p>åœ¨è¿è¡Œä¸­æ›´æ”¹ä¸Šä¼ å¤„ç†å™¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.upload_handlers.insert(0, ProgressBarUploadHandler())</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p> æ³¨æ„</p>
</blockquote>
<blockquote>
<p> ä½ åªå¯ä»¥åœ¨è®¿é—®request.POSTæˆ–è€…request.FILESä¹‹å‰ä¿®æ”¹ä¸Šä¼ å¤„ç†å™¨â€“ åœ¨ä¸Šä¼ å¤„ç†å·¥ä½œæ‰§è¡Œä¹‹åå†ä¿®æ”¹ä¸Šä¼ å¤„ç†å°±æ¯«æ— æ„ä¹‰äº†ã€‚å¦‚æœä½ åœ¨è¯»å–request.FILESä¹‹åå°è¯•ä¿®æ”¹request.upload_handlersï¼ŒDjangoä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
</blockquote>
<blockquote>
<p> æ‰€ä»¥ï¼Œä½ åº”è¯¥åœ¨ä½ çš„è§†å›¾ä¸­å°½æ—©ä¿®æ”¹ä¸Šä¼ å¤„ç†å™¨ã€‚</p>
</blockquote>
<blockquote>
<p> CsrfViewMiddleware ä¹Ÿä¼šè®¿é—®request.POSTï¼Œå®ƒæ˜¯é»˜è®¤å¼€å¯çš„ã€‚æ„æ€æ˜¯ä½ éœ€è¦åœ¨ä½ çš„è§†å›¾ä¸­ä½¿ç”¨csrf_exempt()ï¼Œæ¥å…è®¸ä½ ä¿®æ”¹ä¸Šä¼ å¤„ç†å™¨ã€‚æ¥ä¸‹æ¥åœ¨çœŸæ­£å¤„ç†è¯·æ±‚çš„å‡½æ•°ä¸­ï¼Œéœ€è¦ä½¿ç”¨csrf_protect()ã€‚æ³¨æ„è¿™æ„å‘³ç€å¤„ç†å™¨å¯èƒ½ä¼šåœ¨CSRFéªŒè¯å®Œæˆä¹‹å‰å¼€å§‹æ¥æ”¶ä¸Šä¼ æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
</blockquote>
<blockquote>
<figure class="highlight plain"><figcaption><span>django.views.decorators.csrf import csrf_exempt, csrf_protect </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@csrf_exempt</span><br><span class="line">def upload_file_view(request):</span><br><span class="line">    request.upload_handlers.insert(0, ProgressBarUploadHandler())</span><br><span class="line">    return _upload_file_view(request) </span><br><span class="line">@csrf_protect</span><br><span class="line">def _upload_file_view(request):</span><br><span class="line">    ... # Process request</span><br></pre></td></tr></table></figure>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## [Fileå¯¹è±¡](http://python.usyiyi.cn/django/ref/files/file.html)</span><br><span class="line">`File`ç±»</span><br><span class="line">`ContentFile`ç±»</span><br><span class="line">`ImageFile`ç±» æ¯”`File`å¤šäº†`width`å’Œ`height`å±æ€§</span><br><span class="line">é™„åŠ åˆ°å¯¹è±¡çš„æ–‡ä»¶æœ‰é¢å¤–çš„æ–¹æ³•</span><br></pre></td></tr></table></figure>
<p>File.save(name, content[, save=True])<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æä¾›æ–‡ä»¶åå’Œå†…å®¹ä¿å­˜ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œä¸ä¼šæ›¿æ¢å·²å­˜åœ¨æ–‡ä»¶ï¼Œä½†ä¼šåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¹¶ä¸”æ›´æ–°å¯¹è±¡æ¥æŒ‡å‘å®ƒã€‚</span><br><span class="line">æµ‹è¯•å‡ºæ¥ç›´æ¥`car.save()`ä¹Ÿä¸ä¼šè¦†ç›–å·²å­˜åœ¨æ–‡ä»¶ï¼Œå¦‚æœæœ‰é‡å†™ä¼šåœ¨åŸæœ‰åå­—åé¢åŠ å­—ç¬¦ä¸²</span><br><span class="line">å¦‚æœsaveä¸ºTrueï¼Œæ¨¡å‹çš„save()æ–¹æ³•ä¼šåœ¨æ–‡ä»¶ä¿å­˜ä¹‹åè°ƒç”¨ã€‚è¿™å°±æ˜¯è¯´ï¼Œä¸‹é¢ä¸¤è¡Œï¼š</span><br><span class="line">â€‹```python</span><br><span class="line">&gt;&gt;&gt; car.photo.save(&apos;myphoto.jpg&apos;, content, save=False)</span><br><span class="line">&gt;&gt;&gt; car.save()</span><br></pre></td></tr></table></figure></p>
<p>ç­‰ä»·äºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>car.photo.save(<span class="string">'myphoto.jpg'</span>, content, save=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<p>ä»æ¨¡å‹å®ä¾‹ä¸­ç§»é™¤æ–‡ä»¶ï¼Œå¹¶ä¸”åˆ é™¤å†…éƒ¨æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">File.delete([save=True])</span><br></pre></td></tr></table></figure></p>
<p>åœ¨é¡µé¢å±•ç¤ºä¸­ï¼Œ<code>ImageFile</code>è‡ªå¸¦çš„æ¸…é™¤å‹¾é€‰æ¡†å‹¾é€‰ååªæ˜¯æ¸…é™¤äº†æ•°æ®åº“ä¸­è¿™å…·å­—æ®µçš„å€¼ï¼Œå¹¶ä¸ä¼šåˆ é™¤æ–‡ä»¶ç³»ç»Ÿé‡Œå¯¹åº”çš„æ–‡ä»¶ï¼Œè€Œ<code>File.delete()</code>ä¼šåˆ é™¤æ–‡ä»¶ç³»ç»Ÿé‡Œçš„æ–‡ä»¶</p>
<h2 id="æ–‡ä»¶å‚¨å­˜API"><a href="#æ–‡ä»¶å‚¨å­˜API" class="headerlink" title="æ–‡ä»¶å‚¨å­˜API"></a><a href="http://python.usyiyi.cn/django/ref/files/storage.html" target="_blank" rel="noopener">æ–‡ä»¶å‚¨å­˜API</a></h2><p><code>DefaultStorage</code><br><code>FileSystemStorage</code><br><code>Storage</code></p>
<h2 id="ç®¡ç†æ–‡ä»¶"><a href="#ç®¡ç†æ–‡ä»¶" class="headerlink" title="ç®¡ç†æ–‡ä»¶"></a><a href="http://python.usyiyi.cn/django/topics/files.html" target="_blank" rel="noopener">ç®¡ç†æ–‡ä»¶</a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">255</span>)</span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">5</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    photo = models.ImageField(upload_to=<span class="string">'cars'</span>)</span><br></pre></td></tr></table></figure>
<p><code>photo</code>æœ‰ä»¥ä¸‹æ–¹æ³•<br><code>photo.path</code>ç›¸å¯¹è·¯å¾„<br><code>photo.url</code>ç»å¯¹è·¯å¾„</p>
<p><em>å®é™…æµ‹è¯•æœ‰å‡ºå…¥</em><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®˜æ–¹ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>car.photo.path</span><br><span class="line"><span class="string">'/media/cars/chevy.jpg'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>car.photo.url</span><br><span class="line"><span class="string">'http://media.example.com/cars/chevy.jpg'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®é™…æµ‹è¯•ç»“æœ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>car.photo.path</span><br><span class="line"><span class="string">'E:\workspace\parking\parking\upload\20151230171832_0.jpg'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>car.photo.url</span><br><span class="line"><span class="string">'/upload/20151230171832_0.jpg'</span></span><br></pre></td></tr></table></figure></p>
<p>æ›´æ”¹ä¸€ä¸ªæ–‡ä»¶çš„å­˜å‚¨ä½ç½®<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>initial_path = car.photo.path</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>car.photo.name = <span class="string">'cars/chevy_ii.jpg'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>new_path = settings.MEDIA_ROOT + car.photo.name</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Move the file on the filesystem</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.rename(initial_path, new_path)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>car.save()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>car.photo.path</span><br><span class="line"><span class="string">'/media/cars/chevy_ii.jpg'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>car.photo.path == new_path</span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure></p>
<h2 id="ç¼–å†™è‡ªå®šä¹‰å­˜å‚¨ç³»ç»Ÿ"><a href="#ç¼–å†™è‡ªå®šä¹‰å­˜å‚¨ç³»ç»Ÿ" class="headerlink" title="ç¼–å†™è‡ªå®šä¹‰å­˜å‚¨ç³»ç»Ÿ"></a><a href="http://python.usyiyi.cn/django/howto/custom-file-storage.html" target="_blank" rel="noopener">ç¼–å†™è‡ªå®šä¹‰å­˜å‚¨ç³»ç»Ÿ</a></h2><ol>
<li>å¿…é¡»æ˜¯<code>django.core.files.storage.Storage</code>çš„å­ç±»</li>
<li>Djangoå¿…é¡»èƒ½å¤Ÿä¸å¸¦ä»»ä½•å‚æ•°æ¥å®ä¾‹åŒ–</li>
<li>å¿…é¡»å®ç° _open() å’Œ _save()æ–¹æ³•ï¼Œä»¥åŠä»»ä½•é€‚åˆäºä½ çš„å‚¨å­˜ç±»çš„å…¶å®ƒæ–¹æ³•</li>
<li>ä½ çš„å‚¨å­˜ç±»å¿…é¡»æ˜¯ å¯ä»¥ææ„çš„ï¼Œæ‰€ä»¥å®ƒåœ¨è¿ç§»ä¸­çš„ä¸€ä¸ªå­—æ®µä¸Šä½¿ç”¨çš„æ—¶å€™å¯ä»¥è¢«åºåˆ—åŒ–ã€‚åªè¦ä½ çš„å­—æ®µæ‹¥æœ‰è‡ªå·±å¯ä»¥åºåˆ—åŒ–çš„å‚æ•°ï¼Œä½ å°±å¯ä»¥ä¸ºå®ƒä½¿ç”¨django.utils.deconstruct.deconstructibleç±»è£…é¥°å™¨ï¼ˆè¿™ä¹Ÿæ˜¯Djangoç”¨åœ¨FileSystemStorageä¸Šçš„ä¸œè¥¿ï¼‰</li>
</ol>
<h2 id="åŸºäºç±»çš„è§†å›¾"><a href="#åŸºäºç±»çš„è§†å›¾" class="headerlink" title="åŸºäºç±»çš„è§†å›¾"></a><a href="http://python.usyiyi.cn/django/topics/class-based-views/index.html" target="_blank" rel="noopener">åŸºäºç±»çš„è§†å›¾</a></h2><h2 id="åŸºäºç±»çš„å†…å»ºé€šç”¨è§†å›¾"><a href="#åŸºäºç±»çš„å†…å»ºé€šç”¨è§†å›¾" class="headerlink" title="åŸºäºç±»çš„å†…å»ºé€šç”¨è§†å›¾"></a><a href="http://python.usyiyi.cn/django/topics/class-based-views/generic-display.html" target="_blank" rel="noopener">åŸºäºç±»çš„å†…å»ºé€šç”¨è§†å›¾</a></h2><p><code>ListView</code>ç±»è§†å›¾ä¸­ï¼Œé»˜è®¤çš„å¯¹è±¡åˆ—è¡¨åé™¤äº†<code>object_list</code>ï¼Œè¿˜æœ‰ä¸€ä¸ª<code>&lt;model_name&gt;_list</code></p>
<h2 id="ä½¿ç”¨åŸºäºç±»çš„è§†å›¾å¤„ç†è¡¨å•"><a href="#ä½¿ç”¨åŸºäºç±»çš„è§†å›¾å¤„ç†è¡¨å•" class="headerlink" title="ä½¿ç”¨åŸºäºç±»çš„è§†å›¾å¤„ç†è¡¨å•"></a><a href="http://python.usyiyi.cn/django/topics/class-based-views/generic-editing.html" target="_blank" rel="noopener">ä½¿ç”¨åŸºäºç±»çš„è§†å›¾å¤„ç†è¡¨å•</a></h2><p>å¦‚æœå¯¹åº”æ¨¡å‹å­˜åœ¨<code>get_absolute_url</code>æ–¹æ³•çš„å‰æä¸‹<code>CreateView</code>å’Œ<code>UpdateView</code>ç±»è§†å›¾çš„<code>success_url</code>é»˜è®¤ä½¿ç”¨<code>get_absolute_url</code></p>
<p>å¦‚ä½•å®šä¹‰<code>form_class</code>ï¼Œå³ä½¿<code>form_class</code>æ˜¯<code>ModelForm</code>ä¹Ÿè¿˜æ˜¯éœ€è¦æŒ‡å®šæ¨¡å‹</p>
<p>å¦‚æœæ²¡æœ‰å®šä¹‰<code>form_class</code>ï¼Œåˆ™å¿…é¡»å®šä¹‰<code>fields</code>ï¼Œ<code>fields</code>å’Œ<code>form_class</code>ä¸èƒ½åŒæ—¶å­˜åœ¨</p>
<p>å¦‚æœæ¨¡å‹æŸä¸ªå­—æ®µå­˜çš„æ˜¯æ¨¡æ¿è·¯å¾„ï¼Œå¹¶ä¸”æƒ³é€šè¿‡æ­¤å­—æ®µæ¥åŠ¨æ€çš„æ§åˆ¶è¡¨å•é¡µçš„æ¨¡æ¿ï¼Œå¯é€šè¿‡<code>template_name_field</code>æ¥æŒ‡å®šæ­¤å­—æ®µã€‚</p>
<h2 id="Mixin"><a href="#Mixin" class="headerlink" title="Mixin"></a><a href="http://python.usyiyi.cn/django/topics/class-based-views/mixins.html" target="_blank" rel="noopener">Mixin</a></h2><h2 id="åŸºäºç±»çš„è§†å›¾çš„Mixin"><a href="#åŸºäºç±»çš„è§†å›¾çš„Mixin" class="headerlink" title="åŸºäºç±»çš„è§†å›¾çš„Mixin"></a><a href="http://python.usyiyi.cn/django/ref/class-based-views/mixins.html" target="_blank" rel="noopener">åŸºäºç±»çš„è§†å›¾çš„Mixin</a></h2><p><code>ContextMixin</code>æ‰€æœ‰åŸºäºç±»çš„é€šç”¨è§†å›¾çš„è¿™ä¸ªæ¨¡æ¿Context éƒ½åŒ…å«ä¸€ä¸ªview å˜é‡æŒ‡å‘è§†å›¾å®ä¾‹ã€‚</p>
<blockquote>
<p>Use alters_data where appropriate<br>æ³¨æ„ï¼Œå°†è§†å›¾å®ä¾‹åŒ…å«åœ¨æ¨¡æ¿Context ä¸­å¯èƒ½å°†æœ‰æ½œåœ¨å±é™©çš„æ–¹æ³•æš´éœ²ç»™æ¨¡æ¿ä½œè€…ã€‚ä¸ºäº†é¿å…åœ¨æ¨¡æ¿ä¸­è¢«è°ƒç”¨ç±»ä¼¼è¿™æ ·çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿™äº›æ–¹æ³•ä¸Šè®¾ç½®alters_data=Trueã€‚æ›´å¤šä¿¡æ¯ï¼Œå‚è§æ¸²æŸ“æ¨¡æ¿Context çš„æ–‡æ¡£ã€‚<br>å¾ˆæ˜¾ç„¶ï¼Œè°ƒç”¨æŸäº›å˜é‡ä¼šå¸¦æ¥å‰¯ä½œç”¨ï¼Œå…è®¸æ¨¡æ¿ç³»ç»Ÿè®¿é—®å®ƒä»¬å°†æ˜¯æ„šè ¢çš„è¿˜ä¼šå¸¦æ¥å®‰å…¨æ¼æ´ã€‚<br>    æ¯ä¸ªDjango æ¨¡å‹å¯¹è±¡çš„delete() æ–¹æ³•å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚æ¨¡æ¿ç³»ç»Ÿä¸åº”è¯¥å…è®¸ä¸‹é¢çš„è¡Œä¸ºï¼š<br>    I will now delete this valuable data. <br>    è®¾ç½®å¯è°ƒç”¨å˜é‡çš„alters_data å±æ€§å¯ä»¥é¿å…è¿™ç‚¹ã€‚å¦‚æœå˜é‡è®¾ç½®alters_data=True ï¼Œæ¨¡æ¿ç³»ç»Ÿå°†ä¸ä¼šè°ƒç”¨å®ƒï¼Œè€Œä¼šæ— æ¡ä»¶ä½¿ç”¨string_if_invalid æ›¿æ¢è¿™ä¸ªå˜é‡ã€‚Django æ¨¡å‹å¯¹è±¡è‡ªåŠ¨ç”Ÿæˆçš„delete() å’Œsave() æ–¹æ³•è‡ªåŠ¨ è®¾ç½®alters_data=Trueã€‚ ä¾‹å¦‚ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sensitive_function</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.database_record.delete()</span><br><span class="line">    sensitive_function.alters_data = <span class="keyword">True</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>æœ‰æ—¶å€™ï¼Œå¤„äºæŸäº›åŸå› ä½ å¯èƒ½æƒ³å…³é—­è¿™ä¸ªåŠŸèƒ½ï¼Œå¹¶å‘Šè¯‰æ¨¡æ¿ç³»ç»Ÿæ— è®ºä»€ä¹ˆæƒ…å†µä¸‹éƒ½ä¸è¦è°ƒç”¨å˜é‡ã€‚è®¾ç½®å¯è°ƒç”¨å¯¹è±¡çš„do_not_call_in_templates å±æ€§çš„å€¼ä¸ºTrue å¯ä»¥å®ç°è¿™ç‚¹ã€‚æ¨¡æ¿ç³»ç»Ÿçš„è¡Œä¸ºå°†ç±»ä¼¼è¿™ä¸ªå˜é‡æ˜¯ä¸å¯è°ƒç”¨çš„ï¼ˆä¾‹å¦‚ï¼Œä½ å¯ä»¥è®¿é—®å¯è°ƒç”¨å¯¹è±¡çš„å±æ€§ï¼‰ã€‚<br><code>query_pk_and_slug</code>å¦‚æœä¸º<code>True</code>,<code>get_object()</code>å°†ä½¿ç”¨ä¸¤è€…ä¸€èµ·æ¥æŸ¥æ‰¾ã€‚å¯ä»¥é˜²æ­¢åªä½¿ç”¨<code>pk</code>æ—¶ï¼Œå¦‚æœ<code>pk</code>è¿ç»­ï¼Œç›´æ¥è¢«æ”»å‡»è€…éƒ½éå†<code>pk</code>è·å–æ•´ä¸ªåˆ—è¡¨</p>
</blockquote>
<h2 id="å†…å»ºåŸºäºç±»çš„è§†å›¾çš„API"><a href="#å†…å»ºåŸºäºç±»çš„è§†å›¾çš„API" class="headerlink" title="å†…å»ºåŸºäºç±»çš„è§†å›¾çš„API"></a><a href="http://python.usyiyi.cn/django/ref/class-based-views/index.html" target="_blank" rel="noopener">å†…å»ºåŸºäºç±»çš„è§†å›¾çš„API</a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^view/$'</span>, MyView.as_view(size=<span class="number">42</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è§†å›¾å‚æ•°çš„çº¿ç¨‹å®‰å…¨æ€§<br>ä¼ é€’ç»™è§†å›¾çš„å‚æ•°åœ¨è§†å›¾çš„æ¯ä¸ªå®ä¾‹ä¹‹é—´å…±äº«ã€‚è¿™è¡¨ç¤ºä¸åº”è¯¥ä½¿ç”¨åˆ—è¡¨ã€å­—å…¸æˆ–å…¶å®ƒå¯å˜å¯¹è±¡ä½œä¸ºè§†å›¾çš„å‚æ•°ã€‚å¦‚æœä½ çœŸè¿™ä¹ˆåšè€Œä¸”å¯¹å…±äº«çš„å¯¹è±¡åšè¿‡ä¿®æ”¹ï¼ŒæŸä¸ªç”¨æˆ·çš„è¡Œä¸ºå¯èƒ½å¯¹åé¢è®¿é—®åŒä¸€ä¸ªè§†å›¾çš„ç”¨æˆ·äº§ç”Ÿå½±å“ã€‚</p>
</blockquote>
<h2 id="åŸºäºç±»çš„é€šç”¨è§†å›¾-â€”â€”-ç´¢å¼•"><a href="#åŸºäºç±»çš„é€šç”¨è§†å›¾-â€”â€”-ç´¢å¼•" class="headerlink" title="åŸºäºç±»çš„é€šç”¨è§†å›¾ â€”â€” ç´¢å¼•"></a><a href="http://python.usyiyi.cn/django/ref/class-based-views/flattened-index.html" target="_blank" rel="noopener">åŸºäºç±»çš„é€šç”¨è§†å›¾ â€”â€” ç´¢å¼•</a></h2><h2 id="ä½¿ç”¨Djangoè¾“å‡ºCSV"><a href="#ä½¿ç”¨Djangoè¾“å‡ºCSV" class="headerlink" title="ä½¿ç”¨Djangoè¾“å‡ºCSV"></a><a href="http://python.usyiyi.cn/django/howto/outputting-csv.html" target="_blank" rel="noopener">ä½¿ç”¨Djangoè¾“å‡ºCSV</a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># Create the HttpResponse object with the appropriate CSV header.</span></span><br><span class="line">    response = HttpResponse(content_type=<span class="string">'text/csv'</span>)</span><br><span class="line">    response[<span class="string">'Content-Disposition'</span>] = <span class="string">'attachment; filename="somefilename.csv"'</span></span><br><span class="line"> </span><br><span class="line">    writer = csv.writer(response)</span><br><span class="line">    writer.writerow([<span class="string">'First row'</span>, <span class="string">'Foo'</span>, <span class="string">'Bar'</span>, <span class="string">'Baz'</span>])</span><br><span class="line">    writer.writerow([<span class="string">'Second row'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'"Testing"'</span>, <span class="string">"Here's a quote"</span>])</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨Djangoè¾“å‡ºPDF"><a href="#ä½¿ç”¨Djangoè¾“å‡ºPDF" class="headerlink" title="ä½¿ç”¨Djangoè¾“å‡ºPDF"></a><a href="http://python.usyiyi.cn/django/howto/outputting-pdf.html" target="_blank" rel="noopener">ä½¿ç”¨Djangoè¾“å‡ºPDF</a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> reportlab.pdfgen <span class="keyword">import</span> canvas</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># Create the HttpResponse object with the appropriate PDF headers.</span></span><br><span class="line">    response = HttpResponse(content_type=<span class="string">'application/pdf'</span>)</span><br><span class="line">    response[<span class="string">'Content-Disposition'</span>] = <span class="string">'attachment; filename="somefilename.pdf"'</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Create the PDF object, using the response object as its "file."</span></span><br><span class="line">    p = canvas.Canvas(response)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Draw things on the PDF. Here's where the PDF generation happens.</span></span><br><span class="line">    <span class="comment"># See the ReportLab documentation for the full list of functionality.</span></span><br><span class="line">    p.drawString(<span class="number">100</span>, <span class="number">100</span>, <span class="string">"Hello world."</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Close the PDF object cleanly, and we're done.</span></span><br><span class="line">    p.showPage()</span><br><span class="line">    p.save()</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a><a href="http://python.usyiyi.cn/django/topics/http/middleware.html" target="_blank" rel="noopener">ä¸­é—´ä»¶</a></h2><p>ä¸­é—´ä»¶çš„é¡ºåºå¾ˆé‡è¦<br>æ¥å—è¯·æ±‚æ—¶ï¼Œè‡ªä¸Šå‘ä¸‹è°ƒç”¨ä¸­é—´ä»¶<br>è¿”å›å“åº”æ—¶ï¼Œè‡ªä¸‹å‘ä¸Šè°ƒç”¨ä¸­é—´ä»¶<br><code>process_request(request)</code><br>åœ¨djangoå†³å®šæ‰§è¡Œå“ªä¸ªè§†å›¾ä¹‹å‰ï¼ˆä¹Ÿå°±æ˜¯è§£æurlä¹‹å‰ï¼‰è¢«è°ƒç”¨<br>è¿”å›<code>None</code>ç»§ç»­å¤„ç†è¯·æ±‚<br>è¿”å›<code>HttpResponse</code>ä¸å†å»è°ƒç”¨å…¶å®ƒçš„requestã€view æˆ–exception ä¸­é—´ä»¶ï¼Œæˆ–å¯¹åº”çš„è§†å›¾ï¼Œç›´æ¥è°ƒç”¨å“åº”é˜¶æ®µçš„ä¸­é—´ä»¶ï¼Œå¹¶è¿”å›ç»“æœ</p>
<p><code>process_view(request, view_func, view_args, view_kwargs)</code><br><em>æ³¨ï¼š<code>view_args</code>å’Œ<code>view_kwargs</code>éƒ½ä¸åŒ…å«<code>request</code></em><br>åœ¨djangoè°ƒç”¨è§†å›¾ä¹‹å‰è¢«è°ƒç”¨<br>è¿”å›<code>None</code>ç»§ç»­å¤„ç†è¯·æ±‚<br>è¿”å›<code>HttpResponse</code>ä¸å†å»è°ƒç”¨å…¶å®ƒçš„view æˆ–exception ä¸­é—´ä»¶ï¼Œæˆ–å¯¹åº”çš„è§†å›¾ï¼Œç›´æ¥è°ƒç”¨å“åº”é˜¶æ®µçš„ä¸­é—´ä»¶ï¼Œå¹¶è¿”å›ç»“æœ</p>
<blockquote>
<p>æ³¨æ„<br>åœ¨ä¸­é—´ä»¶å†…éƒ¨ï¼Œä»process_request æˆ–process_view ä¸­è®¿é—®request.POST æˆ–request.REQUEST å°†é˜»ç¢è¯¥ä¸­é—´ä»¶ä¹‹åçš„æ‰€æœ‰è§†å›¾æ— æ³•ä¿®æ”¹è¯·æ±‚çš„ä¸Šä¼ å¤„ç†ç¨‹åºï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¦é¿å…è¿™æ ·ä½¿ç”¨ã€‚<br>ç±»CsrfViewMiddlewareå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸ªä¾‹å¤–ï¼Œå› ä¸ºå®ƒæä¾›csrf_exempt() å’Œcsrf_protect()ä¸¤ä¸ªè£…é¥°å™¨ï¼Œå…è®¸è§†å›¾æ˜¾å¼æ§åˆ¶åœ¨å“ªä¸ªç‚¹éœ€è¦å¼€å¯CSRFéªŒè¯ã€‚</p>
</blockquote>
<p><code>process_template_response(request, response)</code><br>åœ¨è§†å›¾åˆšå¥½æ‰§è¡Œå®Œæ¯•ä¹‹åè¢«è°ƒç”¨<br>å¿…é¡»è¿”å›ä¸€ä¸ªå®ç°äº†<code>render</code>æ–¹æ³•çš„å“åº”å¯¹è±¡</p>
<p><code>process_response(request, response)</code><br>åœ¨æ‰€æœ‰å“åº”è¿”å›æµè§ˆå™¨ä¹‹å‰è¢«è°ƒç”¨<br>å¿…é¡»è¿”å›<code>HttpResponse</code>æˆ–è€…<code>StreamingHttpResponse</code>å¯¹è±¡<br><strong><em><a href="http://python.usyiyi.cn/django/topics/http/middleware.html#dealing-with-streaming-responses" target="_blank" rel="noopener">å¤„ç†æµå¼å“åº”</a></em></strong></p>
<p><code>process_exception(request, exception)</code><br>åœ¨è§†å›¾æŠ›å‡ºå¼‚å¸¸æ—¶è¢«è°ƒç”¨<br>è¿”å›<code>None</code><br>è¿”å›<code>HttpResponse</code> <code>process_template_response</code>å’Œå“åº”ä¸­é—´ä»¶ä¼šè¢«è°ƒç”¨<br><strong>åœ¨å¤„ç†å“åº”æœŸé—´ï¼Œä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯å€’åºæ‰§è¡Œçš„ï¼Œè¿™åŒ…æ‹¬process_exceptionï¼Œå¦‚æœä¸€ä¸ªä¸­é—´ä»¶çš„<code>process_exception</code>è¿”å›äº†ä¸€ä¸ªå“åº”ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸­é—´ä»¶ä¸Šé¢çš„ä¸­é—´ä»¶ä¸­çš„<code>process_exception</code>éƒ½ä¸ä¼šè¢«è°ƒç”¨</strong></p>
<p><code>__init__()</code><br>å¤§å¤šæ•°ä¸­é—´ä»¶ç±»éƒ½ä¸éœ€è¦åˆå§‹åŒ–æ–¹æ³•<br>djangoåˆå§‹åŒ–ä¸­é—´ä»¶æ— éœ€ä»»ä½•å‚æ•°ï¼Œæ‰€ä»¥ä¸èƒ½å®šä¹‰ä¸€ä¸ªæœ‰å‚æ•°çš„<code>__init__æ–¹æ³•</code><strong>init</strong><code>ä¸ä¼šæ¯æ¬¡è¯·æ±‚éƒ½æ‰§è¡Œï¼Œåªåœ¨WebæœåŠ¡å™¨å“åº”ç¬¬ä¸€ä¸ªè¯·æ±‚æ—¶æ‰§è¡Œ
æ ‡è®°ä¸­é—´ä»¶ä¸è¢«ä½¿ç”¨</code><strong>init</strong><code>æŠ›å‡º</code>django.core.exceptions.MiddlewareNotUsed`å¼‚å¸¸ï¼Œdjangoä¼šä»ä¸­é—´ä»¶å¤„ç†è¿‡ç¨‹ä¸­ç§»åŠ¨è¿™éƒ¨åˆ†ä¸­é—´ä»¶ï¼Œå¹¶ä¸”å½“DEBUGä¸ºTrueçš„æ—¶å€™åœ¨django.requestè®°å½•å™¨ä¸­è®°å½•è°ƒè¯•ä¿¡æ¯ã€‚</p>
<ul>
<li>ä¸­é—´ä»¶ç±»ä¸èƒ½æ˜¯ä»»ä½•ç±»çš„å­ç±»</li>
<li>ä¸­é—´ä»¶å¯ä»¥æ”¾åœ¨pythonè·¯å¾„ä¸­çš„ä»»åŠ¡ä½ç½®<br>æ­£å¸¸<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">A.init</span><br><span class="line">B.init</span><br><span class="line">C.init</span><br><span class="line">D.init</span><br><span class="line">A.process_request</span><br><span class="line">B.process_request</span><br><span class="line">C.process_request</span><br><span class="line">D.process_request</span><br><span class="line">A.process_view</span><br><span class="line">B.process_view</span><br><span class="line">C.process_view</span><br><span class="line">D.process_view</span><br><span class="line"> </span><br><span class="line">D.process_template_response</span><br><span class="line">C.process_template_response</span><br><span class="line">B.process_template_response</span><br><span class="line">A.process_template_response</span><br><span class="line">D.process_responst</span><br><span class="line">C.process_responst</span><br><span class="line">B.process_responst</span><br><span class="line">A.process_responst</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è§†å›¾å¼‚å¸¸<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">A.init</span><br><span class="line">B.init</span><br><span class="line">C.init</span><br><span class="line">D.init</span><br><span class="line">A.process_request</span><br><span class="line">B.process_request</span><br><span class="line">C.process_request</span><br><span class="line">D.process_request</span><br><span class="line">A.process_view</span><br><span class="line">B.process_view</span><br><span class="line">C.process_view</span><br><span class="line">D.process_view</span><br><span class="line"></span><br><span class="line">D.process_responst</span><br><span class="line">C.process_responst</span><br><span class="line">B.process_responst</span><br><span class="line">A.process_responst</span><br></pre></td></tr></table></figure></p>
<h2 id="djangoä¸­å¯ç”¨çš„ä¸­é—´ä»¶"><a href="#djangoä¸­å¯ç”¨çš„ä¸­é—´ä»¶" class="headerlink" title="djangoä¸­å¯ç”¨çš„ä¸­é—´ä»¶"></a><a href="http://python.usyiyi.cn/django/ref/middleware.html#middleware-ordering" target="_blank" rel="noopener">djangoä¸­å¯ç”¨çš„ä¸­é—´ä»¶</a></h2><h3 id="class-CommonMiddleware"><a href="#class-CommonMiddleware" class="headerlink" title="class CommonMiddleware"></a><code>class CommonMiddleware</code></h3><p><code>DISALLOWED_USER_AGENTS</code>ç¦ç”¨åŒ¹é…çš„<code>user-agents</code>è®¿é—®ç½‘ç«™<br><code>APPEND_SLASH</code>å¦‚æœurlç»“å°¾æ²¡æœ‰æ–œæ ç»“å°¾ï¼Œå¹¶ä¸”æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„urlï¼Œdjangoä¼šåœ¨ç»“å°¾åŠ ä¸Šæ–œæ å†åŒ¹é…ä¸€æ¬¡<br><code>PREPEND_WWW</code>å¦‚æœurlä¼šé‡å®šå‘åˆ°wwwåˆ°å¤´çš„ç½‘å€<br><code>USE_ETAGS</code>è®¾ç½®æ¥å¤„ç†ETagã€‚å¦‚æœè®¾ç½®USE_ETAGSä¸ºTrueï¼ŒDjangoä¼šé€šè¿‡MD5-hashingå¤„ç†é¡µé¢çš„å†…å®¹æ¥ä¸ºæ¯ä¸€ä¸ªé¡µé¢è¯·æ±‚è®¡ç®—Etagï¼Œå¹¶ä¸”å¦‚æœåˆé€‚çš„è¯ï¼Œå®ƒå°†ä¼šå‘é€æºå¸¦Not Modifiedçš„å“åº”ã€‚</p>
<h3 id="class-BrokenLinkEmailsMiddleware"><a href="#class-BrokenLinkEmailsMiddleware" class="headerlink" title="class BrokenLinkEmailsMiddleware"></a><code>class BrokenLinkEmailsMiddleware</code></h3><p>å‘<code>MANAGERS</code> å‘é€æ­»é“¾æé†’é‚®ä»¶</p>
<h3 id="class-GZipMiddleware"><a href="#class-GZipMiddleware" class="headerlink" title="class GZipMiddleware"></a><code>class GZipMiddleware</code></h3><p>ä¸ºæ”¯æŒ<code>GZip</code>å‹ç¼©çš„æµè§ˆå™¨å‹ç¼©å†…å®¹<br>å»ºè®®æ”¾åœ¨ä¸­é—´ä»¶é…ç½®åˆ—è¡¨çš„ç¬¬ä¸€ä¸ª<br>å¯é€šè¿‡<code>gzip_page()</code>è£…é¥°å™¨ä½¿ç”¨ç‹¬ç«‹çš„<code>GZip</code>å‹ç¼©</p>
<h3 id="class-ConditionalGetMiddleware"><a href="#class-ConditionalGetMiddleware" class="headerlink" title="class ConditionalGetMiddleware"></a><code>class ConditionalGetMiddleware</code></h3><h3 id="class-LocaleMiddeware"><a href="#class-LocaleMiddeware" class="headerlink" title="class LocaleMiddeware"></a><code>class LocaleMiddeware</code></h3><p>åŸºäºè¯·æ±‚ä¸­çš„æ•°æ®å¼€å¯è¯­è¨€é€‰æ‹©ï¼Œå®ƒå¯ä»¥ä¸ºæ¯ä¸ªç”¨æˆ·è¿›è¡Œå®šåˆ¶ã€‚</p>
<h3 id="class-MessageMiddleware"><a href="#class-MessageMiddleware" class="headerlink" title="class MessageMiddleware"></a><code>class MessageMiddleware</code></h3><p>å¼€å¯åŸºäº<code>Cookie</code>å’Œä¼šè¯çš„æ¶ˆæ¯æ”¯æŒ</p>
<h3 id="class-SecurityMiddleware"><a href="#class-SecurityMiddleware" class="headerlink" title="class SecurityMiddleware"></a><code>class SecurityMiddleware</code></h3><p><a href="http://python.usyiyi.cn/django/ref/middleware.html#middleware-ordering" target="_blank" rel="noopener">ä¸­é—´ä»¶çš„æ’åº</a></p>
<h2 id="æ¨¡ç‰ˆ"><a href="#æ¨¡ç‰ˆ" class="headerlink" title="æ¨¡ç‰ˆ"></a><a href="http://python.usyiyi.cn/django/topics/templates.html" target="_blank" rel="noopener">æ¨¡ç‰ˆ</a></h2><p><code>DjangoTemplates</code>å¼•æ“<code>OPTIONS</code>é…ç½®é¡¹ä¸­æ¥å—ä»¥ä¸‹å‚æ•°<br><code>string_if_invalid</code>å½“æ¨¡ç‰ˆå˜é‡æ— æ•ˆæ—¶ï¼Œä½¿ç”¨æ­¤å€¼ä»£æ›¿<br>å¯ä½¿ç”¨<br>comment<br>å’Œ<br>endcomment<br>è¿›è¡Œå¤šè¡Œæ³¨é‡Š</p>
<h2 id="Djangoæ¨¡ç‰ˆè¯­è¨€"><a href="#Djangoæ¨¡ç‰ˆè¯­è¨€" class="headerlink" title="Djangoæ¨¡ç‰ˆè¯­è¨€"></a><a href="http://python.usyiyi.cn/django/ref/templates/language.html" target="_blank" rel="noopener">Djangoæ¨¡ç‰ˆè¯­è¨€</a></h2><p>å½“æ¨¡ç‰ˆç³»ç»Ÿé‡åˆ°<code>.</code>æ—¶ï¼ŒæŒ‰ä¸‹é¢é¡ºåºæŸ¥è¯¢<br>ä»æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œå½“æ¨¡ç‰ˆç³»ç»Ÿé‡åˆ°ç‚¹(â€œ.â€)ï¼Œå®ƒå°†ä»¥è¿™æ ·çš„é¡ºåºæŸ¥è¯¢ï¼š</p>
<ul>
<li>å­—å…¸æŸ¥è¯¢ï¼ˆDictionary lookupï¼‰</li>
<li>å±æ€§æˆ–æ–¹æ³•æŸ¥è¯¢ï¼ˆAttribute or method lookupï¼‰</li>
<li>æ•°å­—ç´¢å¼•æŸ¥è¯¢ï¼ˆNumeric index lookupï¼‰</li>
</ul>
<p>æ¨¡ç‰ˆå˜é‡æœ€ç»ˆè§£é‡Šæˆå­—é¢é‡ï¼Œè€Œä¸æ˜¯å˜é‡å€¼</p>
<p>load<br>å¯æ¥å—å¤šä¸ªåº“åç§°<br>load humanize i18n<br>load<br>ä¸æ”¯æŒç»§æ‰¿</p>
<h2 id="å†…ç½®æ ‡ç­¾ä¸è¿‡æ»¤å™¨"><a href="#å†…ç½®æ ‡ç­¾ä¸è¿‡æ»¤å™¨" class="headerlink" title="å†…ç½®æ ‡ç­¾ä¸è¿‡æ»¤å™¨"></a><a href="http://python.usyiyi.cn/django/ref/templates/builtins.html" target="_blank" rel="noopener">å†…ç½®æ ‡ç­¾ä¸è¿‡æ»¤å™¨</a></h2><h3 id="æ ‡ç­¾"><a href="#æ ‡ç­¾" class="headerlink" title="æ ‡ç­¾"></a>æ ‡ç­¾</h3><p><code>filter</code>å¯¹ä¸€æ®µå†…å®¹è¿›è¡Œè¿‡æ»¤ï¼Œä½¿ç”¨<code>|</code>å¯¹å¤šä¸ªè¿‡æ»¤å™¨è¿›è¡Œè¿æ¥ï¼Œä¸”è¿‡æ»¤å™¨å¯ä»¥æœ‰å‚æ•°<br><em>æ¯”å¦‚ä¸€æ®µçº¯æ–‡æœ¬ä¸èƒ½ä½¿ç”¨ä¹‹å‰è¯´çš„è¿‡æ»¤å™¨å†™æ³•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>filter</code></em><br><code>firstof</code>è¾“å‡ºç¬¬ä¸€ä¸ªä¸ä¸º<code>False</code>çš„å‚æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% firstof var1 var2|safe var3 &quot;&lt;strong&gt;fallback value&lt;/strong&gt;&quot;|safe %&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>ifchanged</code>æ£€æŸ¥å¾ªç¯ä¸­çš„ä¸€ä¸ªå€¼ä»æœ€è¿‘ä¸€æ¬¡é‡å¤å…¶æ˜¯å¦æ”¹å˜ï¼Œæ”¯æŒ`else</p>
<p><code>with</code>å¯å¾€<code>include</code>çš„æ¨¡ç‰ˆé‡Œä¼ ä¸Šä¸‹æ–‡ä»¶å˜é‡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &quot;name_snippet.html&quot; with person=&quot;Jane&quot; greeting=&quot;Hello&quot; %&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &quot;name_snippet.html&quot; with greeting=&quot;Hi&quot; only %&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% lorem %&#125;</span><br></pre></td></tr></table></figure>
<p>è®¾è®¡äººå‘˜å·¥å…·ï¼Œå¥½åƒæ˜¯ç”Ÿæˆéšæœºå•è¯å’Œæ®µè½<br><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name">lorem</span> %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name">lorem</span> 3 p  %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name">lorem</span> 10 w random %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure></p>
<h2 id="äººæ€§åŒ–"><a href="#äººæ€§åŒ–" class="headerlink" title="äººæ€§åŒ–"></a><a href="http://python.usyiyi.cn/django/ref/contrib/humanize.html" target="_blank" rel="noopener">äººæ€§åŒ–</a></h2><p><code>apnumber</code>è½¬æ¢æ•´æ•°æˆ–æ•´æ•°çš„å­—ç¬¦ä¸²å½¢å¼ä¸ºè‹±æ–‡æè¿°<br>1 ä¼šå˜æˆone<br><code>intcomma</code>è½¬æ¢æˆç¬¬ä¸‰ä½å¸¦ä¸€ä¸ªé€—å·<br>4500 ä¼šå˜æˆ 4,500<br><code>intword</code>å°†å¤§çš„æ•´æ•°è½¬æ¢ä¸ºå‹å¥½çš„æ–‡å­—è¡¨ç¤º<br>1000000 ä¼šå˜æˆ 1.0 million<br><code>naturalday</code>å¯¹äºå½“å¤©æˆ–è€…ä¸€å¤©ä¹‹å†…çš„æ—¥æœŸï¼Œ è¿”å›â€œä»Šå¤©â€ï¼Œâ€œæ˜å¤©â€æˆ–è€…â€œæ˜¨å¤©â€ï¼Œè§†æƒ…å†µè€Œå®šã€‚å¦åˆ™ï¼Œä½¿ç”¨ä¼ è¿›æ¥çš„æ ¼å¼å­—ç¬¦ä¸²ç»™æ—¥æœŸæ ¼å¼åŒ–<br><code>naturaltime</code>å¯¹äºæ—¥æœŸæ—¶é—´çš„å€¼ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ¥è¡¨ç¤ºå¤šå°‘ç§’ã€åˆ†é’Ÿæˆ–è€…å°æ—¶ä¹‹å‰<br>ä¾‹å¦‚ï¼ˆå…¶ä¸­â€œç°åœ¨â€æ˜¯2007å¹´2æœˆ17æ—¥16æ—¶30åˆ†0ç§’ï¼‰ï¼š<br>17 Feb 2007 16:30:00 ä¼šå˜æˆ now<br>17 Feb 2007 16:29:31 ä¼šå˜æˆ 29 seconds ago<br><code>ordinal</code>å°†ä¸€ä¸ªæ•´æ•°æˆ–æ˜¯æ•´æ•°çš„å­—ç¬¦ä¸²ï¼Œè½¬æ¢ä¸ºå®ƒçš„åºæ•°è¯<br>1 ä¼šå˜æˆ 1st<br>2 ä¼šå˜æˆ  2nd<br>3 ä¼šå˜æˆ  3rd</p>
<h2 id="Django-æ¨¡æ¿è¯­è¨€ï¼šé¢å‘Pythonç¨‹åºå‘˜"><a href="#Django-æ¨¡æ¿è¯­è¨€ï¼šé¢å‘Pythonç¨‹åºå‘˜" class="headerlink" title="Django æ¨¡æ¿è¯­è¨€ï¼šé¢å‘Pythonç¨‹åºå‘˜"></a><a href="http://python.usyiyi.cn/django/ref/templates/api.html" target="_blank" rel="noopener">Django æ¨¡æ¿è¯­è¨€ï¼šé¢å‘Pythonç¨‹åºå‘˜</a></h2><p><code>string_if_invalid</code>å»ºè®®åªåœ¨è°ƒè¯•æ—¶è®¾ç½®ï¼Œè°ƒè¯•å®Œæˆåå°±å…³é—­ï¼Œå¼€å‘æ—¶æœ€å¥½ä¸è¦ä½¿ç”¨ï¼Œä¸ç„¶å¯èƒ½ä¼šé‡åˆ°æ¸²æŸ“é—®é¢˜</p>
<p>æ¯ä¸ªä¸Šä¸‹æ–‡éƒ½åŒ…å«<code>True</code> <code>False</code> <code>None</code></p>
<h3 id="ä½¿ç”¨Contextå¯¹è±¡"><a href="#ä½¿ç”¨Contextå¯¹è±¡" class="headerlink" title="[ä½¿ç”¨Contextå¯¹è±¡]"></a>[ä½¿ç”¨<code>Context</code>å¯¹è±¡]</h3><p><em><a href="http://python.usyiyi.cn/django/ref/templates/api.html#playing-with-context-objects" target="_blank" rel="noopener">è¿™é‡Œæ¯”è¾ƒéš¾ç†è§£</a></em><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Context.get(key, otherwise=<span class="keyword">None</span>)</span><br><span class="line">Context.pop()</span><br><span class="line">Context.push()</span><br><span class="line">Context.update(other_dict)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>ä¸Šä¸‹æ–‡å¤„ç†å™¨åº”ç”¨çš„æ—¶æœº<br>ä¸Šä¸‹æ–‡å¤„ç†å™¨åº”ç”¨åœ¨ä¸Šä¸‹æ–‡æ•°æ®çš„é¡¶ç«¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šä¸‹æ–‡å¤„ç†å™¨å¯èƒ½è¦†ç›–ä½ æä¾›ç»™Context æˆ–RequestContext çš„å˜é‡ï¼Œæ‰€ä»¥è¦æ³¨æ„é¿å…ä¸ä¸Šä¸‹æ–‡å¤„ç†å™¨æä¾›çš„å˜é‡åé‡å¤ã€‚<br>å¦‚æœæƒ³è¦ä¸Šä¸‹æ–‡æ•°æ®çš„ä¼˜å…ˆçº§é«˜äºä¸Šä¸‹æ–‡å¤„ç†å™¨ï¼Œä½¿ç”¨ä¸‹é¢çš„æ¨¡å¼ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">from</span> django.template <span class="keyword">import</span> RequestContext</span><br><span class="line">&gt; request_context = RequestContext(request)</span><br><span class="line">&gt; request_context.push(&#123;<span class="string">"my_name"</span>: <span class="string">"Adrian"</span>&#125;)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Django é€šè¿‡è¿™ç§æ–¹å¼å…è®¸ä¸Šä¸‹æ–‡æ•°æ®åœ¨render() å’Œ TemplateResponse ç­‰API ä¸­è¦†ç›–ä¸Šä¸‹æ–‡å¤„ç†å™¨ã€‚</span><br><span class="line">ä½ è¿˜å¯ä»¥èµ‹äºˆ`RequestContext `ä¸€ä¸ªé¢å¤–çš„å¤„ç†å™¨åˆ—è¡¨ï¼Œä½¿ç”¨ç¬¬ä¸‰ä¸ªå¯é€‰çš„ä½ç½®å‚æ•°processorsã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒRequestContext å®ä¾‹è·å¾—ä¸€ä¸ªip_address å˜é‡</span><br><span class="line">â€‹```python</span><br><span class="line">def some_view(request):</span><br><span class="line">    # ...</span><br><span class="line">    c = RequestContext(request, &#123;</span><br><span class="line">        &apos;foo&apos;: &apos;bar&apos;,</span><br><span class="line">    &#125;, [&apos;ip_address&apos;:&apos;127.0.0.1&apos;])</span><br><span class="line">    return HttpResponse(t.render(c))</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¾‹å­ä¸­<code>ip_address</code>ä¹Ÿä¼šåŠ å…¥åˆ°ä¸Šä¸‹æ–‡ä¸­</p>
<h3 id="å†…å»ºçš„æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨"><a href="#å†…å»ºçš„æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨" class="headerlink" title="å†…å»ºçš„æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨"></a>å†…å»ºçš„æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨</h3><p>ä¸‹é¢æ˜¯å†…å¥¸çš„ä¸Šä¸‹æ–‡å¤„ç†å™¨æ‰€æ·»åŠ çš„å†…å®¹<br><code>django.contrib.auth.context_processors.auth</code></p>
<ul>
<li><code>user</code></li>
<li><code>perms</code></li>
</ul>
<p><code>django.template.context_processors.debug</code></p>
<ul>
<li>debug</li>
<li>sql_queryes<br>ä¸€ä¸ª{â€˜sqlâ€™: â€¦, â€˜timeâ€™: â€¦} å­—å…¸çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºè¯·æ±‚æœŸé—´åˆ°ç›®å‰ä¸ºæ­¢å‘ç”Ÿçš„æ¯ä¸ªSQL æŸ¥è¯¢åŠèŠ±è´¹çš„æ—¶é—´ã€‚è¿™ä¸ªåˆ—è¡¨æŒ‰æŸ¥è¯¢çš„é¡ºåºæ’åºï¼Œå¹¶ç›´åˆ°è®¿é—®æ—¶æ‰ç”Ÿæˆã€‚</li>
</ul>
<p><code>django.template.context_processors.i18n</code></p>
<ul>
<li><code>MEDIA_URL</code></li>
</ul>
<p><code>django.template.context_processors.static</code></p>
<ul>
<li><code>STATIC_URL</code></li>
</ul>
<p><code>django.template.context_processors.csrf</code></p>
<ul>
<li><code>csrf_token</code></li>
</ul>
<p><code>django.template.context_processors.request</code></p>
<ul>
<li><code>request</code></li>
</ul>
<p><code>django.contrib.messages.context_processors.messages</code></p>
<ul>
<li><code>messages</code></li>
<li><code>DEFAULT_MESSAGE_LEVELS</code></li>
</ul>
<h2 id="è‡ªå®šä¹‰æ¨¡æ¿æ ‡ç­¾å’Œè¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰æ¨¡æ¿æ ‡ç­¾å’Œè¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰æ¨¡æ¿æ ‡ç­¾å’Œè¿‡æ»¤å™¨"></a><a href="http://python.usyiyi.cn/django/howto/custom-template-tags.html" target="_blank" rel="noopener">è‡ªå®šä¹‰æ¨¡æ¿æ ‡ç­¾å’Œè¿‡æ»¤å™¨</a></h2><h3 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</span><br><span class="line">register = template.Library()</span><br><span class="line"><span class="meta">@register.filter(name='cut')</span></span><br><span class="line"> </span><br><span class="line">register.filter(<span class="string">'cut'</span>, cut)</span><br><span class="line">register.filter(<span class="string">'lower'</span>, lower)</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cut</span><span class="params">(value, arg)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> value.replace(arg, <span class="string">''</span>)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@register.filter</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lower</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> value.lower()</span><br></pre></td></tr></table></figure>
<p>å¯ä½¿ç”¨<code>SafeData</code>æ¥éªŒè¯æ˜¯å¦æ˜¯å®‰å…¨æ•°æ®<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> isinstance(value, SafeData):</span><br><span class="line">    <span class="comment"># Do something with the "safe" string.</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></p>
<p>æˆ–ä½¿ç”¨<code>is_safe</code>æ¥æ§åˆ¶åªæ¥æ”¶çš„å®‰å…¨çš„æ•°æ®<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@register.filter(is_safe=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myfilter</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure></p>
<h3 id="è‡ªå®šä¹‰æ ‡ç­¾"><a href="#è‡ªå®šä¹‰æ ‡ç­¾" class="headerlink" title="è‡ªå®šä¹‰æ ‡ç­¾"></a>è‡ªå®šä¹‰æ ‡ç­¾</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</span><br><span class="line"> </span><br><span class="line">register = template.Library()</span><br><span class="line"> </span><br><span class="line"><span class="meta">@register.simple_tag</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_time</span><span class="params">(format_string)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> datetime.datetime.now().strftime(format_string)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% show_results poll %&#125;</span><br></pre></td></tr></table></figure>
<p>å†™ä¸€ä¸ªæ ‡ç­¾ï¼Œå®ç°ä¸‹é¢çš„æ•ˆæœ<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>First choice<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Second choice<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Third choice<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ä¾‹å­1å¼€å§‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@register.inclusion_tag('results.html')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_results</span><span class="params">(poll)</span>:</span></span><br><span class="line">    choices = poll.choice_set.all()</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'choices'</span>: choices&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>results.html</code><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% for choice in choices %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span> &#123;&#123; choice &#125;&#125; <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ä¾‹å­1ç»“æŸ</p>
<p>å¯ä½¿ç”¨<code>takes_context=True</code>ç›´æ¥è®¿é—®ä¸Šä¸‹æ–‡ä»¶ä¸­çš„æ•°æ®<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@register.inclusion_tag('link.html', takes_context=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jump_link</span><span class="params">(context)</span>:</span></span><br><span class="line">    <span class="comment"># å› ä¸ºtakes_context=Trueæ‰€ä»¥è¿™é‡Œçš„contextå°±æ˜¯ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥ä»é‡Œé¢æ‹¿æƒ³è¦çš„æ•°æ®ï¼Œå¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œæ–¹æ³•é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°åå¿…é¡»æ˜¯context</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">'link'</span>: context[<span class="string">'home_link'</span>],</span><br><span class="line">        <span class="string">'title'</span>: context[<span class="string">'home_title'</span>],</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><code>link.html</code><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; link &#125;&#125;"</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.</span><br></pre></td></tr></table></figure></p>
<p>é¡µé¢ç›´æ¥å†™<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% jump_link %&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½ç½®å‚æ•°å’Œå…³é”®å­—å‚æ•°å’Œ<code>python</code>è¯­æ³•ä¸€æ ·<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@register.inclusion_tag('my_template.html')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_tag</span><span class="params">(a, b, *args, **kwargs)</span>:</span></span><br><span class="line">    warning = kwargs[<span class="string">'warning'</span>]</span><br><span class="line">    profile = kwargs[<span class="string">'profile'</span>]</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> ...</span><br></pre></td></tr></table></figure></p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name">my_tag</span> 123 "abcd" book.title warning=message|<span class="name">lower</span> profile=user.profile %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ä¸ª<code>register.assignment_tag</code>ä¸<code>register.simple_tag</code>åŠŸèƒ½ä¸€æ ·ï¼Œä¸çŸ¥é“æœ‰ä»€ä¹ˆç‰¹æ®Šä½œç”¨</p>
<h2 id="ä½¿ç”¨è¡¨å•"><a href="#ä½¿ç”¨è¡¨å•" class="headerlink" title="ä½¿ç”¨è¡¨å•"></a><a href="http://python.usyiyi.cn/django/topics/forms/index.html" target="_blank" rel="noopener">ä½¿ç”¨è¡¨å•</a></h2><p>ä¸€äº›è¡¨å•è¾“å…¥è‡ªå¸¦æœ‰html5çš„éªŒè¯ï¼Œè¦ç¦ç”¨è¿™äº›éªŒè¯å¯ä»¥è®¾ç½®<code>form</code>æ ‡ç­¾çš„<code>novalidate</code>å±æ€§</p>
<p><code>is_bound</code>å¯ä»¥åˆ¤æ–­ä¸€ä¸ªè¡¨å•æ˜¯å¦å…·æœ‰ç»‘å®šæ•°æ®<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœªç»‘å®šè¡¨å•</span></span><br><span class="line">f = ContactForm()</span><br><span class="line">data = &#123;<span class="string">'subject'</span>: <span class="string">'hello'</span>,</span><br><span class="line">        <span class="string">'message'</span>: <span class="string">'Hi there'</span>,</span><br><span class="line">        <span class="string">'sender'</span>: <span class="string">'foo@example.com'</span>,</span><br><span class="line">        <span class="string">'cc_myself'</span>: <span class="keyword">True</span>&#125;</span><br><span class="line"><span class="comment"># å·²ç»‘å®šçš„è¡¨å•</span></span><br><span class="line">f = ContactForm(data)</span><br></pre></td></tr></table></figure></p>
<p>å½“è¡¨å•é€šè¿‡<code>is_valid()</code>æ–¹æ³•éªŒè¯åï¼Œå¯ä»¥ç›´æ¥åœ¨<code>form.cleaned_data</code>ä¸­æ‹¿å€¼ï¼Œå¹¶ä¸”æ˜¯å·²ç»è½¬æ¢å¥½çš„<code>python</code>æ ¼å¼çš„æ•°æ®ï¼Œä½†ä»ç„¶å¯ä»¥ä»<code>request.POST</code>ç›´æ¥è®¿é—®åˆ°æœªéªŒè¯çš„æ•°æ®ã€‚</p>
<p>è¡¨å•æ’åˆ—<br><code></code><br><code></code><br><code></code></p>
<p>è¡¨å•å±æ€§<br><code></code>å­—æ®µhtmlæ ‡ç­¾<br><code></code>å­—æ®µçš„<code>lable</code>htmlæ ‡ç­¾<br><code></code>å­—æ®µ<code>lable</code>æ ‡ç­¾ä¸Šçš„<code>for</code>å€¼ï¼Œä¹Ÿæ˜¯å­—æ®µæ ‡ç­¾ä¸Šçš„<code>id</code></p>
<p><code></code>éšè—å­—æ®µåˆ—è¡¨<br><code></code>æ˜¾ç¤ºçš„å­—æ®µåˆ—è¡¨</p>
<p>é”™è¯¯ä¿¡æ¯<br><code></code>ä¸æ˜¯ç‰¹å®šå­—æ®µçš„é”™è¯¯<br><code></code>å…¨éƒ¨é”™è¯¯ï¼Œä¸€ä¸ªå­—å…¸<br><code></code>å­—æ®µé”™è¯¯</p>
<p>å¯ä»<code>form</code>ä»éå†å‡º<code>field</code><br><code></code>æœ‰ä»¥ä¸‹å±æ€§<br><code>`</code>Model<code>æˆ–æ˜¯</code>Form<code>ä¸Šçš„</code>label<code>çš„å€¼</code><code>æ•´ä¸ª</code>label<code>æ ‡ç­¾ï¼ŒåŒ…å«å†’å·</code><code>å­—æ®µçš„id</code><code>å­—æ®µçš„å€¼</code><code>å­—æ®µçš„</code>name<code>ï¼Œè€ƒè™‘è¡¨å•çš„å‰ç¼€</code><code>å­—æ®µçš„å¸®åŠ©æ–‡æ¡£</code><code>å­—æ®µçš„é”™è¯¯</code><code>åˆ¤æ–­å­—æ®µæ˜¯å¦éšè—</code><code>è¡¨å•ç±»ä¸­</code>Field<code>çš„å®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥è®¿é—®</code>Field`å±æ€§ï¼Œå¦‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name.field.max_length</span><br></pre></td></tr></table></figure></p>
<h2 id="è¡¨å•-API"><a href="#è¡¨å•-API" class="headerlink" title="è¡¨å• API"></a><a href="http://python.usyiyi.cn/django/ref/forms/api.html" target="_blank" rel="noopener">è¡¨å• API</a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœªç»‘å®šè¡¨å•</span></span><br><span class="line">f = ContactForm()</span><br><span class="line">data = &#123;<span class="string">'subject'</span>: <span class="string">'hello'</span>,</span><br><span class="line">        <span class="string">'message'</span>: <span class="string">'Hi there'</span>,</span><br><span class="line">        <span class="string">'sender'</span>: <span class="string">'foo@example.com'</span>,</span><br><span class="line">        <span class="string">'cc_myself'</span>: <span class="keyword">True</span>&#125;</span><br><span class="line"><span class="comment"># å·²ç»‘å®šçš„è¡¨å•</span></span><br><span class="line">f = ContactForm(data)</span><br></pre></td></tr></table></figure>
<p>è¡¨å•å®ä¾‹ä¸€ä½†åˆ›å»ºï¼Œæ•°æ®ä¸å¯æ›´æ”¹</p>
<h3 id="Form-clean"><a href="#Form-clean" class="headerlink" title="Form.clean()"></a><code>Form.clean()</code></h3><h3 id="Form-is-valid"><a href="#Form-is-valid" class="headerlink" title="Form.is_valid()"></a><code>Form.is_valid()</code></h3><h3 id="Form-errors"><a href="#Form-errors" class="headerlink" title="Form.errors"></a><code>Form.errors</code></h3><blockquote>
<p><code>Form.errors</code><br>è®¿é—®errors å±æ€§å¯ä»¥è·å¾—é”™è¯¯ä¿¡æ¯çš„ä¸€ä¸ªå­—å…¸ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.errors</span><br><span class="line">&#123;<span class="string">'sender'</span>: [<span class="string">'Enter a valid email address.'</span>], <span class="string">'subject'</span>: [<span class="string">'This field is required.'</span>]&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>åœ¨è¿™ä¸ªå­—å…¸ä¸­ï¼Œé”®ä¸ºå­—æ®µçš„åç§°ï¼Œå€¼ä¸ºè¡¨ç¤ºé”™è¯¯ä¿¡æ¯çš„Unicode å­—ç¬¦ä¸²ç»„æˆçš„åˆ—è¡¨ã€‚é”™è¯¯ä¿¡æ¯ä¿å­˜åœ¨åˆ—è¡¨ä¸­æ˜¯å› ä¸ºå­—æ®µå¯èƒ½æœ‰å¤šä¸ªé”™è¯¯ä¿¡æ¯ã€‚<br>ä½ å¯ä»¥åœ¨è°ƒç”¨is_valid() ä¹‹å‰è®¿é—®errorsã€‚è¡¨å•çš„æ•°æ®å°†åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨is_valid() æˆ–è€…è®¿é—®errors æ—¶éªŒè¯ã€‚<br>éªŒè¯åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œæ— è®ºä½ è®¿é—®errors æˆ–è€…è°ƒç”¨is_valid() å¤šå°‘æ¬¡ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœéªŒè¯è¿‡ç¨‹æœ‰å‰¯ä½œç”¨ï¼Œè¿™äº›å‰¯ä½œç”¨å°†åªè§¦å‘ä¸€æ¬¡ã€‚</p>
<h3 id="Form-errors-as-data"><a href="#Form-errors-as-data" class="headerlink" title="Form.errors.as_data()"></a><code>Form.errors.as_data()</code></h3><blockquote>
<p>è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œå®ƒæ˜ å°„å­—æ®µåˆ°åŸå§‹çš„ValidationError å®ä¾‹</p>
</blockquote>
<h3 id="Form-errors-as-json-escape-html-False"><a href="#Form-errors-as-json-escape-html-False" class="headerlink" title="Form.errors.as_json(escape_html=False)"></a><code>Form.errors.as_json(escape_html=False)</code></h3><blockquote>
<p>è¿”å›JSON åºåˆ—åŒ–åçš„é”™è¯¯ã€‚</p>
</blockquote>
<h3 id="Form-add-error-field-error"><a href="#Form-add-error-field-error" class="headerlink" title="Form.add_error(field, error)"></a><code>Form.add_error(field, error)</code></h3><blockquote>
<p>è¿™ä¸ªæ–¹æ³•å…è®¸åœ¨Form.clean() æ–¹æ³•å†…éƒ¨æˆ–ä»è¡¨å•çš„å¤–éƒ¨ä¸€èµ·ç»™å­—æ®µæ·»åŠ é”™è¯¯ä¿¡æ¯<br>Form.add_error() ä¼šè‡ªåŠ¨åˆ é™¤cleaned_data ä¸­çš„ç›¸å…³å­—æ®µ</p>
</blockquote>
<h3 id="Form-has-error-field-code-None"><a href="#Form-has-error-field-code-None" class="headerlink" title="Form.has_error(field, code=None)"></a><code>Form.has_error(field, code=None)</code></h3><blockquote>
<p>è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºä¸€ä¸ªå­—æ®µæ˜¯å¦å…·æœ‰æŒ‡å®šé”™è¯¯code çš„é”™è¯¯ã€‚å½“code ä¸ºNone æ—¶ï¼Œå¦‚æœå­—æ®µæœ‰ä»»ä½•é”™è¯¯å®ƒéƒ½å°†è¿”å›Trueã€‚<br>è‹¥è¦æ£€æŸ¥éå­—æ®µé”™è¯¯ï¼Œä½¿ç”¨NON_FIELD_ERRORS ä½œä¸ºfield å‚æ•°ã€‚</p>
</blockquote>
<h3 id="Form-non-field-errors"><a href="#Form-non-field-errors" class="headerlink" title="Form.non_field_errors()"></a><code>Form.non_field_errors()</code></h3><blockquote>
<p>è¿™ä¸ªæ–¹æ³•è¿”å›Form.errors ä¸­ä¸æ˜¯ä¸ç‰¹å®šå­—æ®µç›¸å…³è”çš„é”™è¯¯ã€‚å®ƒåŒ…å«åœ¨Form.clean() ä¸­å¼•å‘çš„ValidationError å’Œä½¿ç”¨Form.add_error(None, â€œâ€¦â€) æ·»åŠ çš„é”™è¯¯ã€‚</p>
</blockquote>
<p>æœªç»‘å®šè¡¨å•çš„è¡Œä¸º<br>éªŒè¯æ²¡æœ‰ç»‘å®šæ•°æ®çš„è¡¨å•æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†è¿™ç§æƒ…å†µï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = ContactForm()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.is_valid()</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.errors</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Form-initial"><a href="#Form-initial" class="headerlink" title="Form.initial"></a><code>Form.initial</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = ContactForm(initial=&#123;<span class="string">'subject'</span>: <span class="string">'Hi there!'</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™äº›å€¼åªæ˜¾ç¤ºåœ¨æ²¡æœ‰ç»‘å®šçš„è¡¨å•ä¸­ï¼Œå³ä½¿æ²¡æœ‰æä¾›ç‰¹å®šå€¼å®ƒä»¬ä¹Ÿ<strong><em>ä¸ä¼šä½œä¸ºåå¤‡çš„å€¼</em></strong>ã€‚<br>ä¼˜å…ˆçº§é«˜äº<code>Form</code>ä¸­çš„<code>initial</code><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">CommentForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line"><span class="meta">... </span>    name = forms.CharField(initial=<span class="string">'class'</span>)</span><br><span class="line"><span class="meta">... </span>    url = forms.URLField()</span><br><span class="line"><span class="meta">... </span>    comment = forms.CharField()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = CommentForm(initial=&#123;<span class="string">'name'</span>: <span class="string">'instance'</span>&#125;, auto_id=<span class="keyword">False</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(f)</span><br><span class="line">&lt;tr&gt;&lt;th&gt;Name:&lt;/th&gt;&lt;td&gt;&lt;input type="text" name="name" value="instance" /&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;&lt;th&gt;Url:&lt;/th&gt;&lt;td&gt;&lt;input type="url" name="url" /&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;&lt;th&gt;Comment:&lt;/th&gt;&lt;td&gt;&lt;input type="text" name="comment" /&gt;&lt;/td&gt;&lt;/tr&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="Form-has-changed"><a href="#Form-has-changed" class="headerlink" title="Form.has_changed()"></a><code>Form.has_changed()</code></h3><p><strong>ä¹Ÿæœ‰<code>Field.has_changed()</code>æ–¹æ³•</strong><br>æ£€æŸ¥è¡¨å•æ•°æ®æ˜¯å¦ä»åˆå§‹æ•°æ®å‘ç”Ÿæ”¹å˜<br>å½“æäº¤è¡¨å•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ„å»ºè¡¨å•å¹¶æä¾›åˆå§‹å€¼ï¼Œè¿™æ ·å¯ä»¥å®ç°æ¯”è¾ƒï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = ContactForm(request.POST, initial=data)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.has_changed()</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœrequest.POST ä¸­çš„æ•°æ®ä¸initial ä¸­çš„ä¸åŒï¼Œhas_changed() å°†ä¸ºTrueï¼Œå¦åˆ™ä¸ºFalseã€‚ è®¡ç®—çš„ç»“æœæ˜¯é€šè¿‡è°ƒç”¨è¡¨å•æ¯ä¸ªå­—æ®µçš„Field.has_changed() å¾—åˆ°çš„ã€‚</p>
<p><code>Form.fields</code><br>ä»è¡¨å•ä¸­è®¿é—®å­—æ®µ<br>æ˜¯ä¸€ä¸ª<code>OrderedDict</code><br>å¯ä½ å¯ä»¥ä¿®æ”¹è¡¨å•å®ä¾‹çš„å­—æ®µæ¥æ”¹å˜å­—æ®µåœ¨è¡¨å•ä¸­çš„è¡¨ç¤ºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.as_table().split(<span class="string">'\n'</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="string">'&lt;tr&gt;&lt;th&gt;Name:&lt;/th&gt;&lt;td&gt;&lt;input name="name" type="text" value="instance" /&gt;&lt;/td&gt;&lt;/tr&gt;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.fields[<span class="string">'name'</span>].label = <span class="string">"Username"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.as_table().split(<span class="string">'\n'</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="string">'&lt;tr&gt;&lt;th&gt;Username:&lt;/th&gt;&lt;td&gt;&lt;input name="name" type="text" value="instance" /&gt;&lt;/td&gt;&lt;/tr&gt;'</span></span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ä¸è¦æ”¹å˜base_fields å±æ€§ï¼Œå› ä¸ºä¸€æ—¦ä¿®æ”¹å°†å½±å“åŒä¸€ä¸ªPython è¿›ç¨‹ä¸­æ¥ä¸‹æ¥æ‰€æœ‰çš„ContactForm å®ä¾‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.base_fields[<span class="string">'name'</span>].label = <span class="string">"Username"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_f = CommentForm(auto_id=<span class="keyword">False</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_f.as_table().split(<span class="string">'\n'</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="string">'&lt;tr&gt;&lt;th&gt;Username:&lt;/th&gt;&lt;td&gt;&lt;input name="name" type="text" value="class" /&gt;&lt;/td&gt;&lt;/tr&gt;'</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>cleaned_data å§‹ç»ˆåª åŒ…å«è¡¨å•ä¸­å®šä¹‰çš„å­—æ®µï¼Œå³ä½¿ä½ åœ¨æ„å»ºè¡¨å• æ—¶ä¼ é€’äº†é¢å¤–çš„æ•°æ®ã€‚<br>cleaned_data å§‹ç»ˆåª åŒ…å«è¡¨å•ä¸­å®šä¹‰çš„å­—æ®µï¼Œå³ä½¿ä½ åœ¨æ„å»ºè¡¨å• æ—¶ä¼ é€’äº†é¢å¤–çš„æ•°æ®ã€‚<br>å½“è¡¨å•åˆæ³•æ—¶ï¼Œcleaned_data å°†åŒ…å«æ‰€æœ‰å­—æ®µçš„é”®å’Œå€¼ï¼Œå³ä½¿ä¼ é€’çš„æ•°æ®ä¸åŒ…å«æŸäº›å¯é€‰å­—æ®µçš„å€¼ã€‚</p>
</blockquote>
<h3 id="Form-cleaned-data"><a href="#Form-cleaned-data" class="headerlink" title="Form.cleaned_data"></a><code>Form.cleaned_data</code></h3><h3 id="Form-as-p"><a href="#Form-as-p" class="headerlink" title="Form.as_p"></a><code>Form.as_p</code></h3><p><code>Form.as_ul</code><br><code>Form.as_table</code></p>
<h3 id="Form-error-css-class-Form-required-css-class"><a href="#Form-error-css-class-Form-required-css-class" class="headerlink" title="Form.error_css_class Form.required_css_class"></a><code>Form.error_css_class</code> <code>Form.required_css_class</code></h3><p>åœ¨<code>Form</code>ç±»ä¸‹å¯ä»¥ç”¨ä¸Šé¢ä¸¤ä¸ªå±æ€§å®šä¹‰é”™è¯¯æ ·å¼å’Œå¿…å¡«æ ·å¼ï¼Œæ²¡æœ‰é»˜è®¤å€¼ï¼Œ<code>required_css_class</code>ä¹Ÿä¼šå›åœ¨<code>label</code>æ ‡ç­¾ä¸Š</p>
<h2 id="Form-auto-id"><a href="#Form-auto-id" class="headerlink" title="Form.auto_id"></a><code>Form.auto_id</code></h2><p>æ§åˆ¶è¡¨å•ä¸Šçš„<code>label</code>å’Œè¡¨å•å…ƒç´ çš„idï¼Œå€¼ä¸º<code>True</code>ï¼Œ<code>False</code>æˆ–å­—ç¬¦ä¸²ï¼Œæ”¯æŒ<code>%s</code>å ä½ç¬¦ï¼Œè¡¨ç¤ºå½“å‰å­—æ®µå</p>
<blockquote>
<p>å¦‚æœauto_id è®¾ç½®ä¸ºä»»ä½•å…¶å®ƒçš„çœŸå€¼ â€”â€” ä¾‹å¦‚ä¸åŒ…å«%s çš„å­—ç¬¦ä¸² â€”â€” é‚£ä¹ˆå…¶è¡Œä¸ºå°†ç±»ä¼¼auto_id ç­‰äºTrueã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œauto_id è®¾ç½®ä¸ºâ€™id_%sâ€™ã€‚</p>
</blockquote>
<h3 id="Form-label-suffix"><a href="#Form-label-suffix" class="headerlink" title="Form.label_suffix"></a><code>Form.label_suffix</code></h3><p>é»˜è®¤ä¸ºè‹±æ–‡çš„<code>:</code></p>
<h3 id="BoundField"><a href="#BoundField" class="headerlink" title="BoundField"></a><code>BoundField</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">form = ContactForm()</span><br><span class="line"><span class="keyword">for</span> boundfield <span class="keyword">in</span> form:</span><br><span class="line">    print(boundfield)</span><br><span class="line"><span class="comment"># æˆ–</span></span><br><span class="line"><span class="keyword">from</span>[<span class="string">'name'</span>]</span><br></pre></td></tr></table></figure>
<p><code>BoundField.errors</code><br><code>BoundField.label_tag(contents=None, attrs=None, label_suffix=None)</code><br><code>BoundField.css_classes()</code><br><code>BoundField.value()</code><br>æä¾›åˆå§‹å€¼ï¼Œä¼šè¢«ç»‘å®šå€¼è¦†ç›–<br><code>BoundField.id_for_label</code></p>
<h3 id="Form-is-multipart"><a href="#Form-is-multipart" class="headerlink" title="Form.is_multipart()"></a><code>Form.is_multipart()</code></h3><p>å¯åˆ¤æ–­è¡¨å•æ˜¯å¦éœ€è¦<code>multipart</code><br><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> form.is_multipart %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"/foo/"</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"/foo/"</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-variable">&#123;&#123; form &#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>å­ç±»åŒ–è¡¨å•æ—¶å¯é€šè¿‡è®¾ç½®<code>None</code>æ¥åˆ é™¤ä»çˆ¶ç±»ä¸­ç»§æ‰¿è¿‡æ¥çš„å­—æ®µ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">ParentForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line"><span class="meta">... </span>    name = forms.CharField()</span><br><span class="line"><span class="meta">... </span>    age = forms.IntegerField()</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">ChildForm</span><span class="params">(ParentForm)</span>:</span></span><br><span class="line"><span class="meta">... </span>    name = <span class="keyword">None</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ChildForm().fields.keys()</span><br><span class="line"><span class="meta">... </span>[<span class="string">'age'</span>]</span><br></pre></td></tr></table></figure></p>
<h3 id="Form-prefix"><a href="#Form-prefix" class="headerlink" title="Form.prefix"></a><code>Form.prefix</code></h3><p>å¦‚æœåœ¨é¡µé¢ä¸­éœ€è¦æ”¾å¤šä¸ªç›¸åŒçš„è¡¨å•ï¼Œå¯ä»¥è®¾ç½®è¡¨å•çš„å‰ç¼€<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>father = PersonForm()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(father.as_ul())</span><br><span class="line">&lt;li&gt;&lt;label for="id_first_name"&gt;First name:&lt;/label&gt; &lt;input type="text" name="first_name" id="id_first_name" /&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;label for="id_last_name"&gt;Last name:&lt;/label&gt; &lt;input type="text" name="last_name" id="id_last_name" /&gt;&lt;/li&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mother = PersonForm(prefix=<span class="string">"mother"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(mother.as_ul())</span><br><span class="line">&lt;li&gt;&lt;label for="id_mother-first_name"&gt;First name:&lt;/label&gt; &lt;input type="text" name="mother-first_name" id="id_mother-first_name" /&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;label for="id_mother-last_name"&gt;Last name:&lt;/label&gt; &lt;input type="text" name="mother-last_name" id="id_mother-last_name" /&gt;&lt;/li&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="è¡¨å•å­—æ®µ"><a href="#è¡¨å•å­—æ®µ" class="headerlink" title="è¡¨å•å­—æ®µ"></a><a href="http://python.usyiyi.cn/django/ref/forms/fields.html" target="_blank" rel="noopener">è¡¨å•å­—æ®µ</a></h2><h3 id="Field-has-change"><a href="#Field-has-change" class="headerlink" title="Field.has_change()"></a><code>Field.has_change()</code></h3><p>æ£€æŸ¥å­—æ®µçš„å€¼æ˜¯å¦ä»åˆå§‹å€¼å‘ç”Ÿæ”¹å˜</p>
<h3 id="å†…å»ºå­—æ®µ"><a href="#å†…å»ºå­—æ®µ" class="headerlink" title="å†…å»ºå­—æ®µ"></a>å†…å»ºå­—æ®µ</h3><h4 id="BooleanField"><a href="#BooleanField" class="headerlink" title="BooleanField"></a><code>BooleanField</code></h4><p>Widgetï¼š<code>CheckboxInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required</code></p>
<h4 id="CharField"><a href="#CharField" class="headerlink" title="CharField"></a><code>CharField</code></h4><p>Widgetï¼š<code>TextInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>max_length<code>min_length`
æ¥æ”¶ä¸¤ä¸ªå¯é€‰å‚æ•°
`max_length</code>min_length`</p>
<h4 id="ChoiceField"><a href="#ChoiceField" class="headerlink" title="ChoiceField"></a><code>ChoiceField</code></h4><p>Widtgetï¼š<code>Select</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid_choice<code></code>invalid_choice<code>é”™è¯¯æ¶ˆæ¯å¯èƒ½åŒ…å«</code>%(value)s<code>ï¼Œå®ƒå°†è¢«é€‰æ‹©çš„é€‰é¡¹æ›¿æ¢æ‰ã€‚
æ¥æ”¶ä¸€ä¸ªé¢å¤–çš„å¿…é€‰å‚æ•°</code>choices`<br>æ˜¯ä¸€ä¸ªäºŒå…ƒç»„ç»„æˆçš„å¯è¿­ä»£å¯¹è±¡</p>
<h4 id="TypeChoiceField"><a href="#TypeChoiceField" class="headerlink" title="TypeChoiceField"></a><code>TypeChoiceField</code></h4><p>Widgetï¼š<code>Select</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid_choice<code>æ¥æ”¶é¢å¤–çš„å‚æ•°</code>choices<code>æ˜¯ä¸€ä¸ªäºŒå…ƒç»„ç»„æˆçš„å¯è¿­ä»£å¯¹è±¡</code>coerce<code>æ¥æ”¶ä¸€ä¸ªå‚æ•°å¹¶è¿”å›å¼ºåˆ¶è½¬æ¢åçš„å€¼çš„ä¸€ä¸ªå‡½æ•°ã€‚ä¾‹å¦‚å†…å»ºçš„intã€floatã€bool å’Œå…¶å®ƒç±»å‹ã€‚é»˜è®¤ä¸ºid å‡½æ•°ã€‚æ³¨æ„å¼ºåˆ¶è½¬æ¢åœ¨è¾“å…¥éªŒè¯ç»“æŸåå‘ç”Ÿï¼Œæ‰€ä»¥å®ƒå¯èƒ½å¼ºåˆ¶è½¬æ¢ä¸åœ¨ choices ä¸­çš„å€¼</code>empty_value`<br>    ç”¨äºè¡¨ç¤ºâ€œç©ºâ€çš„å€¼ã€‚é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ï¼›None æ˜¯å¦å¤–ä¸€ä¸ªå¸¸è§çš„é€‰é¡¹ã€‚æ³¨æ„è¿™ä¸ªå€¼ä¸ä¼šè¢«coerce å‚æ•°ä¸­æŒ‡å®šçš„å‡½æ•°å¼ºåˆ¶è½¬æ¢ï¼Œæ‰€ä»¥è¯·æ ¹æ®æƒ…å†µè¿›è¡Œé€‰æ‹©</p>
<h4 id="DateField"><a href="#DateField" class="headerlink" title="DateField"></a><code>DateField</code></h4><p>Widgetï¼š<code>DateInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid<code>æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°</code>input_formats<code>ä¸€ä¸ªæ ¼å¼çš„åˆ—è¡¨ï¼Œç”¨äºè½¬æ¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸º</code>datateim.date`å¯¹è±¡<br>é»˜è®¤ä¸º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[&apos;%Y-%m-%d&apos;,      # &apos;2006-10-25&apos;</span><br><span class="line">&apos;%m/%d/%Y&apos;,       # &apos;10/25/2006&apos;</span><br><span class="line">&apos;%m/%d/%y&apos;]       # &apos;10/25/06&apos;</span><br></pre></td></tr></table></figure></p>
<p>å¦å¤–ï¼Œå¦‚æœä½ åœ¨è®¾ç½®ä¸­æŒ‡å®šUSE_L10N=Falseï¼Œä»¥ä¸‹çš„æ ¼å¼ä¹Ÿå°†åŒ…å«åœ¨é»˜è®¤çš„è¾“å…¥æ ¼å¼ä¸­ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[&apos;%b %d %Y&apos;,      # &apos;Oct 25 2006&apos;</span><br><span class="line">&apos;%b %d, %Y&apos;,      # &apos;Oct 25, 2006&apos;</span><br><span class="line">&apos;%d %b %Y&apos;,       # &apos;25 Oct 2006&apos;</span><br><span class="line">&apos;%d %b, %Y&apos;,      # &apos;25 Oct, 2006&apos;</span><br><span class="line">&apos;%B %d %Y&apos;,       # &apos;October 25 2006&apos;</span><br><span class="line">&apos;%B %d, %Y&apos;,      # &apos;October 25, 2006&apos;</span><br><span class="line">&apos;%d %B %Y&apos;,       # &apos;25 October 2006&apos;</span><br><span class="line">&apos;%d %B, %Y&apos;]      # &apos;25 October, 2006&apos;</span><br></pre></td></tr></table></figure></p>
<h4 id="DateTimeField"><a href="#DateTimeField" class="headerlink" title="DateTimeField"></a><code>DateTimeField</code></h4><p>Widgetï¼š<code>DateTimeInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid<code>æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°</code>input_formats<code>ä¸€ä¸ªæ ¼å¼çš„åˆ—è¡¨ï¼Œç”¨äºè½¬æ¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸º</code>datetime.datetime`å¯¹è±¡<br>é»˜è®¤ä¸º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[&apos;%Y-%m-%d %H:%M:%S&apos;,    # &apos;2006-10-25 14:30:59&apos;</span><br><span class="line">&apos;%Y-%m-%d %H:%M&apos;,        # &apos;2006-10-25 14:30&apos;</span><br><span class="line">&apos;%Y-%m-%d&apos;,              # &apos;2006-10-25&apos;</span><br><span class="line">&apos;%m/%d/%Y %H:%M:%S&apos;,     # &apos;10/25/2006 14:30:59&apos;</span><br><span class="line">&apos;%m/%d/%Y %H:%M&apos;,        # &apos;10/25/2006 14:30&apos;</span><br><span class="line">&apos;%m/%d/%Y&apos;,              # &apos;10/25/2006&apos;</span><br><span class="line">&apos;%m/%d/%y %H:%M:%S&apos;,     # &apos;10/25/06 14:30:59&apos;</span><br><span class="line">&apos;%m/%d/%y %H:%M&apos;,        # &apos;10/25/06 14:30&apos;</span><br><span class="line">&apos;%m/%d/%y&apos;]              # &apos;10/25/06&apos;</span><br></pre></td></tr></table></figure></p>
<h4 id="DecimalField"><a href="#DecimalField" class="headerlink" title="DecimalField"></a><code>DecimalField</code></h4><p>Widgetï¼šå½“<code>Field.localize</code>æ˜¯<code>False</code>æ—¶ä¸ºNumberInputï¼Œå¦åˆ™ä¸º<code>TextInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid<code>max_value</code>min_digits<code>max_decimal_places</code>max_whole_digits<code></code>max_value<code>å’Œ</code>min_value<code>é”™è¯¯ä¿¡æ¯å¯èƒ½åŒ…å«</code>%(limit_value)s<code>ï¼Œå®ƒä»¬å°†è¢«çœŸæ­£çš„é™åˆ¶å€¼æ›¿æ¢ã€‚ç±»ä¼¼åœ°ï¼Œ</code>max_digits<code>ã€</code>max_decimal_places<code>å’Œ</code>max_whole_digits<code>é”™è¯¯æ¶ˆæ¯å¯èƒ½åŒ…å«</code>%(max)s<code>æ¥æ”¶å››ä¸ªå¯é€‰å‚æ•°</code>max_value<code></code>min_value<code></code>max_digits<code>æœ€å¤§ä½æ•°</code>decimal_places`æœ€å¤§å°æ•°ä½</p>
<h4 id="DurationField"><a href="#DurationField" class="headerlink" title="DurationField"></a><code>DurationField</code></h4><p>Widgetï¼š<code>TextInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid`</p>
<h4 id="EmailField"><a href="#EmailField" class="headerlink" title="EmailField"></a><code>EmailField</code></h4><p>Widgetï¼š<code>EmailInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid<code>æ¥æ”¶ä¸¤ä¸ªå¯é€‰å‚æ•°</code>max_length<code></code>min_length`</p>
<h4 id="FileField"><a href="#FileField" class="headerlink" title="FileField"></a><code>FileField</code></h4><p>Widgetï¼š<code>ClearableFileInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid<code>missing</code>empty<code>max_length`
æ¥æ”¶ä¸¤ä¸ªå¯é€‰å‚æ•°
`max_length</code>allow_empty_file<code>å¦‚æœæä¾›ï¼Œè¿™ä¸¤ä¸ªå‚æ•°ç¡®ä¿æ–‡ä»¶åçš„æœ€å¤§é•¿åº¦ï¼Œè€Œä¸”å³ä½¿æ–‡ä»¶å†…å®¹ä¸ºç©ºæ—¶éªŒè¯ä¹Ÿä¼šæˆåŠŸ</code>max_length<code>é”™è¯¯ä¿¡æ¯è¡¨ç¤ºæ–‡ä»¶åçš„é•¿åº¦ã€‚åœ¨é”™è¯¯ä¿¡æ¯ä¸­ï¼Œ</code>%(max)d<code>å°†æ›¿æ¢ä¸ºæ–‡ä»¶çš„æœ€å¤§é•¿åº¦ï¼Œ%</code>(length)d` å°†æ›¿æ¢ä¸ºå½“å‰æ–‡ä»¶åçš„é•¿åº¦</p>
<h4 id="FilePathField"><a href="#FilePathField" class="headerlink" title="FilePathField"></a><code>FilePathField</code></h4><p>Widgetï¼š<code>Select</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid_choice<code>è¿™ä¸ªå­—æ®µå…è®¸ä»ä¸€ä¸ªç‰¹å®šçš„ç›®å½•é€‰æ‹©æ–‡ä»¶
æ¥æ”¶äº”ä¸ªå‚æ•°</code>path<code>å¿…é¡»
æƒ³è¦åˆ—å‡ºçš„ç›®å½•çš„ç»å¯¹è·¯å¾„</code>recursive<code>å¯é€‰
å¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º</code>False<code>ï¼Œæ˜¯å¦éœ€è¦é€’å½’è¿™ä¸ªç›®å½•</code>match<code>å¯é€‰
æ­£åˆ™è¡¨è¾¾å¼è¡¨ç¤ºä¸€ä¸ªæ¨¡å¼ï¼Œåªæœ‰åŒ¹é…è¿™ä¸ªè¡¨è¾¾å¼çš„åç§°æ‰ä¼šå…è®¸ä½œä¸ºé€‰é¡¹</code>allow_files<code>å¯é€‰
å¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º</code>True<code>ï¼Œè¡¨ç¤ºæ˜¯å¦åº”è¯¥åŒ…å«æŒ‡å®šä½ç½®çš„æ–‡ä»¶ï¼Œå®ƒå’Œ</code>allow_folders<code>å¿…é¡»æœ‰ä¸€ä¸ªä¸º</code>True<code></code>allow_folders<code>å¯é€‰
å¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º</code>True<code>ï¼Œè¡¨ç¤ºæ˜¯å¦åº”è¯¥åŒ…å«æŒ‡å®šä½ç½®çš„ç›®å½•ï¼Œå’Œ</code>allow_files<code>å¿…é¡»æœ‰ä¸€ä¸ªä¸º</code>True`</p>
<h4 id="FloatField"><a href="#FloatField" class="headerlink" title="FloatField"></a><code>FloatField</code></h4><p>Widgetï¼šå½“<code>Field.localize</code>æ˜¯False æ—¶ä¸º<code>NumberInput</code>ï¼Œå¦åˆ™ä¸º<code>TextInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid<code>max_value</code>min_value<code>æ¥æ”¶ä¸¤ä¸ªå¯é€‰å‚æ•°</code>max_value<code></code>min_value`</p>
<h4 id="ImageField"><a href="#ImageField" class="headerlink" title="ImageField"></a><code>ImageField</code></h4><p>Widgetï¼š<code>ClearableFileInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid<code>missing</code>empty<code></code>invalid_image`</p>
<h4 id="IntegerField"><a href="#IntegerField" class="headerlink" title="IntegerField"></a><code>IntegerField</code></h4><p>Widgetï¼šå½“<code>Field.localize</code>æ˜¯<code>False</code>æ—¶ä¸º<code>NumberInput</code>ï¼Œå¦åˆ™ä¸º<code>TextInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid<code>max_value</code>min_value<code>æ¥æ”¶ä¸¤ä¸ªå¯é€‰å‚æ•°</code>max_value<code></code>min_value`</p>
<h4 id="IPAddressField"><a href="#IPAddressField" class="headerlink" title="IPAddressField"></a><code>IPAddressField</code></h4><p>1.7å¼ƒç”¨</p>
<h4 id="GenericIPAddressField"><a href="#GenericIPAddressField" class="headerlink" title="GenericIPAddressField"></a><code>GenericIPAddressField</code></h4><p>Widgetï¼š<code>TextInput</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid<code>æ¥æ”¶ä¸¤ä¸ªå¯é€‰å‚æ•°</code>protocol<code></code>unpack_ipv4`</p>
<h4 id="MultipleChoiceField"><a href="#MultipleChoiceField" class="headerlink" title="MultipleChoiceField"></a><code>MultipleChoiceField</code></h4><p>Widgetï¼š<code>SelectMultiple</code><br>é”™è¯¯ä¿¡æ¯çš„é”®ï¼š<code>required`</code>invalid_choice<code></code>invalid_list`</p>
<h4 id="TypedMultipleChoiceField"><a href="#TypedMultipleChoiceField" class="headerlink" title="TypedMultipleChoiceField"></a><code>TypedMultipleChoiceField</code></h4><h4 id="NullBooleanField"><a href="#NullBooleanField" class="headerlink" title="NullBooleanField"></a><code>NullBooleanField</code></h4><h4 id="RegexField"><a href="#RegexField" class="headerlink" title="RegexField"></a><code>RegexField</code></h4><h4 id="SlugField"><a href="#SlugField" class="headerlink" title="SlugField"></a><code>SlugField</code></h4><h4 id="TimeField"><a href="#TimeField" class="headerlink" title="TimeField"></a><code>TimeField</code></h4><h4 id="URLField"><a href="#URLField" class="headerlink" title="URLField"></a><code>URLField</code></h4><h4 id="UUIDField"><a href="#UUIDField" class="headerlink" title="UUIDField"></a><code>UUIDField</code></h4><p>è¾“å‡ºæ—¶éœ€è¦<code>.hex</code></p>
<h4 id="ComboField"><a href="#ComboField" class="headerlink" title="ComboField"></a><code>ComboField</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.forms <span class="keyword">import</span> ComboField</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = ComboField(fields=[CharField(max_length=<span class="number">20</span>), EmailField()])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.clean(<span class="string">'test@example.com'</span>)</span><br><span class="line"><span class="string">'test@example.com'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.clean(<span class="string">'longemailaddress@example.com'</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">...</span><br><span class="line">ValidationError: [<span class="string">'Ensure this value has at most 20 characters (it has 28).'</span>]</span><br></pre></td></tr></table></figure>
<h4 id="MultiValueField"><a href="#MultiValueField" class="headerlink" title="MultiValueField"></a><code>MultiValueField</code></h4><h4 id="SplitDateTimeField"><a href="#SplitDateTimeField" class="headerlink" title="SplitDateTimeField"></a><code>SplitDateTimeField</code></h4><h4 id="ModelChoiceField"><a href="#ModelChoiceField" class="headerlink" title="ModelChoiceField"></a><code>ModelChoiceField</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># A custom empty label</span></span><br><span class="line">field1 = forms.ModelChoiceField(queryset=..., empty_label=<span class="string">"(Nothing)"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># No empty label</span></span><br><span class="line">field2 = forms.ModelChoiceField(queryset=..., empty_label=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<h4 id="ModelMultipleChoiceField"><a href="#ModelMultipleChoiceField" class="headerlink" title="ModelMultipleChoiceField"></a><code>ModelMultipleChoiceField</code></h4><h2 id="Widgets"><a href="#Widgets" class="headerlink" title="Widgets"></a><a href="http://python.usyiyi.cn/django/ref/forms/widgets.html" target="_blank" rel="noopener">Widgets</a></h2><p>å¤„ç†æ–‡æœ¬è¾“å…¥çš„Widget</p>
<ul>
<li><code>TextInput</code></li>
<li><code>NumberInput</code></li>
<li><code>EmailInput</code></li>
<li><code>URLInput</code></li>
<li><code>PasswordInput</code></li>
<li><code>HiddenInput</code></li>
<li><code>DateInput</code></li>
<li><code>DateTimeInput</code></li>
<li><code>TimeInput</code></li>
<li><code>Textarea</code></li>
</ul>
<p>é€‰æ‹©å’Œå¤é€‰æ¡†Widget</p>
<ul>
<li><code>CheckboxInput</code></li>
<li><code>Select</code></li>
<li><code>NullBooleanSelect</code></li>
<li><code>SelectMultiple</code></li>
<li><code>RadioSelect</code></li>
<li><code>CheckboxSelectMultiple</code></li>
</ul>
<p>æ–‡ä»¶ä¸Šä¼ <code>Widget</code></p>
<ul>
<li><code>FileInput</code></li>
<li><code>ClearableFileInput</code></li>
</ul>
<p>å¤åˆWidget</p>
<ul>
<li><code>MultipleHiddenInput</code></li>
<li><code>SplitDateTimeWidget</code></li>
<li><code>SplitHiddenDateTimeWidget</code></li>
<li><code>SelectDateWidget</code></li>
</ul>
<h2 id="ä»æ¨¡å‹åˆ›å»ºè¡¨å•"><a href="#ä»æ¨¡å‹åˆ›å»ºè¡¨å•" class="headerlink" title="ä»æ¨¡å‹åˆ›å»ºè¡¨å•"></a><a href="http://python.usyiyi.cn/django/topics/forms/modelforms.html" target="_blank" rel="noopener">ä»æ¨¡å‹åˆ›å»ºè¡¨å•</a></h2><p>ä¸‹é¢ä¸¤ç§æ–¹æ³•æ•ˆæœç›¸åŒ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">author = Author(title=<span class="string">'Mr'</span>)</span><br><span class="line">form = PartialAuthorForm(request.POST, instance=author)</span><br><span class="line">form.save()</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">form = PartialAuthorForm(request.POST)</span><br><span class="line">author = form.save(commit=<span class="keyword">False</span>)</span><br><span class="line">author.title = <span class="string">'Mr'</span></span><br><span class="line">author.save()</span><br></pre></td></tr></table></figure></p>
<p>æ˜¾å¼å®šä¹‰çš„å­—æ®µä¸ä¼šä»å¯¹äºçš„æ¨¡å‹ä¸­è·å–å±æ€§ï¼Œä¾‹å¦‚ max_length æˆ–requiredã€‚ å¦‚æœä½ å¸Œæœ›ä¿æŒæ¨¡å‹ä¸­æŒ‡å®šçš„è¡Œä¸ºï¼Œä½ å¿…é¡»è®¾ç½®åœ¨å£°æ˜è¡¨å•å­—æ®µæ—¶æ˜¾å¼è®¾ç½®ç›¸å…³çš„å‚æ•°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœArticle æ¨¡å‹åƒä¸‹é¢è¿™æ ·ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    headline = models.CharField(max_length=<span class="number">200</span>, null=<span class="keyword">True</span>, blank=<span class="keyword">True</span>,</span><br><span class="line">                                help_text=<span class="string">"Use puns liberally"</span>)</span><br><span class="line">    content = models.TextField()</span><br></pre></td></tr></table></figure></p>
<p>è€Œä½ æƒ³ä¸ºheadline åšä¸€äº›è‡ªå®šä¹‰çš„éªŒè¯ï¼Œåœ¨ä¿æŒblank å’Œhelp_text å€¼çš„åŒæ—¶ï¼Œä½ å¿…é¡»å®šä¹‰è¿™æ ·å®šä¹‰ArticleFormï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleForm</span><span class="params">(ModelForm)</span>:</span></span><br><span class="line">    headline = MyFormField(max_length=<span class="number">200</span>, required=<span class="keyword">False</span>,</span><br><span class="line">                           help_text=<span class="string">"Use puns liberally"</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Article</span><br><span class="line">        fields = [<span class="string">'headline'</span>, <span class="string">'content'</span>]</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºç®€å•çš„è¡¨å•æˆ–è¡¨å•é›†å¯ä»¥ä½¿ç”¨<code>modelform_factory()`</code>modelformset_factory()`æ–¹æ³•æ¥æ–°å»ºã€‚</p>
<p>å¯ç”¨å­—æ®µçš„æœ¬åœ°åŒ–åŠŸèƒ½Â¶</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒModelForm ä¸­çš„å­—æ®µä¸ä¼šæœ¬åœ°åŒ–å®ƒä»¬çš„æ•°æ®ã€‚ä½ å¯ä»¥ä½¿ç”¨Meta ç±»çš„localized_fields å±æ€§æ¥å¯ç”¨å­—æ®µçš„æœ¬åœ°åŒ–åŠŸèƒ½ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.forms <span class="keyword">import</span> ModelForm</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> myapp.models <span class="keyword">import</span> Author</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">AuthorForm</span><span class="params">(ModelForm)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line"><span class="meta">... </span>        model = Author</span><br><span class="line"><span class="meta">... </span>        localized_fields = (<span class="string">'birth_date'</span>,)</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœlocalized_fields è®¾ç½®ä¸º<code>&#39;__all__&#39;</code>è¿™ä¸ªç‰¹æ®Šçš„å€¼ï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½å°†æœ¬åœ°åŒ–ã€‚</p>
<p>æä¾›çš„åˆå§‹å€¼ä¼šè¦†ç›–ä»å®ä¾‹å–å¾—çš„å€¼<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>article = Article.objects.get(pk=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>article.headline</span><br><span class="line"><span class="string">'My headline'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>form = ArticleForm(initial=&#123;<span class="string">'headline'</span>: <span class="string">'Initial headline'</span>&#125;, instance=article)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>form[<span class="string">'headline'</span>].value()</span><br><span class="line"><span class="string">'Initial headline'</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœä¸éœ€è¦å¾ˆå¤šè‡ªå®šä¹‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å·¥å‚æ–¹æ³•æ¥ç”Ÿæˆè¡¨å•ç±»<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.forms.models <span class="keyword">import</span> modelform_factory</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> myapp.models <span class="keyword">import</span> Book</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>BookForm = modelform_factory(Book, fields=(<span class="string">"author"</span>, <span class="string">"title"</span>))</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.forms <span class="keyword">import</span> Textarea</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Form = modelform_factory(Book, form=BookForm,</span><br><span class="line"><span class="meta">... </span>                         widgets=&#123;<span class="string">"title"</span>: Textarea()&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Form = modelform_factory(Author, form=AuthorForm, localized_fields=(<span class="string">"birth_date"</span>,))</span><br></pre></td></tr></table></figure>
<p>è¡¨å•é›†<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.forms.models <span class="keyword">import</span> modelformset_factory</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> myapp.models <span class="keyword">import</span> Author</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>AuthorFormSet = modelformset_factory(Author, fields=(<span class="string">'name'</span>, <span class="string">'title'</span>))</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨<code>model</code>ç”Ÿæˆçš„<code>formset</code>é»˜è®¤å¸¦ä¸€ä¸ªåŒ…å«å…¨éƒ¨å¯¹è±¡çš„<code>queryset</code><br><code>formset`</code>save()`ä¹‹åï¼Œä¼šæœ‰æ–°çš„å±æ€§<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">models.BaseModelFormSet.changed_objects</span><br><span class="line">models.BaseModelFormSet.deleted_objects</span><br><span class="line">models.BaseModelFormSet.new_objects</span><br></pre></td></tr></table></figure></p>
<p><code>max_num</code>ä¸ºæœ€å¤§çš„è¡¨å•æ•°ï¼Œå¦‚æœåˆå§‹<code>queryset</code>é•¿åº¦æ¯”<code>max_num</code>ï¼Œåˆ™æŒ‰ç…§<code>queryset</code>æ¥ï¼Œ<code>extra</code>æ˜¯å¯ä»¥é¢å¤–æ·»åŠ çš„ç©ºè¡¨å•çš„ä¸ªæ•°ï¼Œä½†<code>extra</code>å’Œ<code>queryset</code>é•¿åº¦ç›¸åŠ å¦‚æœå¤§äº<code>max_num</code>ï¼Œåˆ™<code>extra</code>å’Œå®ä¾‹è®¾ç½®å¯èƒ½è¡¨ç°ä¸ä¸€æ ·ï¼Œå¦‚<code>queryset</code>é•¿åº¦ä¸º2ï¼Œ<code>max_num</code>ä¸º4ï¼Œ<code>extra</code>ä¸ç®¡æ˜¯2è¿˜æ˜¯5ï¼Œæœ€ç»ˆè¡¨ç°å‡ºæ¥éƒ½æ˜¯2ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AuthorFormSet = modelformset_factory(Author, fields=(<span class="string">'name'</span>,), max_num=<span class="number">4</span>, extra=<span class="number">2</span>)</span><br></pre></td></tr></table></figure></p>
<p><code>max_num</code>é»˜è®¤åªå½±å“æ˜¾ç¤ºï¼Œä¸å½±å“éªŒè¯ï¼Œå¦‚æœéœ€è¦å½±å“éªŒè¯æ·»åŠ <code>validate_max=True</code>å³å¯</p>
<h2 id="è¡¨å•ç´ æ-Media-ç±»"><a href="#è¡¨å•ç´ æ-Media-ç±»" class="headerlink" title="è¡¨å•ç´ æ ( Media ç±»)"></a><a href="http://python.usyiyi.cn/django/topics/forms/media.html" target="_blank" rel="noopener">è¡¨å•ç´ æ ( Media ç±»)</a></h2><p><strong><code>Form</code>å’Œ<code>Widget</code>éƒ½å¯ä»¥å®šä¹‰ç´ æ</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CalendarWidget</span><span class="params">(forms.TextInput)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Media</span>:</span></span><br><span class="line">        css = &#123;</span><br><span class="line">            <span class="string">'all'</span>: (<span class="string">'pretty.css'</span>,)</span><br><span class="line">        &#125;</span><br><span class="line">        js = (<span class="string">'animations.js'</span>, <span class="string">'actions.js'</span>)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>CalendarWidget</code>ä¼šè‡ªåŠ¨å¼•å…¥ä¸‹åˆ—èµ„æº<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"http://static.example.com/pretty.css"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">media</span>=<span class="string">"all"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://static.example.com/animations.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://static.example.com/actions.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><code>Widget</code>ä¼šé»˜è®¤ç»§æ‰¿çˆ¶ç±»çš„ç´ æï¼Œå¦‚æœä¸æƒ³ç»§æ‰¿åœ¨<code>Media</code>é‡Œä½¿ç”¨<code>extend</code>ç¦æ­¢ã€‚</p>
<p>åŠ¨æ€å®šä¹‰<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CalendarWidget</span><span class="params">(forms.TextInput)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_media</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> forms.Media(css=&#123;<span class="string">'all'</span>: (<span class="string">'pretty.css'</span>,)&#125;,</span><br><span class="line">                           js=(<span class="string">'animations.js'</span>, <span class="string">'actions.js'</span>))</span><br><span class="line">    media = property(_media)</span><br></pre></td></tr></table></figure></p>
<p>ä¸¤ä¸ª<code>Media</code>å®ä¾‹å¯ä»¥ç›¸åŠ <br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">CalendarWidget</span><span class="params">(forms.TextInput)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="class"><span class="keyword">class</span> <span class="title">Media</span>:</span></span><br><span class="line"><span class="meta">... </span>        css = &#123;</span><br><span class="line"><span class="meta">... </span>            <span class="string">'all'</span>: (<span class="string">'pretty.css'</span>,)</span><br><span class="line"><span class="meta">... </span>        &#125;</span><br><span class="line"><span class="meta">... </span>        js = (<span class="string">'animations.js'</span>, <span class="string">'actions.js'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">OtherWidget</span><span class="params">(forms.TextInput)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="class"><span class="keyword">class</span> <span class="title">Media</span>:</span></span><br><span class="line"><span class="meta">... </span>        js = (<span class="string">'whizbang.js'</span>,)</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w1 = CalendarWidget()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w2 = OtherWidget()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(w1.media + w2.media)</span><br><span class="line">&lt;link href=<span class="string">"http://static.example.com/pretty.css"</span> type=<span class="string">"text/css"</span> media=<span class="string">"all"</span> rel=<span class="string">"stylesheet"</span> /&gt;</span><br><span class="line">&lt;script type="text/javascript" src="http://static.example.com/animations.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="http://static.example.com/actions.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="http://static.example.com/whizbang.js"&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>è¡¨å•<code>Media</code><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">ContactForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line"><span class="meta">... </span>    date = DateField(widget=CalendarWidget)</span><br><span class="line"><span class="meta">... </span>    name = CharField(max_length=<span class="number">40</span>, widget=OtherWidget)</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="class"><span class="keyword">class</span> <span class="title">Media</span>:</span></span><br><span class="line"><span class="meta">... </span>        css = &#123;</span><br><span class="line"><span class="meta">... </span>            <span class="string">'all'</span>: (<span class="string">'layout.css'</span>,)</span><br><span class="line"><span class="meta">... </span>        &#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = ContactForm()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.media</span><br><span class="line">&lt;link href=<span class="string">"http://static.example.com/pretty.css"</span> type=<span class="string">"text/css"</span> media=<span class="string">"all"</span> rel=<span class="string">"stylesheet"</span> /&gt;</span><br><span class="line">&lt;link href=<span class="string">"http://static.example.com/layout.css"</span> type=<span class="string">"text/css"</span> media=<span class="string">"all"</span> rel=<span class="string">"stylesheet"</span> /&gt;</span><br><span class="line">&lt;script type="text/javascript" src="http://static.example.com/animations.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="http://static.example.com/actions.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="http://static.example.com/whizbang.js"&gt;&lt;/script</span><br></pre></td></tr></table></figure></p>
<h2 id="è¡¨å•é›†"><a href="#è¡¨å•é›†" class="headerlink" title="è¡¨å•é›†"></a><a href="http://python.usyiyi.cn/django/topics/forms/formsets.html" target="_blank" rel="noopener">è¡¨å•é›†</a></h2><p>è¡¨å•é›†æ§åˆ¶<br><code>max_num</code><br><code>min_num</code><br><code>validate_max</code><br><code>validate_min</code><br><code>can_order</code><br><code>can_delete</code></p>
<p>å…¶ä¸­<code>can_order`</code>can_delete`é»˜è®¤ä»¥ä»¥ä¸‹å½¢å¼å±•ç°</p>
<p>å¦‚æœæ˜¯ä½¿ç”¨<code>Model</code>ç”Ÿæˆçš„è¡¨å•é›†ï¼Œå¦‚æœ<code>delete</code>åï¼Œåœ¨è°ƒç”¨<code>formset.save()</code>ä¼šè‡ªåŠ¨åˆ é™¤ç›¸åº”çš„æ•°æ®ï¼Œä½†å¦‚æœè°ƒç”¨äº†<code>formset.save(commit=False)</code>ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨åˆ é™¤ï¼ˆ1.6æˆ–æ›´æ—©ç‰ˆè¿˜æ˜¯ä¼šè‡ªåŠ¨åˆ é™¤ï¼‰<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>instances = formset.save(commit=<span class="keyword">False</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> obj <span class="keyword">in</span> formset.deleted_objects:</span><br><span class="line"><span class="meta">... </span>    obj.delete()</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœè¦å…¼å®¹1.6æˆ–æ›´æ—©ç‰ˆï¼Œå¯ä»¥è¿™ä¹ˆå†™<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="comment"># For Django 1.7+</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="keyword">for</span> obj <span class="keyword">in</span> formset.deleted_objects:</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        obj.delete()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">except</span> AssertionError:</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="comment"># Django 1.6 and earlier already deletes the objects, trying to</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="comment"># delete them a second time raises an AssertionError.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<p>åœ¨è¡¨å•é›†é‡Œæ·»åŠ é¢å¤–çš„å­—æ®µ<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.forms.formsets <span class="keyword">import</span> BaseFormSet</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.forms.formsets <span class="keyword">import</span> formset_factory</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> myapp.forms <span class="keyword">import</span> ArticleForm</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">BaseArticleFormSet</span><span class="params">(BaseFormSet)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">add_fields</span><span class="params">(self, form, index)</span>:</span></span><br><span class="line"><span class="meta">... </span>        super(BaseArticleFormSet, self).add_fields(form, index)</span><br><span class="line"><span class="meta">... </span>        form.fields[<span class="string">"my_field"</span>] = forms.CharField()</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ArticleFormSet = formset_factory(ArticleForm, formset=BaseArticleFormSet)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>formset = ArticleFormSet()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> form <span class="keyword">in</span> formset:</span><br><span class="line"><span class="meta">... </span>    print(form.as_table())</span><br><span class="line">&lt;tr&gt;&lt;th&gt;&lt;label for="id_form-0-title"&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type="text" name="form-0-title" id="id_form-0-title" /&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;&lt;th&gt;&lt;label for="id_form-0-pub_date"&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type="text" name="form-0-pub_date" id="id_form-0-pub_date" /&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;&lt;th&gt;&lt;label for="id_form-0-my_field"&gt;My field:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type="text" name="form-0-my_field" id="id_form-0-my_field" /&gt;&lt;/td&gt;&lt;/tr&gt;</span><br></pre></td></tr></table></figure></p>
<p>è¡¨å•é›†å¯¹åº”çš„æ¨¡ç‰ˆå†™æ³•<br><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">        </span><span class="template-variable">&#123;&#123; formset &#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ¸²æŸ“ï¼Œä¸èƒ½ç¼ºå°‘<code></code><br><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; formset.management_form &#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> form <span class="keyword">in</span> formset</span></span><br><span class="line"><span class="template-tag">        &#123;&#123; form &#125;&#125;</span></span><br><span class="line"><span class="template-tag">        &#123;% endfor</span></span><br><span class="line"><span class="template-tag">    &lt;/table&gt;</span></span><br><span class="line"><span class="template-tag">&lt;/form&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæ˜¯æ‰‹åŠ¨æ¸²æŸ“ï¼Œ<code>can_order`</code>can_delete`éœ€è¦æ‰‹åŠ¨æ·»åŠ <br><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; formset.management_form &#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> form <span class="keyword">in</span> formset</span></span><br><span class="line"><span class="template-tag">        &lt;ul&gt;</span></span><br><span class="line"><span class="template-tag">            &lt;li&gt;&#123;&#123; form.title &#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="template-tag">            &lt;li&gt;&#123;&#123; form.pub_date &#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="template-tag">            &#123;% if formset.can_delete</span></span><br><span class="line"><span class="template-tag">                &lt;li&gt;&#123;&#123; form.DELETE &#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="template-tag">            &#123;% endif</span></span><br><span class="line"><span class="template-tag">        &lt;/ul&gt;</span></span><br><span class="line"><span class="template-tag">    &#123;% endfor</span></span><br><span class="line"><span class="template-tag">&lt;/form&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¸€ä¸ªè§†å›¾ä¸­ä½¿ç”¨å¤šä¸ª<code>FormSet</code>éœ€è¦å›å‰ç¼€<code>prefix</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.forms.formsets <span class="keyword">import</span> formset_factory</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render_to_response</span><br><span class="line"><span class="keyword">from</span> myapp.forms <span class="keyword">import</span> ArticleForm, BookForm</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">manage_articles</span><span class="params">(request)</span>:</span></span><br><span class="line">    ArticleFormSet = formset_factory(ArticleForm)</span><br><span class="line">    BookFormSet = formset_factory(BookForm)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        article_formset = ArticleFormSet(request.POST, request.FILES, prefix=<span class="string">'articles'</span>)</span><br><span class="line">        book_formset = BookFormSet(request.POST, request.FILES, prefix=<span class="string">'books'</span>)</span><br><span class="line">        <span class="keyword">if</span> article_formset.is_valid() <span class="keyword">and</span> book_formset.is_valid():</span><br><span class="line">            <span class="comment"># do something with the cleaned_data on the formsets.</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        article_formset = ArticleFormSet(prefix=<span class="string">'articles'</span>)</span><br><span class="line">        book_formset = BookFormSet(prefix=<span class="string">'books'</span>)</span><br><span class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'manage_articles.html'</span>, &#123;</span><br><span class="line">        <span class="string">'article_formset'</span>: article_formset,</span><br><span class="line">        <span class="string">'book_formset'</span>: book_formset,</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="è¡¨å•éªŒè¯å’Œå­—æ®µéªŒè¯"><a href="#è¡¨å•éªŒè¯å’Œå­—æ®µéªŒè¯" class="headerlink" title="è¡¨å•éªŒè¯å’Œå­—æ®µéªŒè¯"></a><a href="http://python.usyiyi.cn/django/ref/forms/validation.html" target="_blank" rel="noopener">è¡¨å•éªŒè¯å’Œå­—æ®µéªŒè¯</a></h2><p>æ ¼å¼æ ‡å‡†<br>æŠ›å‡ºå•ä¸ªé”™è¯¯<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">raise</span> ValidationError(</span><br><span class="line">    _(<span class="string">'Invalid value: %(value)s'</span>),</span><br><span class="line">    code=<span class="string">'invalid'</span>,</span><br><span class="line">    params=&#123;<span class="string">'value'</span>: <span class="string">'42'</span>&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>æ‹›è˜å¤šä¸ªé”™è¯¯<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Good</span></span><br><span class="line"><span class="keyword">raise</span> ValidationError([</span><br><span class="line">    ValidationError(_(<span class="string">'Error 1'</span>), code=<span class="string">'error1'</span>),</span><br><span class="line">    ValidationError(_(<span class="string">'Error 2'</span>), code=<span class="string">'error2'</span>),</span><br><span class="line">])</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Bad</span></span><br><span class="line"><span class="keyword">raise</span> ValidationError([</span><br><span class="line">    _(<span class="string">'Error 1'</span>),</span><br><span class="line">    _(<span class="string">'Error 2'</span>),</span><br><span class="line">])</span><br></pre></td></tr></table></figure></p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„è¡¨å•å­—æ®µæ·»åŠ é»˜è®¤éªŒè¯<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.core.validators <span class="keyword">import</span> validate_email</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiEmailField</span><span class="params">(forms.Field)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_python</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="string">"Normalize data to a list of strings."</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># Return an empty list if no input was given.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> value:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        <span class="keyword">return</span> value.split(<span class="string">','</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="string">"Check if value consists only of valid emails."</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># Use the parent's handling of required fields, etc.</span></span><br><span class="line">        super(MultiEmailField, self).validate(value)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> email <span class="keyword">in</span> value:</span><br><span class="line">            validate_email(email)</span><br></pre></td></tr></table></figure></p>
<h2 id="Django-çš„è®¾ç½®"><a href="#Django-çš„è®¾ç½®" class="headerlink" title="Django çš„è®¾ç½®"></a><a href="http://python.usyiyi.cn/django/topics/settings.html" target="_blank" rel="noopener">Django çš„è®¾ç½®</a></h2><p>django-admin å·¥å…·</p>
<p>å½“ä½¿ç”¨django-admin æ—¶ï¼Œ ä½ å¯ä»¥è®¾ç½®åªè®¾ç½®ç¯å¢ƒå˜é‡ä¸€æ¬¡ï¼Œæˆ–è€…æ¯æ¬¡è¿è¡Œè¯¥å·¥å…·æ—¶æ˜¾å¼ä¼ é€’è®¾ç½®æ¨¡å—ã€‚</p>
<p>ä¾‹å¦‚ï¼ˆUnix Bash shellï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export DJANGO_SETTINGS_MODULE=mysite.settings</span><br><span class="line">django-admin runserver</span><br></pre></td></tr></table></figure></p>
<p>ä¾‹å¦‚ï¼ˆWindows shellï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set DJANGO_SETTINGS_MODULE=mysite.settings</span><br><span class="line">django-admin runserver</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨â€“settings å‘½ä»¤è¡Œå‚æ•°å¯ä»¥æ‰‹å·¥æŒ‡å®šè®¾ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin runserver --settings=mysite.settings</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥è¯¢è®¾ç½®ä¸é»˜è®¤è®¾ç½®çš„ä¸åŒ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py diffsettings</span><br></pre></td></tr></table></figure></p>
<p>åœ¨django appä¸­ä½¿ç”¨è®¾ç½®åº”ä½¿ç”¨ä»¥ä¸‹å¯¼å…¥æ–¹å¼<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼Œdjango.conf.settings ä¸æ˜¯ä¸€ä¸ªæ¨¡å— â€”â€” å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚æ‰€ä»¥ä¸å¯ä»¥å¯¼å…¥æ¯ä¸ªå•ç‹¬çš„è®¾ç½®ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.settings <span class="keyword">import</span> DEBUG  <span class="comment"># This won't work.</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸è¦åœ¨åº”ç”¨è¿è¡Œæ—¶æ”¹å˜è®¾ç½®</p>
<h2 id="å®Œæ•´åˆ—è¡¨è®¾ç½®-Settings"><a href="#å®Œæ•´åˆ—è¡¨è®¾ç½®-Settings" class="headerlink" title="å®Œæ•´åˆ—è¡¨è®¾ç½®(Settings)"></a><a href="http://python.usyiyi.cn/django/ref/settings.html" target="_blank" rel="noopener">å®Œæ•´åˆ—è¡¨è®¾ç½®(Settings)</a></h2><p><code>CSRF_COOKIE_SECURE=True</code>åªé€šè¿‡<code>HTTPS</code>ä¼ é€’<code>cookie</code></p>
<p><code>DATABASES[&#39;CONN_MAX_AGE&#39;]</code>æ•°æ®åº“è¿æ¥çš„æˆšæ—¶é—´ï¼Œé»˜è®¤ä¸º0ï¼ˆå†å²é—ç•™è¡Œä¸ºï¼‰ï¼Œè®¾ç½®ä¸º<code>None</code>è¡¨ç¤ºæ— é™çš„æŒä¹…è¿æ¥<br><code>DECIMAL_SEPARATOR</code>ç±»å‹æ•°æ®çš„åˆ†éš”ç¬¦é»˜è®¤ä¸ºç‚¹<code>.</code><br><code>DISALLOWED_USER_AGENTS</code>ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼å…ƒç»„ç¦ç”¨ä»£ç è®¿é—®ï¼Œéœ€è¦å¯ç”¨<code>CommonMiddleware</code>ä¸­é—´ä»¶<br><code>INTERNAL_IPS</code>è®¾ç½®å…¬å¸å†…å®¹çš„ipï¼Œåœ¨äº›ipåˆ—è¡¨ä¸­çš„ipå¯ä»¥è®¿é—®admindocä¸‹çš„ä¹¦ç­¾</p>
<h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a><a href="http://python.usyiyi.cn/django_182/ref/applications.html" target="_blank" rel="noopener">åº”ç”¨</a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rock_n_roll/apps.py</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> django.apps <span class="keyword">import</span> AppConfig</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RockNRollConfig</span><span class="params">(AppConfig)</span>:</span></span><br><span class="line">    name = <span class="string">'rock_n_roll'</span></span><br><span class="line">    verbose_name = <span class="string">"Rock â€™nâ€™ roll"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rock_n_roll/__init__.py</span></span><br><span class="line"> </span><br><span class="line">default_app_config = <span class="string">'rock_n_roll.apps.RockNRollConfig'</span></span><br></pre></td></tr></table></figure>
<p><code>AppConfig</code>å¯é…ç½®çš„å±æ€§</p>
<ul>
<li><code>AppConfig.name</code></li>
<li><code>AppConfig.label</code></li>
<li><code>AppConfig.verbose_name</code></li>
<li><code>Appconfig.path</code></li>
</ul>
<p><code>AppConfig</code>åªè¯»å±æ€§</p>
<ul>
<li><code>AppConfig.module</code></li>
<li><code>Appconfig.models_module</code></li>
</ul>
<p><code>AppConfig</code>æ–¹æ³•</p>
<ul>
<li><code>AppConfig.get_models()</code></li>
<li><code>AppConfig..get_model(model_name)</code></li>
<li><code>AppConfigevaluate.ready()</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.apps <span class="keyword">import</span> apps</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>apps.get_app_config(<span class="string">'admin'</span>).verbose_name</span><br><span class="line"><span class="string">'Admin'</span></span><br></pre></td></tr></table></figure>
<p><code>APP</code></p>
<ul>
<li><code>apps.ready</code></li>
<li><code>apps.get_app_configs()</code></li>
<li><code>apps.get_app_config(app_label)</code></li>
<li><code>apps.is_installed(app_name)</code></li>
<li><code>apps.get_model(app_label, model_name)</code></li>
</ul>
<h2 id="Djangoå¼‚å¸¸"><a href="#Djangoå¼‚å¸¸" class="headerlink" title="Djangoå¼‚å¸¸"></a><a href="python.usyiyi.cn/django_182/ref/exceptions.html">Djangoå¼‚å¸¸</a></h2><h3 id="æ ¸å¿ƒå¼‚å¸¸"><a href="#æ ¸å¿ƒå¼‚å¸¸" class="headerlink" title="æ ¸å¿ƒå¼‚å¸¸"></a>æ ¸å¿ƒå¼‚å¸¸</h3><p><em><code>django.core.exceptions</code></em></p>
<ul>
<li><p><code>ObjectDoesNotExist</code><br>å¯¹è±¡ä¸å­˜åœ¨<br><code>DoesNotExist</code>çš„åŸºç±»<br>å¯¹ObjectDoesNotExistçš„try/exceptä¼šä¸ºæ‰€æœ‰æ¨¡å‹æ•è·åˆ°æ‰€æœ‰DoesNotExist å¼‚å¸¸</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ObjectDoesNotExist</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    e = Entry.objects.get(id=<span class="number">3</span>)</span><br><span class="line">    b = Blog.objects.get(id=<span class="number">1</span>)</span><br><span class="line"><span class="keyword">except</span> ObjectDoesNotExist:</span><br><span class="line">    print(<span class="string">"Either the entry or blog doesn't exist."</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>FieldDoesNotExist</code><br>å½“è¢«è¯·æ±‚çš„å­—æ®µåœ¨æ¨¡å‹æˆ–æ¨¡å‹çš„çˆ¶ç±»ä¸­ä¸å­˜åœ¨æ—¶ï¼Œ<code>FieldDoesNotExist</code>å¼‚å¸¸ç”±æ¨¡å‹çš„ <code>_meta.get_field()</code>æ–¹æ³•æŠ›å‡º</p>
</li>
<li><p><code>MultipleObjectsReturned</code><br>æŸ¥è¯¢æ—¶ï¼Œé¢„æœŸåªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯è¿”å›äº†å¤šä¸ªå¯¹è±¡ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸</p>
</li>
<li><p><code>SuspiciousOperation</code><br>å½“ç”¨æˆ·è¿›è¡Œçš„æ“ä½œåœ¨å®‰å…¨æ–¹é¢å¯ç–‘çš„æ—¶å€™ï¼ŒæŠ›å‡ºæ­¤å¼‚å¸¸ï¼Œä¾‹å¦‚ï¼Œç¯¡æ”¹<code>cookie</code><br>å­ç±»</p>
<ul>
<li><code>DisallowedHost</code></li>
<li><code>DisallowedModelAdminLookup</code></li>
<li><code>DisallowedModelAdminToField</code></li>
<li><code>DisallowedRedirect</code></li>
<li><code>InvalidSessionKey</code></li>
<li><code>SuspiciousFileOperation</code></li>
<li><code>SuspiciousMultipartForm</code></li>
<li><code>SuspiciousSession</code></li>
</ul>
</li>
<li><p><code>PermissionDenied</code><br>å½“ç”¨æˆ·ä¸è¢«å…è®¸æ¥æ‰§è¡Œè¯·æ±‚çš„æ“ä½œæ—¶äº§ç”Ÿ</p>
</li>
<li><p><code>ViewDoesNotExist</code><br>å½“è¯·æ±‚çš„è§†å›¾ä¸å­˜åœ¨æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸</p>
</li>
<li><p><code>MiddlewareNotUsed</code><br>å½“ä¸­é—´ä»¶æ²¡æœ‰åœ¨æœåŠ¡å™¨é…ç½®ä¸­å‡ºç°æ—¶ï¼ŒæŠ›å‡ºæ­¤å¼‚å¸¸</p>
</li>
<li><p><code>ImproperlyConfigured</code><br>djangoé…ç½®ä¸å½“æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸ï¼Œå¦‚<code>settings.py</code>ä¸­çš„å€¼ä¸æ­£ç¡®æˆ–è€…ä¸å¯è§£æ</p>
</li>
<li><p><code>FieldError</code><br>å½“æ¨¡å‹ä¸Šçš„å­—æ®µå‡ºç°é—®é¢˜æ—¶ï¼ŒæŠ›å‡ºæ­¤å¼‚å¸¸ï¼Œç”±ä»¥ä¸‹åŸå› é€ æˆï¼š</p>
<ul>
<li>æ¨¡å‹ä¸­çš„å­—æ®µä¸æŠ½è±¡åŸºç±»ä¸­çš„å­—æ®µé‡å</li>
<li>æ’åºé€ æˆäº†ä¸€ä¸ªæ­»å¾ªç¯</li>
<li>å…³é”®è¯ä¸èƒ½ç”±è¿‡æ»¤å™¨å‚æ•°è§£æ</li>
<li>å­—æ®µä¸èƒ½ç”±æŸ¥è¯¢å‚æ•°ä¸­çš„å…³é”®è¯å†³å®š</li>
<li>è¿æ¥ï¼ˆjoinï¼‰ä¸èƒ½åœ¨æŒ‡å®šå¯¹è±¡ä¸Šä½¿ç”¨</li>
<li>å­—æ®µåç§°ä¸å¯ç”¨</li>
<li><p>æŸ¥è¯¢åŒ…å«äº†æ— æ•ˆçš„<code>order_by</code>å‚æ•°</p>
</li>
<li><p><code>ValidationError</code><br>å½“è¡¨å•æˆ–æ¨¡å‹å­—æ®µéªŒè¯å¤±è´¥æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸</p>
</li>
</ul>
</li>
<li><p><code>NON_FIELD_ERRORS</code><br>åœ¨è¡¨å•æˆ–è€…æ¨¡å‹ä¸­ä¸å±äºç‰¹å®šå­—æ®µçš„<code>ValidationError</code>è¢«å½’ç±»ä¸º<code>NON_FIELD_ERRORS</code></p>
</li>
</ul>
<h3 id="URLè§£æå™¨å¼‚å¸¸"><a href="#URLè§£æå™¨å¼‚å¸¸" class="headerlink" title="URLè§£æå™¨å¼‚å¸¸"></a>URLè§£æå™¨å¼‚å¸¸</h3><ul>
<li><p><code>Resolver404</code><br><code>django.http.Http404</code>çš„å­ç±»<br>å½“å‘<code>resolve</code>ä¼ é€’çš„è·¯å¾„ä¸èƒ½åŒ¹é…åˆ°å¯¹åº”è§†å›¾æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸</p>
</li>
<li><p><code>NoReverseMatch</code><br>å½“ä½ çš„URLconfä¸­çš„ä¸€ä¸ªåŒ¹é…çš„URLä¸èƒ½åŸºäºæä¾›çš„å‚æ•°è¯†åˆ«æ—¶ï¼ŒæŠ›å‡ºæ­¤å¼‚å¸¸</p>
</li>
</ul>
<h3 id="æ•°æ®åº“å¼‚å¸¸"><a href="#æ•°æ®åº“å¼‚å¸¸" class="headerlink" title="æ•°æ®åº“å¼‚å¸¸"></a>æ•°æ®åº“å¼‚å¸¸</h3><p>æ•°æ®åº“å¼‚å¸¸ç”±django.dbå¯¼å…¥</p>
<ul>
<li><code>Error</code></li>
<li><code>InterfaceError</code></li>
<li><code>DatabaseError</code></li>
<li><code>DataError</code></li>
<li><code>OperationalError</code></li>
<li><code>IntegrityError</code></li>
<li><code>InternalError</code></li>
<li><code>ProgrammingError</code></li>
<li><code>NotSupportedError</code></li>
</ul>
<h3 id="HTTPå¼‚å¸¸"><a href="#HTTPå¼‚å¸¸" class="headerlink" title="HTTPå¼‚å¸¸"></a>HTTPå¼‚å¸¸</h3><p>HTTPå¼‚å¸¸ç”±django.httpå¯¼å…¥</p>
<ul>
<li><code>UnreadablePostError</code><br>ç”¨æˆ·å–æ¶ˆä¸Šä¼ æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸</li>
</ul>
<h3 id="äº‹åŠ¡å¼‚å¸¸"><a href="#äº‹åŠ¡å¼‚å¸¸" class="headerlink" title="äº‹åŠ¡å¼‚å¸¸"></a>äº‹åŠ¡å¼‚å¸¸</h3><p>äº‹åŠ¡å¼‚å¸¸å®šä¹‰ç”±<code>django.db.transaction</code>å¯¼å…¥</p>
<h3 id="æµ‹è¯•æ¡†æ¶å¼‚å¸¸"><a href="#æµ‹è¯•æ¡†æ¶å¼‚å¸¸" class="headerlink" title="æµ‹è¯•æ¡†æ¶å¼‚å¸¸"></a>æµ‹è¯•æ¡†æ¶å¼‚å¸¸</h3><p>ç”±DJango django.test åŒ…æä¾›çš„å¼‚å¸¸</p>
<ul>
<li><code>RedirectCycleError</code><br>å½“æµ‹è¯•å®¢æˆ·ç«¯æ£€æµ‹åˆ°é‡å®šå‘çš„å¾ªç¯æˆ–è€…è¿‡é•¿çš„é“¾æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸</li>
</ul>
<h3 id="Pythonå¼‚å¸¸"><a href="#Pythonå¼‚å¸¸" class="headerlink" title="Pythonå¼‚å¸¸"></a><code>Python</code>å¼‚å¸¸</h3><p>Djangoåœ¨é€‚å½“çš„æ—¶å€™ä¹Ÿä¼šæŠ›å‡ºPythonçš„å†…å»ºå¼‚å¸¸</p>
<h2 id="django-admin-and-manage-py"><a href="#django-admin-and-manage-py" class="headerlink" title="django-admin and manage.py"></a><a href="http://python.usyiyi.cn/django_182/ref/django-admin.html" target="_blank" rel="noopener">django-admin and manage.py</a></h2><ul>
<li><p><code>dumpdata</code><br>è¯¥å‘½ä»¤å°†æ‰€æœ‰ä¸è¢«å‘½ååº”ç”¨ç›¸å…³è”çš„æ•°æ®åº“ä¸­çš„æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚<br>å¦‚æœåœ¨dumpdateå‘½ä»¤åé¢æœªæŒ‡å®šDjangoåº”ç”¨åï¼Œåˆ™Djangoé¡¹ç›®ä¸­å®‰è£…çš„æ‰€æœ‰åº”ç”¨çš„æ•°æ®éƒ½å°†è¢«dumpåˆ°fixtureä¸­<br><code>dumpdata --output data.json</code></p>
</li>
<li><p><code>flus</code><br>æ¸…ç©ºæ•°æ®åº“ï¼Œé‡æ–°è£…è½½åˆå§‹æ•°æ®</p>
</li>
<li><code>--noinput</code></li>
<li><code>--database</code></li>
<li><code>--no-initial-data</code></li>
</ul>
<ul>
<li><p><code>inspectdb</code><br>æ ¹æ®æ•°æ®åº“ç»“æ„ç”Ÿæˆmodel</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py inspectdb &gt; models.py</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>loaddata</code><br>å¯¼å…¥fixtureæ•°æ®</p>
</li>
<li><p><code>runserver</code><br>å¯åŠ¨æœ¬åœ°ä¸Šä¸€ä¸ªè½»é‡çº§çš„WebæœåŠ¡å™¨ï¼Œé»˜è®¤å¤šçº¿ç¨‹<br><code>--noreload</code>ç¦ç”¨è‡ªåŠ¨é‡æ–°è½½å…¥<br><code>--nothreading</code>ç¦ç”¨å¤šçº¿ç¨‹</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runserver <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">80</span></span><br></pre></td></tr></table></figure>
<h2 id="æ·»åŠ è‡ªå®šä¹‰çš„å‘½ä»¤"><a href="#æ·»åŠ è‡ªå®šä¹‰çš„å‘½ä»¤" class="headerlink" title=" æ·»åŠ è‡ªå®šä¹‰çš„å‘½ä»¤"></a><a href="http://python.usyiyi.cn/django_182/howto/custom-management-commands.html" target="_blank" rel="noopener"> æ·»åŠ è‡ªå®šä¹‰çš„å‘½ä»¤</a></h2><p>å‘åº”ç”¨ä¸‹æ·»åŠ management/commandsç›®å½•ï¼ŒDjangoä¼šä¸ºæ­¤ç›®å½•ä¸‹çš„æ‰€æœ‰æ²¡æœ‰å¸¦ä¸‹åˆ’çº¿å¼€å¤´çš„pythonæ¨¡å—éƒ½æ³¨å†Œä¸€ä¸ª<code>manage.py</code>å‘½ä»¤ã€‚<br>åœ¨Python 2ä¸Šï¼Œè¯·ç¡®ä¿managementå’Œmanagement/commandsä¸¤ä¸ªç›®å½•éƒ½åŒ…å«<code>__init__.py</code> æ–‡ä»¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.management.base <span class="keyword">import</span> BaseCommand, CommandError</span><br><span class="line"><span class="keyword">from</span> polls.models <span class="keyword">import</span> Poll</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Command</span><span class="params">(BaseCommand)</span>:</span></span><br><span class="line">    help = <span class="string">'Closes the specified poll for voting'</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_arguments</span><span class="params">(self, parser)</span>:</span></span><br><span class="line">        <span class="comment"># å‘½ä»¤è¡Œæ¥æ”¶ä¸€ä¸ªæˆ–å¤šä¸ªpoll_idå€¼</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        parser.add_argument(<span class="string">'poll_id'</span>, nargs=<span class="string">'+'</span>, type=int)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self, *args, **options)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> poll_id <span class="keyword">in</span> options[<span class="string">'poll_id'</span>]:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                poll = Poll.objects.get(pk=poll_id)</span><br><span class="line">            <span class="keyword">except</span> Poll.DoesNotExist:</span><br><span class="line">                <span class="keyword">raise</span> CommandError(<span class="string">'Poll "%s" does not exist'</span> % poll_id)</span><br><span class="line"> </span><br><span class="line">            poll.opened = <span class="keyword">False</span></span><br><span class="line">            poll.save()</span><br><span class="line"> </span><br><span class="line">            self.stdout.write(<span class="string">'Successfully closed poll "%s"'</span> % poll_id)</span><br></pre></td></tr></table></figure>
<p><img alt="django-commands" data-src="/media/django-commands.png"></p>

    </div>

    
    
    
        
      
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>æ²™ä¸é±¼ğŸ‡¨ğŸ‡³</li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="http://me.iblogc.com/2016/04/04/django1-9æ–‡æ¡£é˜…è¯»ç¬”è®°/" title="Django 1.9æ–‡æ¡£é˜…è¯»ç¬”è®°">http://me.iblogc.com/2016/04/04/django1-9æ–‡æ¡£é˜…è¯»ç¬”è®°/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li>
</ul>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/django/" rel="tag"># Django</a>
            
              <a href="/tags/æ–‡æ¡£/" rel="tag"># æ–‡æ¡£</a>
            
              <a href="/tags/ç¬”è®°/" rel="tag"># ç¬”è®°</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2016/01/28/django-rest-frameworkä¹‹ç‰ˆæœ¬å·version/" rel="next" title="Django REST frameworkä¹‹ç‰ˆæœ¬å·version">
                  <i class="fa fa-chevron-left"></i> Django REST frameworkä¹‹ç‰ˆæœ¬å·version
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2016/06/01/chromeæ‰©å±•-æ’ä»¶-åº”ç”¨æ¨è/" rel="prev" title="Chromeæ‰©å±•/æ’ä»¶/åº”ç”¨æ¨è">
                  Chromeæ‰©å±•/æ’ä»¶/åº”ç”¨æ¨è <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/avatar.png"
      alt="æ²™ä¸é±¼ğŸ‡¨ğŸ‡³">
  <p class="site-author-name" itemprop="name">æ²™ä¸é±¼ğŸ‡¨ğŸ‡³</p>
  <div class="site-description" itemprop="description">iblogc</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives">
        
          <span class="site-state-item-count">49</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags">
          
        
        <span class="site-state-item-count">92</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/iblogc" title="GitHub &rarr; https://github.com/iblogc" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
  </div>
  <div class="cc-license motion-element" itemprop="license">
    
  
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">æ²™ä¸é±¼ğŸ‡¨ğŸ‡³</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    
    <span title="ç«™ç‚¹æ€»å­—æ•°">143k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">2:10</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.0</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
  
</div>






  
  <script>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
              leancloudSelector(url).innerText = counter.time + 1;
            
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=iSVaGDh3pvPppn4ATzdswCRj-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'iSVaGDh3pvPppn4ATzdswCRj-gzGzoHsz',
            'X-LC-Key': 'FneGhBeiPNdFAiN9elNeFAxc',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>






        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script>



  








  <script src="/js/local-search.js?v=7.4.0"></script>














  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://iblogc.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function disqus_config() {
    this.page.url = "http://me.iblogc.com/2016/04/04/django1-9æ–‡æ¡£é˜…è¯»ç¬”è®°/";
    this.page.identifier = "2016/04/04/django1-9æ–‡æ¡£é˜…è¯»ç¬”è®°/";
    this.page.title = 'Django 1.9æ–‡æ¡£é˜…è¯»ç¬”è®°';};
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://iblogc.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    (function() {
      var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        window.addEventListener('load', loadComments, false);
      } else {
        var disqus_scroll = () => {
          // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
          var scrollTop = window.scrollY;

          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            window.removeEventListener('scroll', disqus_scroll);
            loadComments();
          }
        };
        window.addEventListener('scroll', disqus_scroll);
      }
    })();
  
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
<style type="text/css">
// html{
//   -webkit-filter: grayscale(100%); 
//   -moz-filter: grayscale(100%); 
//   -ms-filter: grayscale(100%); 
//   -o-filter: grayscale(100%); 
//   filter:progid:DXImageTransform.Microsoft.BasicImage(grayscale=1);  
//   _filter:none; 
// }
</style>
</html>
