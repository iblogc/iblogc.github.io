{"title":"Django字段选项related_name和related_query_name","slug":"django字段选项related-name和related-query-name","date":"2015-10-20T14:22:06.000Z","updated":"2020-08-15T03:05:59.000Z","comments":true,"path":"api/articles/django字段选项related-name和related-query-name.json","excerpt":"data<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>sqlite&gt; select * from author;<br>id      name    age<br>1       jim     12<br>2       tom     11<br>sqlite&gt; select * from book;<br>id      name    author_id<br>1       learn java      1<br>2       learn python    1<br>3       learn c++       2<br><br>","covers":null,"content":"<p><code>data</code><br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlite&gt; select * from author;</span><br><span class=\"line\">id      name    age</span><br><span class=\"line\">1       jim     12</span><br><span class=\"line\">2       tom     11</span><br><span class=\"line\">sqlite&gt; select * from book;</span><br><span class=\"line\">id      name    author_id</span><br><span class=\"line\">1       learn java      1</span><br><span class=\"line\">2       learn python    1</span><br><span class=\"line\">3       learn c++       2</span><br></pre></td></tr></table></figure><br><span id=\"more\"></span><br><code>models.py</code><br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: UTF-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> unicode_literals</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.db <span class=\"keyword\">import</span> models</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Create your models here.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Author</span>(models.Model):</span><br><span class=\"line\">    name = models.CharField(verbose_name=<span class=\"string\">&#x27;姓名&#x27;</span>, max_length=<span class=\"number\">50</span>)</span><br><span class=\"line\">    age = models.IntegerField(verbose_name=<span class=\"string\">&#x27;年龄&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Book</span>(models.Model):</span><br><span class=\"line\">    name = models.CharField(verbose_name=<span class=\"string\">&#x27;书名&#x27;</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\">    author = models.ForeignKey(Author, verbose_name=<span class=\"string\">&#x27;作者&#x27;</span>)</span><br></pre></td></tr></table></figure><br>执行语句<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Author.objects.filter(book__name=&#x27;learn java&#x27;)</span><br><span class=\"line\">[&lt;Author: jim&gt;]</span><br><span class=\"line\">&gt;&gt;&gt; author = Author.objects.get(pk=1)</span><br><span class=\"line\">&gt;&gt;&gt; author.book_set.all()</span><br><span class=\"line\">[&lt;Book: learn java&gt;, &lt;Book: learn python&gt;]</span><br></pre></td></tr></table></figure></p>\n<p>假如把类<code>Book</code>改成这样<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Book(models.Model):</span><br><span class=\"line\">    name = models.CharField(verbose_name=&#x27;书名&#x27;, max_length=100)</span><br><span class=\"line\">    author = models.ForeignKey(Author, verbose_name=&#x27;作者&#x27;, related_name=&#x27;bs&#x27;, related_query_name=&#x27;b&#x27;)</span><br></pre></td></tr></table></figure><br>那么上面查询代码就应该写成这样<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Author.objects.filter(b__name=&#x27;learn java&#x27;)</span><br><span class=\"line\">[&lt;Author: jim&gt;]</span><br><span class=\"line\">&gt;&gt;&gt; author = Author.objects.get(pk=1)</span><br><span class=\"line\">&gt;&gt;&gt; author.bs.all()</span><br><span class=\"line\">[&lt;Book: learn java&gt;, &lt;Book: learn python&gt;]</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>如果<code>book</code>表里有两个字段都外键关联<code>author</code>表，这时<code>related_name</code>就非常有用了。</p>\n</blockquote>\n","more":"<br><code>models.py</code><br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: UTF-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> unicode_literals</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.db <span class=\"keyword\">import</span> models</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Create your models here.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Author</span>(models.Model):</span><br><span class=\"line\">    name = models.CharField(verbose_name=<span class=\"string\">&#x27;姓名&#x27;</span>, max_length=<span class=\"number\">50</span>)</span><br><span class=\"line\">    age = models.IntegerField(verbose_name=<span class=\"string\">&#x27;年龄&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Book</span>(models.Model):</span><br><span class=\"line\">    name = models.CharField(verbose_name=<span class=\"string\">&#x27;书名&#x27;</span>, max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\">    author = models.ForeignKey(Author, verbose_name=<span class=\"string\">&#x27;作者&#x27;</span>)</span><br></pre></td></tr></table></figure><br>执行语句<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Author.objects.filter(book__name=&#x27;learn java&#x27;)</span><br><span class=\"line\">[&lt;Author: jim&gt;]</span><br><span class=\"line\">&gt;&gt;&gt; author = Author.objects.get(pk=1)</span><br><span class=\"line\">&gt;&gt;&gt; author.book_set.all()</span><br><span class=\"line\">[&lt;Book: learn java&gt;, &lt;Book: learn python&gt;]</span><br></pre></td></tr></table></figure></p>\n<p>假如把类<code>Book</code>改成这样<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Book(models.Model):</span><br><span class=\"line\">    name = models.CharField(verbose_name=&#x27;书名&#x27;, max_length=100)</span><br><span class=\"line\">    author = models.ForeignKey(Author, verbose_name=&#x27;作者&#x27;, related_name=&#x27;bs&#x27;, related_query_name=&#x27;b&#x27;)</span><br></pre></td></tr></table></figure><br>那么上面查询代码就应该写成这样<br><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; Author.objects.filter(b__name=&#x27;learn java&#x27;)</span><br><span class=\"line\">[&lt;Author: jim&gt;]</span><br><span class=\"line\">&gt;&gt;&gt; author = Author.objects.get(pk=1)</span><br><span class=\"line\">&gt;&gt;&gt; author.bs.all()</span><br><span class=\"line\">[&lt;Book: learn java&gt;, &lt;Book: learn python&gt;]</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>如果<code>book</code>表里有两个字段都外键关联<code>author</code>表，这时<code>related_name</code>就非常有用了。</p>\n</blockquote>","categories":[{"name":"程序猿","path":"api/categories/程序猿.json"}],"tags":[{"name":"Python","path":"api/tags/Python.json"},{"name":"Django","path":"api/tags/Django.json"}]}