!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leancloud-realtime/core")):"function"==typeof define&&define.amd?define("live-query",["exports","leancloud-realtime/core"],e):e(t.AV=t.AV||{},t.AV)}(this,function(t,u){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}var r=Math.ceil,o=Math.floor,a=function(t){return isNaN(t=+t)?0:(0<t?o:r)(t)},c=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},h=n(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),v=n(function(t){var e=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=e)}),f=(v.version,function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}),_=function(r,o,t){if(f(r),void 0===o)return r;switch(t){case 1:return function(t){return r.call(o,t)};case 2:return function(t,e){return r.call(o,t,e)};case 3:return function(t,e,n){return r.call(o,t,e,n)}}return function(){return r.apply(o,arguments)}},s=function(t){return"object"==typeof t?null!==t:"function"==typeof t},y=function(t){if(!s(t))throw TypeError(t+" is not an object!");return t},l=function(t){try{return!!t()}catch(t){return!0}},p=!l(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),i=h.document,d=s(i)&&s(i.createElement),g=function(t){return d?i.createElement(t):{}},m=!p&&!l(function(){return 7!=Object.defineProperty(g("div"),"a",{get:function(){return 7}}).a}),b=function(t,e){if(!s(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!s(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!s(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!s(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},w=Object.defineProperty,S={f:p?Object.defineProperty:function(t,e,n){if(y(t),e=b(e,!0),y(n),m)try{return w(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},O=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},E=p?function(t,e,n){return S.f(t,e,O(1,n))}:function(t,e,n){return t[e]=n,t},j={}.hasOwnProperty,P=function(t,e){return j.call(t,e)},M="prototype",A=function(t,e,n){var r,o,i,u=t&A.F,c=t&A.G,f=t&A.S,a=t&A.P,s=t&A.B,l=t&A.W,p=c?v:v[e]||(v[e]={}),d=p[M],y=c?h:f?h[e]:(h[e]||{})[M];for(r in c&&(n=e),n)(o=!u&&y&&void 0!==y[r])&&P(p,r)||(i=o?y[r]:n[r],p[r]=c&&"function"!=typeof y[r]?n[r]:s&&o?_(i,h):l&&y[r]==i?function(r){var t=function(t,e,n){if(this instanceof r){switch(arguments.length){case 0:return new r;case 1:return new r(t);case 2:return new r(t,e)}return new r(t,e,n)}return r.apply(this,arguments)};return t[M]=r[M],t}(i):a&&"function"==typeof i?_(Function.call,i):i,a&&((p.virtual||(p.virtual={}))[r]=i,t&A.R&&d&&!d[r]&&E(d,r,i)))};A.F=1,A.G=2,A.S=4,A.P=8,A.B=16,A.W=32,A.U=64,A.R=128;var T,k=A,C=E,x={},L={}.toString,N=function(t){return L.call(t).slice(8,-1)},F=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==N(t)?t.split(""):Object(t)},I=function(t){return F(c(t))},D=Math.min,R=function(t){return 0<t?D(a(t),9007199254740991):0},G=Math.max,q=Math.min,Q=n(function(t){var e="__core-js_shared__",n=h[e]||(h[e]={});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:v.version,mode:"pure",copyright:"Â© 2018 Denis Pushkarev (zloirock.ru)"})}),V=0,z=Math.random(),J=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++V+z).toString(36))},K=Q("keys"),W=function(t){return K[t]||(K[t]=J(t))},B=(T=!1,function(t,e,n){var r,o,i,u=I(t),c=R(u.length),f=(o=c,(r=a(r=n))<0?G(r+o,0):q(r,o));if(T&&e!=e){for(;f<c;)if((i=u[f++])!=i)return!0}else for(;f<c;f++)if((T||f in u)&&u[f]===e)return T||f||0;return!T&&-1}),H=W("IE_PROTO"),U=function(t,e){var n,r=I(t),o=0,i=[];for(n in r)n!=H&&P(r,n)&&i.push(n);for(;e.length>o;)P(r,n=e[o++])&&(~B(i,n)||i.push(n));return i},Y="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),X=Object.keys||function(t){return U(t,Y)},Z=p?Object.defineProperties:function(t,e){y(t);for(var n,r=X(e),o=r.length,i=0;i<o;)S.f(t,n=r[i++],e[n]);return t},$=h.document,tt=$&&$.documentElement,et=W("IE_PROTO"),nt=function(){},rt="prototype",ot=function(){var t,e=g("iframe"),n=Y.length;for(e.style.display="none",tt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ot=t.F;n--;)delete ot[rt][Y[n]];return ot()},it=Object.create||function(t,e){var n;return null!==t?(nt[rt]=y(t),n=new nt,nt[rt]=null,n[et]=t):n=ot(),void 0===e?n:Z(n,e)},ut=n(function(t){var e=Q("wks"),n=h.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:J)("Symbol."+t))}).store=e}),ct=S.f,ft=ut("toStringTag"),at=function(t,e,n){t&&!P(t=n?t:t.prototype,ft)&&ct(t,ft,{configurable:!0,value:e})},st={};E(st,ut("iterator"),function(){return this});var lt,pt=function(t){return Object(c(t))},dt=W("IE_PROTO"),yt=Object.prototype,ht=Object.getPrototypeOf||function(t){return t=pt(t),P(t,dt)?t[dt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?yt:null},vt=ut("iterator"),_t=!([].keys&&"next"in[].keys()),gt="values",mt=function(){return this},bt=function(t,e,n,r,o,i,u){var c,f,a;f=e,a=r,(c=n).prototype=it(st,{next:O(1,a)}),at(c,f+" Iterator");var s,l,p,d=function(t){if(!_t&&t in _)return _[t];switch(t){case"keys":case gt:return function(){return new n(this,t)}}return function(){return new n(this,t)}},y=e+" Iterator",h=o==gt,v=!1,_=t.prototype,g=_[vt]||_["@@iterator"]||o&&_[o],m=g||d(o),b=o?h?d("entries"):m:void 0,w="Array"==e&&_.entries||g;if(w&&(p=ht(w.call(new t)))!==Object.prototype&&p.next&&at(p,y,!0),h&&g&&g.name!==gt&&(v=!0,m=function(){return g.call(this)}),u&&(_t||v||!_[vt])&&E(_,vt,m),x[e]=m,x[y]=mt,o)if(s={values:h?m:d(gt),keys:i?m:d("keys"),entries:b},u)for(l in s)l in _||C(_,l,s[l]);else k(k.P+k.F*(_t||v),e,s);return s},wt=(lt=!0,function(t,e){var n,r,o=String(c(t)),i=a(e),u=o.length;return i<0||u<=i?lt?"":void 0:(n=o.charCodeAt(i))<55296||56319<n||i+1===u||(r=o.charCodeAt(i+1))<56320||57343<r?lt?o.charAt(i):n:lt?o.slice(i,i+2):r-56320+(n-55296<<10)+65536});bt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=wt(e,n),this._i+=t.length,{value:t,done:!1})});var St=function(e,t,n,r){try{return r?t(y(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&y(o.call(e)),t}},Ot=ut("iterator"),Et=Array.prototype,jt=function(t){return void 0!==t&&(x.Array===t||Et[Ot]===t)},Pt=function(t,e,n){e in t?S.f(t,e,O(0,n)):t[e]=n},Mt=ut("toStringTag"),At="Arguments"==N(function(){return arguments}()),Tt=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Mt))?n:At?N(e):"Object"==(r=N(e))&&"function"==typeof e.callee?"Arguments":r},kt=ut("iterator"),Ct=v.getIteratorMethod=function(t){if(null!=t)return t[kt]||t["@@iterator"]||x[Tt(t)]},xt=ut("iterator"),Lt=!1;try{[7][xt]().return=function(){Lt=!0}}catch(t){}k(k.S+k.F*!function(t,e){if(!e&&!Lt)return!1;var n=!1;try{var r=[7],o=r[xt]();o.next=function(){return{done:n=!0}},r[xt]=function(){return o},t(r)}catch(t){}return n}(function(t){}),"Array",{from:function(t){var e,n,r,o,i=pt(t),u="function"==typeof this?this:Array,c=arguments.length,f=1<c?arguments[1]:void 0,a=void 0!==f,s=0,l=Ct(i);if(a&&(f=_(f,2<c?arguments[2]:void 0,2)),null==l||u==Array&&jt(l))for(n=new u(e=R(i.length));s<e;s++)Pt(n,s,a?f(i[s],s):i[s]);else for(o=l.call(i),n=new u;!(r=o.next()).done;s++)Pt(n,s,a?St(o,f,[r.value,s],!0):r.value);return n.length=s,n}});var Nt=v.Array.from,Ft=n(function(t){t.exports={default:Nt,__esModule:!0}});e(Ft);var It=e(n(function(t,e){e.__esModule=!0;var n,r=(n=Ft)&&n.__esModule?n:{default:n};e.default=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return(0,r.default)(t)}}));if(!u.Protocals)throw new Error("LeanCloud Realtime SDK not installed");var Dt={f:Object.getOwnPropertySymbols},Rt={f:{}.propertyIsEnumerable},Gt=Object.assign,qt=!Gt||l(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Gt({},t)[n]||Object.keys(Gt({},e)).join("")!=r})?function(t,e){for(var n=pt(t),r=arguments.length,o=1,i=Dt.f,u=Rt.f;o<r;)for(var c,f=F(arguments[o++]),a=i?X(f).concat(i(f)):X(f),s=a.length,l=0;l<s;)u.call(f,c=a[l++])&&(n[c]=f[c]);return n}:Gt;k(k.S+k.F,"Object",{assign:qt});var Qt=v.Object.assign,Vt=e(n(function(t){t.exports={default:Qt,__esModule:!0}})),zt=function(t,e){return{value:e,done:!!t}};bt(Array,"Array",function(t,e){this._t=I(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,zt(1)):zt(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");x.Arguments=x.Array;for(var Jt=ut("toStringTag"),Kt="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),Wt=0;Wt<Kt.length;Wt++){var Bt=Kt[Wt],Ht=h[Bt],Ut=Ht&&Ht.prototype;Ut&&!Ut[Jt]&&E(Ut,Jt,Bt),x[Bt]=x.Array}var Yt,Xt,Zt,$t,te,ee,ne,re,oe,ie,ue,ce,fe,ae,se,le,pe,de,ye,he,ve,_e=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:E(t,r,e[r]);return t},ge=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},me=n(function(t){var p={},d={},e=t.exports=function(t,e,n,r,o){var i,u,c,f,a=o?function(){return t}:Ct(t),s=_(n,r,e?2:1),l=0;if("function"!=typeof a)throw TypeError(t+" is not iterable!");if(jt(a)){for(i=R(t.length);l<i;l++)if((f=e?s(y(u=t[l])[0],u[1]):s(t[l]))===p||f===d)return f}else for(c=a.call(t);!(u=c.next()).done;)if((f=St(c,s,u.value,e))===p||f===d)return f};e.BREAK=p,e.RETURN=d}),be=ut("species"),we=n(function(t){var n=J("meta"),e=S.f,r=0,o=Object.isExtensible||function(){return!0},i=!l(function(){return o(Object.preventExtensions({}))}),u=function(t){e(t,n,{value:{i:"O"+ ++r,w:{}}})},c=t.exports={KEY:n,NEED:!1,fastKey:function(t,e){if(!s(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!P(t,n)){if(!o(t))return"F";if(!e)return"E";u(t)}return t[n].i},getWeak:function(t,e){if(!P(t,n)){if(!o(t))return!0;if(!e)return!1;u(t)}return t[n].w},onFreeze:function(t){return i&&c.NEED&&o(t)&&!P(t,n)&&u(t),t}}}),Se=(we.KEY,we.NEED,we.fastKey,we.getWeak,we.onFreeze,function(t,e){if(!s(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}),Oe=S.f,Ee=we.fastKey,je=p?"_s":"size",Pe=function(t,e){var n,r=Ee(e);if("F"!==r)return t._i[r];for(n=t._f;n;n=n.n)if(n.k==e)return n},Me={getConstructor:function(t,i,n,r){var o=t(function(t,e){ge(t,o,i,"_i"),t._t=i,t._i=it(null),t._f=void 0,t._l=void 0,t[je]=0,null!=e&&me(e,n,t[r],t)});return _e(o.prototype,{clear:function(){for(var t=Se(this,i),e=t._i,n=t._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete e[n.i];t._f=t._l=void 0,t[je]=0},delete:function(t){var e=Se(this,i),n=Pe(e,t);if(n){var r=n.n,o=n.p;delete e._i[n.i],n.r=!0,o&&(o.n=r),r&&(r.p=o),e._f==n&&(e._f=r),e._l==n&&(e._l=o),e[je]--}return!!n},forEach:function(t){Se(this,i);for(var e,n=_(t,1<arguments.length?arguments[1]:void 0,3);e=e?e.n:this._f;)for(n(e.v,e.k,this);e&&e.r;)e=e.p},has:function(t){return!!Pe(Se(this,i),t)}}),p&&Oe(o.prototype,"size",{get:function(){return Se(this,i)[je]}}),o},def:function(t,e,n){var r,o,i=Pe(t,e);return i?i.v=n:(t._l=i={i:o=Ee(e,!0),k:e,v:n,p:r=t._l,n:void 0,r:!1},t._f||(t._f=i),r&&(r.n=i),t[je]++,"F"!==o&&(t._i[o]=i)),t},getEntry:Pe,setStrong:function(t,n,e){var r,o;bt(t,n,function(t,e){this._t=Se(t,n),this._k=e,this._l=void 0},function(){for(var t=this,e=t._k,n=t._l;n&&n.r;)n=n.p;return t._t&&(t._l=n=n?n.n:t._t._f)?zt(0,"keys"==e?n.k:"values"==e?n.v:[n.k,n.v]):(t._t=void 0,zt(1))},e?"entries":"values",!e,!0),o="function"==typeof v[r=n]?v[r]:h[r],p&&o&&!o[be]&&S.f(o,be,{configurable:!0,get:function(){return this}})}},Ae=Array.isArray||function(t){return"Array"==N(t)},Te=ut("species"),ke=function(t,e){return Ae(n=t)&&("function"!=typeof(r=n.constructor)||r!==Array&&!Ae(r.prototype)||(r=void 0),s(r)&&null===(r=r[Te])&&(r=void 0)),new(void 0===r?Array:r)(e);var n,r},Ce=S.f,xe=(Zt=1==(Yt=0),$t=2==Yt,te=3==Yt,ee=4==Yt,ne=6==Yt,re=5==Yt||ne,oe=Xt||ke,function(t,e,n){for(var r,o,i=pt(t),u=F(i),c=_(e,n,3),f=R(u.length),a=0,s=Zt?oe(t,f):$t?oe(t,0):void 0;a<f;a++)if((re||a in u)&&(o=c(r=u[a],a,i),Yt))if(Zt)s[a]=o;else if(o)switch(Yt){case 3:return!0;case 5:return r;case 6:return a;case 2:s.push(r)}else if(ee)return!1;return ne?-1:te||ee?ee:s});ue=function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},ce={add:function(t){return Me.def(Se(this,"Set"),t=0===t?0:t,t)}},fe=Me,le=h[ie="Set"],de=ae?"set":"add",ye=(pe=le)&&pe.prototype,he={},p&&"function"==typeof pe&&(se||ye.forEach&&!l(function(){(new pe).entries().next()}))?(pe=ue(function(t,e){ge(t,pe,ie,"_c"),t._c=new le,null!=e&&me(e,ae,t[de],t)}),xe("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(r){var o="add"==r||"set"==r;r in ye&&(!se||"clear"!=r)&&E(pe.prototype,r,function(t,e){if(ge(this,pe,r),!o&&se&&!s(t))return"get"==r&&void 0;var n=this._c[r](0===t?0:t,e);return o?this:n})}),se||Ce(pe.prototype,"size",{get:function(){return this._c.size}})):(pe=fe.getConstructor(ue,ie,ae,de),_e(pe.prototype,ce),we.NEED=!0),at(pe,ie),he[ie]=pe,k(k.G+k.W+k.F,he),se||fe.setStrong(pe,ie,ae);k(k.P+k.R,"Set",{toJSON:(ve="Set",function(){if(Tt(this)!=ve)throw TypeError(ve+"#toJSON isn't generic");return me(this,!(e=[]),e.push,e,t),e;var t,e})});var Le;Le="Set",k(k.S,Le,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}});var Ne;Ne="Set",k(k.S,Ne,{from:function(t){var e,n,r,o,i=arguments[1];return f(this),(e=void 0!==i)&&f(i),null==t?new this:(n=[],e?(r=0,o=_(i,arguments[2],2),me(t,!1,function(t){n.push(o(t,r++))})):me(t,!1,n.push,n),new this(n))}});var Fe=v.Set,Ie=e(n(function(t){t.exports={default:Fe,__esModule:!0}})),De=e(n(function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}})),Re={f:ut},Ge=Re.f("iterator"),qe=n(function(t){t.exports={default:Ge,__esModule:!0}});e(qe);var Qe=S.f,Ve=function(t){var e=v.Symbol||(v.Symbol={});"_"==t.charAt(0)||t in e||Qe(e,t,{value:Re.f(t)})},ze=Y.concat("length","prototype"),Je={f:Object.getOwnPropertyNames||function(t){return U(t,ze)}},Ke=Je.f,We={}.toString,Be="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],He={f:function(t){return Be&&"[object Window]"==We.call(t)?function(t){try{return Ke(t)}catch(t){return Be.slice()}}(t):Ke(I(t))}},Ue=Object.getOwnPropertyDescriptor,Ye={f:p?Ue:function(t,e){if(t=I(t),e=b(e,!0),m)try{return Ue(t,e)}catch(t){}if(P(t,e))return O(!Rt.f.call(t,e),t[e])}},Xe=we.KEY,Ze=Ye.f,$e=S.f,tn=He.f,en=h.Symbol,nn=h.JSON,rn=nn&&nn.stringify,on="prototype",un=ut("_hidden"),cn=ut("toPrimitive"),fn={}.propertyIsEnumerable,an=Q("symbol-registry"),sn=Q("symbols"),ln=Q("op-symbols"),pn=Object[on],dn="function"==typeof en,yn=h.QObject,hn=!yn||!yn[on]||!yn[on].findChild,vn=p&&l(function(){return 7!=it($e({},"a",{get:function(){return $e(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=Ze(pn,e);r&&delete pn[e],$e(t,e,n),r&&t!==pn&&$e(pn,e,r)}:$e,_n=function(t){var e=sn[t]=it(en[on]);return e._k=t,e},gn=dn&&"symbol"==typeof en.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof en},mn=function(t,e,n){return t===pn&&mn(ln,e,n),y(t),e=b(e,!0),y(n),P(sn,e)?(n.enumerable?(P(t,un)&&t[un][e]&&(t[un][e]=!1),n=it(n,{enumerable:O(0,!1)})):(P(t,un)||$e(t,un,O(1,{})),t[un][e]=!0),vn(t,e,n)):$e(t,e,n)},bn=function(t,e){y(t);for(var n,r=function(t){var e=X(t),n=Dt.f;if(n)for(var r,o=n(t),i=Rt.f,u=0;o.length>u;)i.call(t,r=o[u++])&&e.push(r);return e}(e=I(e)),o=0,i=r.length;o<i;)mn(t,n=r[o++],e[n]);return t},wn=function(t){var e=fn.call(this,t=b(t,!0));return!(this===pn&&P(sn,t)&&!P(ln,t))&&(!(e||!P(this,t)||!P(sn,t)||P(this,un)&&this[un][t])||e)},Sn=function(t,e){if(t=I(t),e=b(e,!0),t!==pn||!P(sn,e)||P(ln,e)){var n=Ze(t,e);return!n||!P(sn,e)||P(t,un)&&t[un][e]||(n.enumerable=!0),n}},On=function(t){for(var e,n=tn(I(t)),r=[],o=0;n.length>o;)P(sn,e=n[o++])||e==un||e==Xe||r.push(e);return r},En=function(t){for(var e,n=t===pn,r=tn(n?ln:I(t)),o=[],i=0;r.length>i;)!P(sn,e=r[i++])||n&&!P(pn,e)||o.push(sn[e]);return o};dn||(C((en=function(){if(this instanceof en)throw TypeError("Symbol is not a constructor!");var e=J(0<arguments.length?arguments[0]:void 0),n=function(t){this===pn&&n.call(ln,t),P(this,un)&&P(this[un],e)&&(this[un][e]=!1),vn(this,e,O(1,t))};return p&&hn&&vn(pn,e,{configurable:!0,set:n}),_n(e)})[on],"toString",function(){return this._k}),Ye.f=Sn,S.f=mn,Je.f=He.f=On,Rt.f=wn,Dt.f=En,Re.f=function(t){return _n(ut(t))}),k(k.G+k.W+k.F*!dn,{Symbol:en});for(var jn="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Pn=0;jn.length>Pn;)ut(jn[Pn++]);for(var Mn=X(ut.store),An=0;Mn.length>An;)Ve(Mn[An++]);k(k.S+k.F*!dn,"Symbol",{for:function(t){return P(an,t+="")?an[t]:an[t]=en(t)},keyFor:function(t){if(!gn(t))throw TypeError(t+" is not a symbol!");for(var e in an)if(an[e]===t)return e},useSetter:function(){hn=!0},useSimple:function(){hn=!1}}),k(k.S+k.F*!dn,"Object",{create:function(t,e){return void 0===e?it(t):bn(it(t),e)},defineProperty:mn,defineProperties:bn,getOwnPropertyDescriptor:Sn,getOwnPropertyNames:On,getOwnPropertySymbols:En}),nn&&k(k.S+k.F*(!dn||l(function(){var t=en();return"[null]"!=rn([t])||"{}"!=rn({a:t})||"{}"!=rn(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);if(n=e=r[1],(s(e)||void 0!==t)&&!gn(t))return Ae(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!gn(e))return e}),r[1]=e,rn.apply(nn,r)}}),en[on][cn]||E(en[on],cn,en[on].valueOf),at(en,"Symbol"),at(Math,"Math",!0),at(h.JSON,"JSON",!0),Ve("asyncIterator"),Ve("observable");var Tn=v.Symbol,kn=n(function(t){t.exports={default:Tn,__esModule:!0}});e(kn);var Cn=n(function(t,e){e.__esModule=!0;var n=i(qe),r=i(kn),o="function"==typeof r.default&&"symbol"==typeof n.default?function(t){return typeof t}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":typeof t};function i(t){return t&&t.__esModule?t:{default:t}}e.default="function"==typeof r.default&&"symbol"===o(n.default)?function(t){return void 0===t?"undefined":o(t)}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":void 0===t?"undefined":o(t)}});e(Cn);var xn=e(n(function(t,e){e.__esModule=!0;var n,r=(n=Cn)&&n.__esModule?n:{default:n};e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,r.default)(e))&&"function"!=typeof e?t:e}})),Ln=function(t,e){if(y(t),!s(e)&&null!==e)throw TypeError(e+": can't set as prototype!")},Nn={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,r){try{(r=_(Function.call,Ye.f(Object.prototype,"__proto__").set,2))(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,e){return Ln(t,e),n?t.__proto__=e:r(t,e),t}}({},!1):void 0),check:Ln};k(k.S,"Object",{setPrototypeOf:Nn.set});var Fn=v.Object.setPrototypeOf,In=n(function(t){t.exports={default:Fn,__esModule:!0}});e(In),k(k.S,"Object",{create:it});var Dn=v.Object,Rn=function(t,e){return Dn.create(t,e)},Gn=n(function(t){t.exports={default:Rn,__esModule:!0}});e(Gn);var qn=e(n(function(t,e){e.__esModule=!0;var n=i(In),r=i(Gn),o=i(Cn);function i(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,o.default)(e)));t.prototype=(0,r.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(n.default?(0,n.default)(t,e):t.__proto__=e)}})),Qn=u.Protocals.CommandType,Vn=u.Protocals.GenericCommand,zn=u.Protocals.AckCommand,Jn=function(t){return console.warn(t.message)},Kn=function(o){function i(t,e,n){De(this,i);var r=xn(this,o.call(this));return r._appId=t,r.id=e,r._connection=n,r._eventemitter=new u.EventEmitter,r._querys=new Ie,r}return qn(i,o),i.prototype._send=function(t){for(var e,n=arguments.length,r=Array(1<n?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return(e=this._connection).send.apply(e,[Vt(t,{appId:this._appId,installationId:this.id,service:1})].concat(r))},i.prototype._open=function(){return this._send(new Vn({cmd:Qn.login}))},i.prototype.close=function(){var t=this._eventemitter;return t.emit("beforeclose"),this._send(new Vn({cmd:Qn.logout})).then(function(){return t.emit("close")})},i.prototype.register=function(t){this._querys.add(t)},i.prototype.deregister=function(t){var e=this;this._querys.delete(t),setTimeout(function(){e._querys.size||e.close().catch(Jn)},0)},i.prototype._dispatchCommand=function(t){return t.cmd!==Qn.data?(this.emit("unhandledmessage",t),u.Promise.resolve()):this._dispatchDataCommand(t)},i.prototype._dispatchDataCommand=function(t){var e=t.dataMessage,n=e.ids,r=e.msg;this.emit("message",r.map(function(t){var e=t.data;return JSON.parse(e)}));var o=new Vn({cmd:Qn.ack,ackMessage:new zn({ids:n})});return this._send(o,!1).catch(Jn)},i}(u.EventEmitter),Wn={name:"leancloud-realtime-plugin-live-query",onRealtimeCreate:function(o){o._liveQueryClients={},o.createLiveQueryClient=function(n){var t;if(void 0!==o._liveQueryClients[n])return u.Promise.resolve(o._liveQueryClients[n]);var e,r=(t=o._open().then(function(t){var e=new Kn(o._options.appId,n,t);return t.on("reconnect",function(){return e._open().then(function(){return e.emit("reconnect")},function(t){return e.emit("reconnecterror",t)})}),e._eventemitter.on("beforeclose",function(){delete o._liveQueryClients[e.id]},o),e._eventemitter.on("close",function(){o._deregister(e)},o),e._open().then(function(){return o._liveQueryClients[e.id]=e,o._register(e),e})})).then.apply(t,It((e=function(){o._deregisterPending&&o._deregisterPending(r)},[function(t){return e(),t},function(t){throw e(),t}])));return o._liveQueryClients[n]=r,o._registerPending&&o._registerPending(r),r}},beforeCommandDispatch:function(t,e){if(!t.installationId||1!==t.service)return!0;var n=e._liveQueryClients[t.installationId];return n?n._dispatchCommand(t).catch(function(t){return console.warn(t)}):console.warn("Unexpected message received without any live client match: %O",t),!1}};t.LiveQueryPlugin=Wn,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=live-query.min.js.map
